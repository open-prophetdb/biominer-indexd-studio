"use strict";(self.webpackChunkbiominer_indexd_studio=self.webpackChunkbiominer_indexd_studio||[]).push([[2082],{32082:function(vr,pt,o){o.r(pt),o.d(pt,{default:function(){return or}});var Dt=o(15009),b=o.n(Dt),Tt=o(99289),B=o.n(Tt),Et=o(5574),T=o.n(Et),kt=o(64599),Me=o.n(kt),g=o(67294),It=o(19632),Fe=o.n(It),Mt=o(97857),I=o.n(Mt),Ft=o(50228),Ot=o(76589),Rt=o(82061),Lt=o(44209),Nt=o(71255),Bt=o(87547),Ut=o(24966),Ht=o(85175),Gt=o(16596),Kt=o(41156),Oe=o(69753),zt=o(45128),Vt=o(93461),Yt=o(34114),Qt=o(9502),$t=o(76654),Wt=o(78205),Jt=o(78919),gt=o(38667),Xt=o(13435),qt=o(3296),M=o(21931),F=o(2453),E=o(66309),O=o(83622),mt=o(42075),Re=o(55241),Ke=o(32983),_t=o(74330),ze=o(83062),je=o(4393),en=o(28248),tn=o(27484),xt=o.n(tn),nn=o(93928),ne=o(93549);console.log("Environment variables:",{UMI_APP_API_URL:{NODE_ENV:"production",PUBLIC_PATH:"/"}.UMI_APP_API_URL,UMI_APP_MODEL:{NODE_ENV:"production",PUBLIC_PATH:"/"}.UMI_APP_MODEL});var ot="https://biominer-ai.3steps.cn",rn="".concat(ot,"/v1/chat/completions"),an={NODE_ENV:"production",PUBLIC_PATH:"/"}.UMI_APP_MODEL||"biominer-ai",fr=function(r){ot=r},sn=function(){return rn},J=function(){return ot},on=function(){var x=B()(b()().mark(function r(){var t,a;return b()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,fetch("".concat(J(),"/v1/datasets"));case 2:return t=i.sent,i.next=5,t.json();case 5:return a=i.sent,i.abrupt("return",a.datasets);case 7:case"end":return i.stop()}},r)}));return function(){return x.apply(this,arguments)}}(),ln=function(){var x=B()(b()().mark(function r(t){var a,u;return b()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,fetch("".concat(J(),"/v1/steps/").concat(t),{headers:I()({},ne.E.getAuthHeaders())});case 2:if(a=s.sent,a.ok){s.next=5;break}throw new Error("HTTP error! status: ".concat(a.status));case 5:return s.next=7,a.json();case 7:if(u=s.sent,!(!u||!Array.isArray(u.steps))){s.next=11;break}return console.warn("Invalid steps data received:",u),s.abrupt("return",[]);case 11:return s.abrupt("return",u.steps);case 12:case"end":return s.stop()}},r)}));return function(t){return x.apply(this,arguments)}}(),yt=function(){var x=B()(b()().mark(function r(t){var a,u;return b()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,fetch("".concat(J(),"/v1/usage-metadata/").concat(t),{headers:I()({},ne.E.getAuthHeaders())});case 2:return a=s.sent,s.next=5,a.json();case 5:return u=s.sent,s.abrupt("return",u.usage_metadata);case 7:case"end":return s.stop()}},r)}));return function(t){return x.apply(this,arguments)}}(),jt=function(){var x=B()(b()().mark(function r(t){var a,u;return b()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,fetch("".concat(J(),"/v1/sessions/").concat(t),{headers:I()({},ne.E.getAuthHeaders())});case 2:return a=s.sent,s.next=5,a.json();case 5:return u=s.sent,s.abrupt("return",u.map(function(f,j){return{id:f.id,status:"success",message:{role:f.role,content:f.content},task_progress:f.task_progress,timestamp:f.timestamp,usage_metadata:f.usage_metadata}}));case 7:case"end":return s.stop()}},r)}));return function(t){return x.apply(this,arguments)}}(),cn=function(){var x=B()(b()().mark(function r(){var t,a;return b()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,fetch("".concat(J(),"/v1/sessions"),{headers:I()({},ne.E.getAuthHeaders())});case 2:if(t=i.sent,!ne.E.handleAuthError(t)){i.next=5;break}throw new Error("Authentication required");case 5:return i.next=7,t.json();case 7:return a=i.sent,i.abrupt("return",a.sessions);case 9:case"end":return i.stop()}},r)}));return function(){return x.apply(this,arguments)}}(),un=function(){var x=B()(b()().mark(function r(t,a){var u,i,s;return b()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return u=new FormData,u.append("file",a),j.next=4,fetch("".concat(J(),"/v1/files/").concat(t),{method:"POST",body:u,headers:I()({},ne.E.getAuthHeaders())});case 4:return i=j.sent,j.next=7,i.json();case 7:return s=j.sent,j.abrupt("return",s);case 9:case"end":return j.stop()}},r)}));return function(t,a){return x.apply(this,arguments)}}(),dn=function(){var x=B()(b()().mark(function r(t){var a,u;return b()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,fetch("".concat(J(),"/v1/conversations/").concat(t),{method:"DELETE",headers:I()({},ne.E.getAuthHeaders())});case 2:return a=s.sent,s.next=5,a.json();case 5:return u=s.sent,s.abrupt("return",u);case 7:case"end":return s.stop()}},r)}));return function(t){return x.apply(this,arguments)}}(),vn=function(){var x=B()(b()().mark(function r(t,a){var u,i;return b()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,fetch("".concat(J(),"/v1/explanations/").concat(t,"?task_prompt_md5=").concat(a),{headers:I()({},ne.E.getAuthHeaders())});case 2:return u=f.sent,f.next=5,u.json();case 5:return i=f.sent,f.abrupt("return",i.explanations);case 7:case"end":return f.stop()}},r)}));return function(t,a){return x.apply(this,arguments)}}(),fn=function(){var x=B()(b()().mark(function r(t){var a,u;return b()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,fetch("".concat(J(),"/v1/tasks/").concat(t,"/cancel"),{method:"POST",headers:I()({},ne.E.getAuthHeaders())});case 2:return a=s.sent,s.next=5,a.text();case 5:return u=s.sent,s.abrupt("return",u);case 7:case"end":return s.stop()}},r)}));return function(t){return x.apply(this,arguments)}}(),hn=function(){var x=B()(b()().mark(function r(){var t,a;return b()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,fetch("".concat(J(),"/v1/version"));case 3:if(t=i.sent,!t.ok){i.next=11;break}return i.next=7,t.json();case 7:return a=i.sent,i.abrupt("return",a);case 11:throw new Error("Failed to fetch version info: ".concat(t.statusText));case 12:i.next=18;break;case 14:throw i.prev=14,i.t0=i.catch(0),console.error("Failed to fetch version info:",i.t0),new Error("Failed to fetch version info: ".concat(i.t0));case 18:case"end":return i.stop()}},r,null,[[0,14]])}));return function(){return x.apply(this,arguments)}}(),hr=o(98027),pn=function(r,t){var a=function(s){var f=document.createRange();f.selectNodeContents(s);var j=window.getSelection();j==null||j.removeAllRanges(),j==null||j.addRange(f),F.ZP.warning("Please use Ctrl+C / \u2318+C to copy the prompt.")};if(location.protocol==="https:"||location.hostname==="localhost")navigator.clipboard.writeText(r),F.ZP.success("Copied to clipboard");else{var u=t?document.getElementById(t):null;u?a(u):F.ZP.warning("Please use HTTPS or localhost to copy the prompt.")}},St=o(56717),e=o(85893),gn=function(){var r=(0,g.useState)(null),t=T()(r,2),a=t[0],u=t[1],i=(0,g.useState)(!0),s=T()(i,2),f=s[0],j=s[1];if((0,g.useEffect)(function(){var N=function(){var U=B()(b()().mark(function k(){var X;return b()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,hn().finally(function(){j(!1)});case 2:X=w.sent,u(X);case 4:case"end":return w.stop()}},k)}));return function(){return U.apply(this,arguments)}}();N()},[]),f||!a)return(0,e.jsxs)(E.Z,{color:"default",children:["v",{NODE_ENV:"production",PUBLIC_PATH:"/"}.REACT_APP_VERSION||"unknown"]});var L=a.version,y=a.version_info,v=y.dirty,Z=y.branch!=="main"&&y.branch!=="master";return(0,e.jsx)(ze.Z,{title:(0,e.jsxs)("div",{children:[(0,e.jsxs)("p",{children:[(0,e.jsx)("strong",{children:"Base Version:"})," ",y.base_version]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("strong",{children:"Commit:"})," ",y.commit_hash]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("strong",{children:"Branch:"})," ",y.branch]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("strong",{children:"Build Time:"})," ",y.build_time]}),v&&(0,e.jsx)("p",{children:(0,e.jsx)("strong",{children:"\u26A0\uFE0F Uncommitted Changes"})})]}),placement:"bottom",children:(0,e.jsxs)(E.Z,{color:v?"red":Z?"orange":"blue",icon:(0,e.jsx)(St.Z,{}),children:["v",L]})})},mn=gn,xn=o(2921),Zt=new nn.Z({html:!0,breaks:!0}).use(o(84651)),yn="You can monitor the task progress at right side of the page",pr=function(r){return r=r.replace(/\[x\]/g,"[ ]"),r=r.replace(/\[âœ“\]/g,"[x]"),r=r.replace(/\[-]/g,"[ ]"),_jsx(Typography,{children:_jsx("div",{dangerouslySetInnerHTML:{__html:Zt.render(r)}})})},P=function(r){return console.log("renderMarkdown",r),(0,e.jsx)(M.Z,{children:(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:Zt.render(r)}})})},jn=function(r){var t=new Date(r),a=new Date,u=t.toISOString().split("T")[0],i=a.toISOString().split("T")[0],s=Math.floor((new Date(i).getTime()-new Date(u).getTime())/(1e3*60*60*24));return s===0?"Today":s===1?"Yesterday":s<7?t.toLocaleDateString(void 0,{weekday:"long"}):u},Sn=function(r){return r.map(function(t){return{key:t.conversation_id,label:t.conversation_id,group:jn(t.created_at),icon:(0,e.jsx)(Ft.Z,{}),timestamp:new Date(t.created_at).getTime()}})},gr=[{label:"What is BioMiner Indexed Data?",value:"report"},{label:"How to use BioMiner Indexed Data?",value:"draw"},{label:"Any dataset contains RNA-seq, Mutation, and Clinical data for Breast Cancer?",value:"knowledge",icon:(0,e.jsx)(Ot.Z,{}),children:[{label:"Any dataset contains RNA-seq, Mutation, and Clinical data for Breast Cancer?",value:"react"},{label:"Any dataset contains RNA-seq, Mutation, and Clinical data for Breast Cancer?",value:"antd"}]}],Zn=["What can you do for me?"],Cn="Generating content, please wait...",Ve=function(r){return r.replace(/[^a-zA-Z0-9_-]/g,"-")},Ct=function(){return Ve(xt()().format("YYYY-MM-DD HH:mm:ss"))},An=function(r){var t,a=r.copilotOpen,u=r.setCopilotOpen,i=r.style,s=r.onSelectConversation,f=r.className,j=(0,g.useRef)(null),L=(0,g.useRef)(null),y=(0,g.useRef)(!1),v=(0,g.useCallback)(function(){if(L.current){y.current=!0;var l=new Promise(function(n){var d;(d=L.current)===null||d===void 0||d.abort(),n()});l.catch(function(n){(n==null?void 0:n.name)==="AbortError"?console.debug("AbortError caught in safeAbort"):console.error("Unexpected error in safeAbort:",n)}),setTimeout(function(){y.current=!1},100)}},[]);(0,g.useEffect)(function(){var l=function(d){var m;((m=d.reason)===null||m===void 0?void 0:m.name)==="AbortError"&&(d.preventDefault(),console.debug("Handled AbortError globally"))};return window.addEventListener("unhandledrejection",l),function(){window.removeEventListener("unhandledrejection",l)}},[]);var Z=(0,g.useState)([]),N=T()(Z,2),U=N[0],k=N[1],X=(0,g.useState)(null),Ce=T()(X,2),w=Ce[0],Qe=Ce[1],ct=(0,g.useState)(null),$e=T()(ct,2),ue=$e[0],de=$e[1],ie=(0,g.useState)([]),We=T()(ie,2),Je=We[0],$=We[1],Ne=(0,g.useState)([]),Xe=T()(Ne,2),Ae=Xe[0],re=Xe[1],se=(0,g.useState)(!1),qe=T()(se,2),be=qe[0],ee=qe[1],_e=(0,g.useState)([]),et=T()(_e,2),Be=et[0],ut=et[1],dt=(0,g.useState)(!1),tt=T()(dt,2),nt=tt[0],ve=tt[1],rt=(0,g.useState)(""),vt=T()(rt,2),Pe=vt[0],we=vt[1],ft=(0,g.useState)([]),fe=T()(ft,2),te=fe[0],De=fe[1],ht=(0,g.useState)(new Map),C=T()(ht,2),p=C[0],h=C[1],D=(0,g.useState)(new Map),z=T()(D,2),oe=z[0],q=z[1],ae=function(n){Qe(n),s&&s(n)};(0,g.useEffect)(function(){on().then(function(l){re(l.map(function(n){return I()(I()({},n),{},{uniqueKey:"".concat(n.key,":").concat(n.version)})}))})},[]),(0,g.useEffect)(function(){cn().then(function(l){if(k(Sn(l)),l.length>0){var n=l.sort(function(c,A){return new Date(A.created_at).getTime()-new Date(c.created_at).getTime()}),d=n[0].conversation_id,m=n[0].config;de(m),ae(d)}else ae(Ct())}).catch(function(l){console.error(l),F.ZP.error("Failed to fetch sessions, please try again later.")})},[]),(0,g.useEffect)(function(){if(ue&&ue.dataset_key&&Ae.length>0){var l=Ae.find(function(n){return n.uniqueKey===ue.dataset_key});De(l?[l]:[])}},[ue,Ae]),(0,g.useEffect)(function(){w&&(h(new Map),q(new Map),jt(w).then(function(l){ce(ke(l))}).catch(function(l){console.error(l),F.ZP.error("Failed to fetch chat history, please try again later.")}))},[w]);var Te=(0,Vt.Z)({baseURL:sn(),model:an,dangerouslyApiKey:"Bearer ".concat(ne.E.getToken()||"")}),le=T()(Te,1),V=le[0],Y=V.isRequesting(),Ue=function(n,d){var m=n==="solution"?(0,e.jsx)(E.Z,{color:"green",children:"\u2705 Solution"}):n==="error"?(0,e.jsx)(E.Z,{color:"red",children:"\u26D4 Error"}):n==="thought"?(0,e.jsx)(E.Z,{color:"blue",children:"\u{1F4AD} Thought"}):n==="observation"?(0,e.jsx)(E.Z,{color:"blue",children:"\u{1F440} Observation"}):(0,e.jsx)(E.Z,{color:"blue",children:"\u2139\uFE0F Info"});return(0,e.jsxs)("span",{children:[m," ",d]})},Ee=(0,Yt.Z)({agent:V,requestFallback:function(n,d){var m=d.error;return m.name==="AbortError"?y.current?(y.current=!1,{content:"Request cancelled",role:"assistant"}):{content:"Request is aborted",role:"assistant"}:{content:"Request failed, please try again!",role:"assistant"}},transformMessage:function(n){var d,m=n||{},c=m.originMessage,A=m.chunk,R="",S="",G="".concat(w,"-current");try{if(A!=null&&A.data&&!(A!=null&&A.data.includes("DONE")))try{var W,K=JSON.parse(A==null?void 0:A.data);if(K!=null&&(W=K.choices)!==null&&W!==void 0&&(W=W[0])!==null&&W!==void 0&&W.delta){var Ie=K.choices[0].delta.content||"";if(Ie.includes("[TASK_SUBMITTED]"))return console.log("Received TASK_SUBMITTED"),q(function(ye){return new Map(ye).set(G,!0)}),{content:(c==null?void 0:c.content)||"",role:"assistant"};try{var xe=JSON.parse(Ie);if(xe.message&&xe.message_type)return console.log("Received TaskProgress:",xe.message_type),h(function(ye){var st=new Map(ye);if(xe.message_type==="info"&&xe.message.includes(yn))st.set(G,[xe]);else{var dr=st.get(G)||[];st.set(G,[].concat(Fe()(dr),[xe]))}return st}),{content:(c==null?void 0:c.content)||"",role:"assistant"};R=Ie}catch(ye){R=Ie}S=K.choices[0].delta.reasoning_content||""}}catch(ye){}}catch(ye){console.error("Error in transformMessage:",ye)}var at="";return!(c!=null&&c.content)&&S?at="<think>".concat(S):c!=null&&(d=c.content)!==null&&d!==void 0&&d.includes("<think>")&&!(c!=null&&c.content.includes("</think>"))&&R?at="".concat(c==null?void 0:c.content,"</think>").concat(R):at="".concat((c==null?void 0:c.content)||"").concat(S).concat(R),{content:at,role:"assistant"}},resolveAbortController:function(n){L.current=n}}),Q=Ee.messages,he=Ee.onRequest,ce=Ee.setMessages,pe=function(n){var d;if(w){var m=Ve(w);Promise.resolve(he({stream:!0,message:{content:n,role:"user"},conversation_id:m,config:{dataset_key:te.length>0?te[0].uniqueKey:null}})).catch(function(c){(c==null?void 0:c.name)==="AbortError"?y.current?console.debug("Request aborted intentionally"):console.debug("Request aborted (unexpected)"):console.error("Request error:",c)}),((d=U.find(function(c){return c.key===w}))===null||d===void 0?void 0:d.label)==="New session"&&k(U.map(function(c){return c.key!==w?c:I()(I()({},c),{},{label:n==null?void 0:n.slice(0,20)})}))}},ge=(0,g.useCallback)(function(){var l=B()(b()().mark(function n(d){var m,c,A;return b()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(S.prev=0,w){S.next=3;break}return S.abrupt("return");case 3:return m=Ve(w),S.next=6,un(m,d);case 6:if(c=S.sent,!c.success){S.next=13;break}return F.ZP.success('File "'.concat(c.filename,'" uploaded successfully')),A='File "'.concat(c.filename,'" has been uploaded successfully.'),S.abrupt("return",A);case 13:return F.ZP.error("Failed to upload file: ".concat(c.msg)),S.abrupt("return",void 0);case 15:S.next=22;break;case 17:return S.prev=17,S.t0=S.catch(0),console.error("Upload error:",S.t0),F.ZP.error("Failed to upload file. Please try again."),S.abrupt("return",void 0);case 22:case"end":return S.stop()}},n,null,[[0,17]])}));return function(n){return l.apply(this,arguments)}}(),[w]);(0,g.useEffect)(function(){j.current&&(j.current.upload=ge)},[ge]);var He=function(n,d){Array.from(d).forEach(function(){var m=B()(b()().mark(function c(A){var R;return b()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,ge(A);case 2:R=G.sent;case 3:case"end":return G.stop()}},c)}));return function(c){return m.apply(this,arguments)}}()),ee(!0)},ke=function(n){try{var d=[],m=Me()(n),c;try{for(m.s();!(c=m.n()).done;){var A,R=c.value;if(((A=R.message)===null||A===void 0?void 0:A.role)==="assistant"&&R.task_progress){d.push(R);var S=Me()(R.task_progress),G;try{for(S.s();!(G=S.n()).done;){var W=G.value;d.push(I()(I()({},R),{},{message:I()(I()({},R.message),{},{content:W.message}),isTaskProgress:!0,messageType:W.message_type}))}}catch(K){S.e(K)}finally{S.f()}}else d.push(R)}}catch(K){m.e(K)}finally{m.f()}return console.log("formatMessages: processed",n.length,"messages ->",d.length,"messages"),d}catch(K){return console.error("Error in formatMessages:",K),n||[]}},Ge=(0,e.jsxs)("div",{className:"chat-header",children:[(0,e.jsxs)("div",{className:"header-title",children:["\u2728 AI Copilot",(0,e.jsxs)("div",{className:"header-title-description",children:["[",w,"]"]}),(0,e.jsx)(O.ZP,{danger:!0,size:"small",icon:(0,e.jsx)(Rt.Z,{}),onClick:function(){w&&dn(w).then(function(n){if(n.success){F.ZP.success("Conversation deleted successfully");var d=U.filter(function(c){return c.key!==w}),m=d.sort(function(c,A){return A.timestamp-c.timestamp});k(m),m.length>0?(ae(m[0].key),ce([])):(ae(Ct()),ce([]))}else F.ZP.error("Failed to delete conversation")})},children:"Delete"}),(0,e.jsx)(mn,{})]}),(0,e.jsxs)(mt.Z,{size:0,children:[(0,e.jsx)(O.ZP,{type:"text",icon:(0,e.jsx)(Lt.Z,{}),onClick:function(){if(V.isRequesting()){F.ZP.error("Message is Requesting, you can create a new conversation after request done or abort it right now...");return}if(Q!=null&&Q.length){var n=Ve(xt()().format("YYYY-MM-DD HH:mm:ss"));v(),setTimeout(function(){k([{key:n,label:"New session",group:"Today"}].concat(Fe()(U))),ae(n),ce([]),h(new Map),q(new Map)},100)}else F.ZP.error("It is now a new conversation.")},className:"header-button"}),(0,e.jsx)(Re.Z,{placement:"bottom",style:{maxHeight:600},content:U.length>0?(0,e.jsx)(Qt.Z,{items:U==null?void 0:U.map(function(l){return l.key===w?I()(I()({},l),{},{label:"[Current Session] ".concat(l.label)}):l}),activeKey:w||void 0,groupable:!0,onActiveChange:function(){var l=B()(b()().mark(function n(d){return b()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(d){c.next=2;break}return c.abrupt("return");case 2:v(),setTimeout(function(){ae(d),h(new Map),q(new Map),jt(d).then(function(A){ce(ke(A))}).catch(function(A){console.error(A),F.ZP.error("Failed to fetch chat history, please try again later.")})},100);case 4:case"end":return c.stop()}},n)}));return function(n){return l.apply(this,arguments)}}(),styles:{item:{padding:"0 8px"}},className:"conversations"}):(0,e.jsx)(Ke.Z,{description:"No conversation history"}),children:(0,e.jsx)(O.ZP,{type:"text",icon:(0,e.jsx)(Nt.Z,{}),className:"header-button"})})]})]}),wt=function(n){var d;if(n.isTaskProgress)return{};var m=((d=n.message)===null||d===void 0?void 0:d.role)||n.role;return{icon:m==="user"?(0,e.jsx)(Bt.Z,{color:"blue"}):(0,e.jsx)(Ut.Z,{color:"blue"})}},H=function(n){return n.isTaskProgress?"hidden":"visible"},me=function(n){return n.isTaskProgress},ir=function(){try{var n;if(!Q||Q.length===0)return[];var d=Fe()(Q),m=d.length-1,c=(n=d[m])===null||n===void 0||(n=n.message)===null||n===void 0?void 0:n.role;if(m>=0&&c==="assistant"){var A=d[m],R="".concat(w,"-current"),S=p.get(R)||[];if(S.length>0){console.log("Adding TaskProgress items:",S.length);var G=d.slice(0,m+1),W=S.map(function(K,Ie){return{id:"".concat(A.id,"-progress-").concat(Ie),message:{role:"assistant",content:K.message},status:"success",isTaskProgress:!0,messageType:K.message_type}});d=[].concat(Fe()(G),Fe()(W))}}return d}catch(K){return console.error("Error in getMergedMessages:",K),Q||[]}},lr=(0,e.jsx)("div",{className:"chat-list ".concat(be?"attachments-open":""),children:Q!=null&&Q.length?(0,e.jsx)($t.Z.List,{style:{height:"100%",paddingInline:16},items:((t=ir())===null||t===void 0||(t=t.filter(Boolean))===null||t===void 0?void 0:t.map(function(l){var n=l.message||l,d=l.status==="loading";return I()(I()({},n),{},{content:n.content||"",classNames:{content:d?"loading-message":""},messageRender:me(l)?function(m){return Ue(l.messageType,m)}:function(m){return(0,e.jsx)("span",{id:"copy-message-content-".concat(l.id),children:P(m)})},avatar:wt(l),styles:{avatar:{visibility:H(l)}},footer:me(l)?void 0:function(m,c){return(0,e.jsx)("div",{style:{display:"flex"},children:(0,e.jsx)(O.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Ht.Z,{}),onClick:function(){pn(m,"copy-message-content-".concat(l.id))}})})},loadingRender:function(){return(0,e.jsxs)(mt.Z,{children:[(0,e.jsx)(_t.Z,{size:"small"}),Cn]})},variant:me(l)?"outlined":"filled",typing:d?{step:5,interval:20,suffix:(0,e.jsx)(e.Fragment,{children:"\u{1F497}"})}:!1})}))||[],roles:{user:{placement:"end"}}}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Wt.Z,{variant:"borderless",title:"\u{1F44B} Hello, I'm BioMiner Indexed Agent",description:"I'm a AI agent that can help you to find the most relevant data from BioMiner Indexed Data and answer your questions.",className:"chat-welcome"}),(0,e.jsx)(Jt.Z,{vertical:!0,title:"I can help\uFF1A",items:Zn.map(function(l){return{key:l,description:l}}),onItemClick:function(n){var d;return pe(n==null||(d=n.data)===null||d===void 0?void 0:d.description)},style:{marginInline:16},styles:{title:{fontSize:14}}})]})}),cr=(0,e.jsx)(gt.Z.Header,{title:"Upload File",styles:{content:{padding:0}},open:be,onOpenChange:ee,forceRender:!0,children:(0,e.jsx)(Xt.Z,{ref:j,beforeUpload:function(n){return ge(n),!1},items:Be,onChange:function(n){var d=n.fileList;return ut(d)},placeholder:function(n){return n==="drop"?{title:"Drop file here"}:{icon:(0,e.jsx)(Gt.Z,{}),title:"Upload files",description:"Click or drag files to this area to upload"}}})}),ur=(0,e.jsxs)("div",{className:"chat-send",children:[(0,e.jsxs)("div",{className:"send-action",children:[(0,e.jsx)(ze.Z,{title:"If a dataset is selected, the `upload file` function will not be available.",children:(0,e.jsxs)(O.ZP,{type:"default",icon:(0,e.jsx)(Kt.Z,{}),onClick:function(){if(Be.length>0){F.ZP.error("If you want to select a dataset, please clear the uploaded files first.");return}else ve(!0)},children:["Select Dataset ",(0,e.jsx)(E.Z,{color:"blue",children:te.length>0?"".concat(te[0].uniqueKey):"N/A"})]})}),(0,e.jsx)(O.ZP,{disabled:!0,icon:(0,e.jsx)(Oe.Z,{}),onClick:function(){return pe("What component assets are available in Ant Design X?")},children:"Download History"})]}),(0,e.jsx)(qt.Z,{block:!0,items:Je,onSelect:function(n){return we("[".concat(n,"]:"))},children:function(n){var d=n.onTrigger,m=n.onKeyDown;return(0,e.jsx)(gt.Z,{loading:Y,value:Pe,onChange:function(A){we(A)},onSubmit:function(){pe(Pe),we("")},onCancel:function(){w&&fn(w).then(function(A){F.ZP.success("Task cancelled successfully")}).catch(function(A){console.error("Failed to cancel task:",A),F.ZP.error("Failed to cancel task"),v()})},allowSpeech:!0,placeholder:"Ask or input / use skills",onKeyDown:m,onFocus:function(){},onBlur:function(){},onKeyPress:function(){},header:cr,prefix:(0,e.jsx)(ze.Z,{title:"If any files are uploaded, the dataset selection will not be available.",children:(0,e.jsx)(O.ZP,{type:"text",icon:(0,e.jsx)(zt.Z,{style:{fontSize:18}}),onClick:function(){if(te.length>0){F.ZP.error("If you want to upload files, please clear the dataset selection first.");return}else ee(!be)}})}),onPasteFile:He,actions:function(A,R){var S=R.components,G=S.SendButton,W=S.LoadingButton,K=S.SpeechButton;return(0,e.jsx)("div",{style:{display:"flex",alignItems:"center",gap:4},children:Y?(0,e.jsx)(W,{type:"default"}):(0,e.jsx)(G,{type:"primary"})})}})}})]});return(0,e.jsxs)(je.Z,{className:"copilot-chat ".concat(f),style:i,title:Ge,children:[lr,ur,(0,e.jsx)(en.Z,{open:nt,onCancel:function(){return ve(!1)},footer:(0,e.jsx)(O.ZP,{type:"default",onClick:function(){De([]),ve(!1)},children:"Clear Selection"}),destroyOnHidden:!0,title:null,width:"80%",children:(0,e.jsx)(xn.default,{onSelectDataset:function(n){var d;De([I()(I()({},n),{},{uniqueKey:"".concat(n.key,":").concat(n.version),license:(d=n.license)!==null&&d!==void 0?d:null})]),ve(!1)},style:{height:"calc(100vh - 200px)",overflow:"auto"},defaultSelectedDataset:te[0]})})]})},bn=An,Se=o(15746),Ze=o(71230),Pn=o(82494),wn=o(74209),Dn=o(8751),Tn=o(79090),it=o(61727),En=o(89035),kn=o(61086),In=o(66212),Mn=o(53971),Fn=o(8913),On=o(58638),Rn=o(57546),Ln=o(30481),Nn=o(97245),Bn=o(38437),At=o(18963),Le=o(26412),Un=M.Z.Title,Hn=M.Z.Paragraph,Gn=function(r){var t=r.explanationData,a=r.conversationId;if(!t)return null;var u=function(Z,N){var U=N.startsWith("results/")?N:"results/".concat(N);return"".concat(J(),"/v1/files/download/").concat(Z,"?filepath=").concat(U)},i=t.completion_status,s=t.total_files,f=t.reason,j=t.summary,L=t.key_findings,y=t.files;return(0,e.jsxs)("div",{style:{padding:0,height:"100%"},children:[(0,e.jsxs)(Ze.Z,{justify:"space-between",align:"middle",className:"explanation-header",children:[(0,e.jsx)(Un,{level:4,style:{margin:"16px 0"},children:"Explanation"}),(0,e.jsxs)("div",{children:[(0,e.jsxs)(E.Z,{color:i==="complete"?"green":"orange",children:["Completion: ",i]}),(0,e.jsxs)(E.Z,{color:"blue",children:["Files: ",s]})]})]}),(0,e.jsxs)(Ze.Z,{className:"explanation-content",style:{height:"calc(100% - 60px)",overflow:"auto"},children:[(0,e.jsx)(Bn.Z,{message:"Warning",description:f,type:"warning",showIcon:!0,style:{marginBottom:24,width:"100%"}}),(0,e.jsx)(je.Z,{title:"Summary",style:{marginBottom:16,width:"100%"},children:(0,e.jsx)(Hn,{style:{padding:16,margin:0},children:j})}),(0,e.jsx)(je.Z,{title:"Key Findings",style:{marginBottom:24,width:"100%"},children:(0,e.jsx)("ul",{children:L.map(function(v,Z){return(0,e.jsx)("li",{children:v},Z)})})}),(0,e.jsx)(Ze.Z,{gutter:[16,16],children:y.map(function(v,Z){return(0,e.jsx)(Se.Z,{span:24,children:(0,e.jsxs)(je.Z,{title:v.name,children:[v.mime_type.startsWith("image/")?(0,e.jsx)(At.Z,{src:u(a,v.filepath),alt:v.name,style:{maxWidth:"600px",margin:"16px 0"}}):(0,e.jsx)(O.ZP,{type:"primary",icon:(0,e.jsx)(Oe.Z,{}),href:u(a,v.filepath),download:!0,children:"Download File"}),(0,e.jsxs)(Le.Z,{column:1,bordered:!0,size:"small",children:[(0,e.jsx)(Le.Z.Item,{label:"Purpose",children:v.purpose}),(0,e.jsx)(Le.Z.Item,{label:"Description",children:v.description}),(0,e.jsx)(Le.Z.Item,{label:"Key Insights",children:v.key_insights}),(0,e.jsx)(Le.Z.Item,{label:"Generated By",children:v.generated_by})]})]})},Z)})})]})]})},Kn=Gn,zn=o(45699),Vn=o(49354),Yn=o(97175),Qn=o(27461),$n=o(15360),Wn=o(90044),Jn=o(57460),Xn=o.n(Jn),qn=function(r){var t=r.fileUrl,a=r.fileType,u=(0,g.useState)(""),i=T()(u,2),s=i[0],f=i[1];(0,g.useEffect)(function(){fetch(t).then(function(v){return v.text()}).then(f)},[t]);var j=(0,g.useMemo)(function(){var v,Z=a==="tsv"?"	":",",N=Xn().parse(s,{header:!0,delimiter:Z,skipEmptyLines:!0}),U=((v=N.meta.fields)===null||v===void 0?void 0:v.map(function(X){return{name:X,selector:function(w){return w[X]},sortable:!0,wrap:!0}}))||[],k=N.data;return{columns:U,data:k}},[s,a]),L=j.columns,y=j.data;return(0,e.jsx)(Wn.ZP,{title:"",columns:L,data:y,pagination:!0,dense:!0,highlightOnHover:!0,responsive:!0,striped:!0})},_n=qn,bt=M.Z.Text,Ye=function(r,t){var a=t.startsWith("results/")?t:"results/".concat(t);return"".concat(J(),"/v1/files/download/").concat(r,"?filepath=").concat(a)},er=function(r){var t=r.files,a=r.conversationId,u=function(v){var Z,N=(Z=v.name.split(".").pop())===null||Z===void 0?void 0:Z.toLowerCase();switch(N){case"png":case"jpg":case"jpeg":case"webp":case"gif":case"svg":case"tiff":return(0,e.jsx)(zn.Z,{});case"pdf":return(0,e.jsx)(Vn.Z,{});case"csv":case"tsv":case"txt":return(0,e.jsx)(Yn.Z,{});case"zip":case"tar":case"gz":case"bz2":case"rar":case"7z":return(0,e.jsx)(Qn.Z,{});default:return(0,e.jsx)($n.Z,{})}},i=function(v){return v.mime_type.startsWith("image/")},s=function(v){return v.mime_type==="application/pdf"},f=function(v){var Z,N=(Z=v.name.split(".").pop())===null||Z===void 0?void 0:Z.toLowerCase();return["csv","tsv","txt"].includes(N||"")},j=function(v){var Z=document.createElement("a");Z.href=Ye(a,v.filepath),Z.download=v.name,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z)};if(!t||t.length===0)return null;var L=function(v){if(i(v))return(0,e.jsx)(At.Z,{src:Ye(a,v.filepath),alt:v.name,style:{width:"100%",maxHeight:200,objectFit:"contain"},fallback:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMIAAADDCAYAAADQvc6UAAABRWlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSSwoyGFhYGDIzSspCnJ3UoiIjFJgf8LAwSDCIMogwMCcmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsis7PPOq3QdDFcvjV3jOD1boQVTPQrgSkktTgbSf4A4LbmgqISBgTEFyFYuLykAsTuAbJEioKOA7DkgdjqEvQHEToKwj4DVhAQ5A9k3gGyB5IxEoBmML4BsnSQk8XQkNtReEOBxcfXxUQg1Mjc0dyHgXNJBSWpFCYh2zi+oLMpMzyhRcASGUqqCZ16yno6CkYGRAQMDKMwhqj/fAIcloxgHQqxAjIHBEugw5sUIsSQpBobtQPdLciLEVJYzMPBHMDBsayhILEqEO4DxG0txmrERhM29nYGBddr//5/DGRjYNRkY/l7////39v///y4Dmn+LgeHANwDrkl1AuO+pmgAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAwqADAAQAAAABAAAAwwAAAAD9b/HnAAAHlklEQVR4Ae3dP3Ik1RnG4W+FgYxN"});if(s(v))return(0,e.jsx)("object",{data:Ye(a,v.filepath),type:"application/pdf",width:"100%",height:"400px",style:{maxHeight:"800px"},children:(0,e.jsx)(O.ZP,{type:"primary",icon:(0,e.jsx)(Oe.Z,{}),onClick:function(){return j(v)},children:"Download"})});if(f(v)){var Z;return(0,e.jsx)(_n,{fileUrl:Ye(a,v.filepath),fileType:(Z=v.name.split(".").pop())===null||Z===void 0?void 0:Z.toLowerCase()})}return(0,e.jsx)("div",{style:{textAlign:"center",padding:"20px 0"},children:(0,e.jsx)(O.ZP,{type:"primary",icon:(0,e.jsx)(Oe.Z,{}),onClick:function(){return j(v)},children:"Download"})})};return(0,e.jsx)(Ze.Z,{gutter:[16,16],style:{marginTop:16},children:t.map(function(y,v){return(0,e.jsx)(Se.Z,{xs:24,sm:24,md:24,lg:24,children:(0,e.jsx)(je.Z,{className:"result-files-card",size:"small",title:(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[u(y),(0,e.jsx)(bt,{ellipsis:{tooltip:y.name},style:{flex:1},children:y.name}),(0,e.jsxs)(bt,{type:"secondary",style:{fontSize:"12px"},children:[(y.size/1024).toFixed(1)," KB"]})]}),extra:(0,e.jsx)(O.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Oe.Z,{}),onClick:function(){return j(y)}}),children:L(y)})},v)})})},lt=er,_=M.Z.Paragraph,mr=M.Z.Text,tr=function(r){if(r==="success")return(0,e.jsx)(Dn.Z,{});if(r==="error")return(0,e.jsx)(St.Z,{});if(r==="pending")return(0,e.jsx)(Tn.Z,{})},xr=function(r,t){var a=r.split(`
`),u={},i=/^[0-9]+\. \[(.)\] \(([^)]+)\)/,s=_createForOfIteratorHelper(a),f;try{for(s.s();!(f=s.n()).done;){var j=f.value,L=j.match(i);if(L){var y=L[1],v=L[2];y==="\u2713"?u[v]="success":y==="\u2717"?u[v]="error":y==="-"&&t?u[v]="success":u[v]="pending"}}}catch(Z){s.e(Z)}finally{s.f()}return u},nr=function(r){var t={},a=Me()(r.steps),u;try{for(a.s();!(u=a.n()).done;){var i=u.value;t[i.id]=i.status==="done"?"success":i.status==="failed"?"error":"pending"}}catch(s){a.e(s)}finally{a.f()}return t},yr=function(r,t){var a=r.split(`
`),u=_createForOfIteratorHelper(a),i;try{for(u.s();!(i=u.n()).done;){var s=i.value,f=s.match(/^[0-9]+\. \[[âœ“âœ—\-]\] \(([^)]+)\) (.+)/);if(f){var j=f[1],L=f[2];if(j===t)return"[".concat(j,"] ").concat(L)}}}catch(y){u.e(y)}finally{u.f()}return t},rr=function(r,t){var a=Me()(r.steps),u;try{for(a.s();!(u=a.n()).done;){var i=u.value;if(i.id===t)return i.title}}catch(s){a.e(s)}finally{a.f()}return t},ar=function(r,t,a,u){var i=t[r];if(console.log("status",i,"timestamp",u),i==="pending"&&u){var s=new Date().getTime(),f=s-new Date(u).getTime();if(f>1e3*60*10)return"error"}return i||a},Pt=function(r){return r.toLocaleString("en-US",{minimumFractionDigits:0})},sr=function(){var r=(0,g.useState)(null),t=T()(r,2),a=t[0],u=t[1],i=(0,g.useState)(new Map),s=T()(i,2),f=s[0],j=s[1],L=(0,g.useState)(null),y=T()(L,2),v=y[0],Z=y[1],N=(0,g.useState)(null),U=T()(N,2),k=U[0],X=U[1],Ce=(0,g.useState)([]),w=T()(Ce,2),Qe=w[0],ct=w[1],$e=(0,g.useState)("code"),ue=T()($e,2),de=ue[0],ie=ue[1],We=(0,g.useState)(null),Je=T()(We,2),$=Je[0],Ne=Je[1],Xe=(0,g.useState)(!0),Ae=T()(Xe,2),re=Ae[0],se=Ae[1],qe=(0,g.useState)(null),be=T()(qe,2),ee=be[0],_e=be[1],et=(0,g.useState)([]),Be=T()(et,2),ut=Be[0],dt=Be[1],tt=(0,g.useState)(!0),nt=T()(tt,2),ve=nt[0],rt=nt[1],vt={expandedKeys:ut,onExpand:function(p){console.log("onExpand",p),dt(p)}};(0,g.useEffect)(function(){if(a){yt(a).then(function(p){_e(p)});var C=setInterval(function(){yt(a).then(function(p){_e(p)})},5e3);return function(){return clearInterval(C)}}},[a]),(0,g.useEffect)(function(){var C=!1,p=!1,h=null,D=0,z=5;function oe(){return q.apply(this,arguments)}function q(){return q=B()(b()().mark(function Te(){var le,V,Y,Ue,Ee,Q,he,ce,pe,ge,He,ke,Ge;return b()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(!(p||C||!a)){H.next=2;break}return H.abrupt("return");case 2:return p=!0,H.prev=3,H.next=6,ln(a);case 6:V=H.sent,Y=new Map,Ue="all_steps",Ee="All Steps",console.log("Processing all steps:",V.length),Y.set(Ue,V),Q=[{promptHash:Ue,label:Ee,task_prompt:((le=V[0])===null||le===void 0?void 0:le.task_prompt)||"All steps"}],console.log("groupedSteps",Y),console.log("Final tabList will be updated with",Array.from(Y.keys()).length,"groups"),console.log("New tabList:",Q),he=Me()(Y);try{for(he.s();!(ce=he.n()).done;)pe=T()(ce.value,2),ge=pe[0],He=pe[1],console.log("Group ".concat(ge," has ").concat(He.length," steps:"),He.map(function(me){return me.step_id}))}catch(me){he.e(me)}finally{he.f()}C||(j(Y),ct(Q),Y.size>0&&!$&&(ke=Array.from(Y.keys())[0],console.log("Setting currentGroup to:",ke),Ne(ke)),Y.size>0&&$&&!Y.has($)&&(Ge=Array.from(Y.keys())[0],console.log("Resetting currentGroup to:",Ge,"because",$,"not found"),Ne(Ge))),D=0,H.next=27;break;case 22:H.prev=22,H.t0=H.catch(3),D++,console.error("Poll steps error (".concat(D,"/").concat(z,"):"),H.t0),D>=z?(console.error("Too many polling errors, stopping polling"),C=!0,h&&(clearInterval(h),h=null)):C||console.warn("Polling failed, will retry in next interval");case 27:return H.prev=27,p=!1,H.finish(27);case 30:case"end":return H.stop()}},Te,null,[[3,22,27,30]])})),q.apply(this,arguments)}function ae(){C||(oe(),h=setInterval(function(){C||oe()},5e3))}return a&&ae(),function(){C=!0,p=!1,h&&(clearInterval(h),h=null)}},[a]);var Pe=function(p){var h=p.steps.map(function(D){return"[".concat(D.status==="done"?"\u2713":D.status==="failed"?"\u2717":"-","] (").concat(D.id,") ").concat(D.title," (").concat(D.status,")")});return h.join(`
`)},we=(0,g.useCallback)(function(C){console.log("thoughtChainItems called with groupName:",C,"steps size:",f.size,"current steps:",f.get(C));var p=f.get(C);return!p||p.length===0?(console.log("No steps found for group:",C),[]):p.map(function(h,D){var z=p[D+1]?p[D+1].plan:h.plan,oe=h.step_id,q=h.success?"success":h.error?"error":"pending",ae=nr(z||{steps:[],next_step_id:""}),Te=ar(oe,ae,q,h.timestamp);return{key:oe+D.toString(),title:rr(z||{steps:[],next_step_id:""},oe),status:Te,description:(0,e.jsxs)("span",{children:[h.thought&&(0,e.jsx)(E.Z,{color:"blue",children:"Thought"}),h.solution&&(0,e.jsx)(E.Z,{color:"green",children:"Solution"}),h.observation&&(0,e.jsx)(E.Z,{color:"red",children:"Observation"})]}),icon:tr(Te),extra:(0,e.jsxs)(Se.Z,{style:{display:"flex",flexDirection:"row",gap:"8px"},children:[(0,e.jsx)(Re.Z,{title:"Show Plan",content:(0,e.jsx)(M.Z,{style:{width:"500px",maxHeight:"500px",overflow:"auto",padding:"8px"},children:(0,e.jsx)(_,{children:P==null?void 0:P(Pe(h.plan||{steps:[],next_step_id:""})||"No plan")})}),children:(0,e.jsx)(O.ZP,{icon:(0,e.jsx)(it.Z,{}),onClick:function(V){X(h),se(!1),ie("plan"),V.stopPropagation()},children:re?"Show Plan":""})}),h.execution_code&&(0,e.jsx)(Re.Z,{title:"Show Code",content:(0,e.jsx)(M.Z,{style:{width:"500px",maxHeight:"500px",overflow:"auto",padding:"8px"},children:(0,e.jsx)(_,{children:P==null?void 0:P("```python\n".concat(h.execution_code,"\n```")||0)})}),children:(0,e.jsx)(O.ZP,{icon:(0,e.jsx)(En.Z,{}),onClick:function(V){X(h),se(!1),ie("code"),V.stopPropagation()},children:re?"Show Code":""})}),h.observation&&(0,e.jsx)(Re.Z,{title:"Show Result",content:(0,e.jsxs)(M.Z,{style:{width:"500px",maxHeight:"500px",overflow:"auto",padding:"8px"},children:[(0,e.jsx)(_,{children:P==null?void 0:P(h.observation||"No observation")}),(0,e.jsx)(lt,{files:h.generated_files||[],conversationId:a||""})]}),children:(0,e.jsx)(O.ZP,{icon:(0,e.jsx)(kn.Z,{}),onClick:function(V){X(h),se(!1),ie("observation"),V.stopPropagation()},children:re?"Show Result":""})})]}),content:(0,e.jsxs)(M.Z,{children:[(0,e.jsxs)(_,{children:[(0,e.jsx)(E.Z,{color:"blue",children:"Thought"})," ",(0,e.jsx)("br",{}),(0,e.jsx)("div",{className:"content-box",children:P==null?void 0:P(h.thought||"No thought")})]}),h.solution&&(0,e.jsxs)(_,{children:[(0,e.jsx)(E.Z,{color:"green",children:"Solution"})," ",(0,e.jsx)("br",{}),(0,e.jsx)("div",{className:"content-box",children:P==null?void 0:P(h.solution||"No solution")})]}),h.observation&&(0,e.jsxs)(_,{children:[(0,e.jsx)(E.Z,{color:"red",children:"Observation"}),(h==null?void 0:h.execution_time)!=null&&(0,e.jsxs)(E.Z,{color:"blue",icon:(0,e.jsx)(In.Z,{}),style:{marginLeft:"8px"},children:[h.execution_time.toFixed(3)," s"]}),(h==null?void 0:h.memory_usage)!=null&&(0,e.jsxs)(E.Z,{color:"green",icon:(0,e.jsx)(Mn.Z,{}),style:{marginLeft:"8px"},children:[h.memory_usage.toFixed(3)," MB"]}),(0,e.jsx)("br",{}),(0,e.jsxs)("div",{className:"content-box",children:[P==null?void 0:P(h.observation||"No observation"),(0,e.jsx)(lt,{files:h.generated_files||[],conversationId:a||""})]})]})]})}})},[f,re,a]),ft=(0,g.useCallback)(function(C){var p;return C?(p=f.get(C))===null||p===void 0||(p=p[f.get(C).length-1])===null||p===void 0?void 0:p.plan:null},[f]),fe=(0,g.useCallback)(function(){return(0,e.jsx)(O.ZP,{icon:(0,e.jsx)(Fn.Z,{}),onClick:function(){se(!0)},size:"small",style:{position:"absolute",right:"10px",top:"10px"},children:"Close"})},[]),te=500,De=(0,g.useCallback)(function(){console.log("getGroups called, steps size:",f.size,"currentGroup:",$),console.log("All step keys:",Array.from(f.keys())),console.log("Current tabList:",Qe);var C=Array.from(f.keys()).map(function(p,h){var D,z=f.get(p);console.log("Group ".concat(p,":"),z==null?void 0:z.length,"steps");var oe=(z==null||(D=z[0])===null||D===void 0?void 0:D.task_prompt)||"No prompt",q=p==="all_steps"?"All Steps":"Task ".concat(p.slice(0,8));return{key:p,label:(0,e.jsx)(ze.Z,{title:oe,placement:"top",children:(0,e.jsx)(E.Z,{color:"blue",children:q})}),children:(0,e.jsx)(wn.Z,{items:we(p)},"children-".concat(p))}});return console.log("Generated groups count:",C.length),C},[f,Qe,we,$]);console.log("ChatbotContainer render - selectedConversationId:",a,"steps size:",f.size,"currentGroup:",$);var ht=function(p){return p&&p.input_tokens>=0&&p.output_tokens>=0&&p.estimated_cost>0};return(0,e.jsxs)(Ze.Z,{className:"chatbot-container",children:[(0,e.jsx)(bn,{className:"chatbot-container-left",copilotOpen:!0,setCopilotOpen:function(){},style:{flex:"1 1 ".concat(te,"px"),minWidth:"".concat(te,"px")},onSelectConversation:function(p){u(p),X(null),ie("code")}}),(0,e.jsx)(je.Z,{className:"chatbot-container-right",title:(0,e.jsxs)("span",{style:{display:"flex",flexDirection:"row",gap:"8px",alignItems:"center"},children:["Code & Tool Executor",ee&&ht(ee)&&(0,e.jsxs)(O.ZP,{danger:!0,children:[(0,e.jsxs)("span",{children:[ee.provider," | ",ee.model]}),"|",(0,e.jsxs)("span",{style:{marginRight:"4px"},children:[(0,e.jsx)(On.Z,{})," In: ",Pt(ee.input_tokens)]}),"|",(0,e.jsxs)("span",{style:{margin:"0 4px"},children:[(0,e.jsx)(Rn.Z,{})," Out: ",Pt(ee.output_tokens)]}),"|",(0,e.jsxs)("span",{children:[(0,e.jsx)(Ln.Z,{})," $",ee.estimated_cost.toFixed(3)]})]})]}),style:{flex:"3 1 ".concat(te,"px"),minWidth:"".concat(te,"px")},extra:(0,e.jsxs)(Se.Z,{className:"chatbot-container-right-extra",children:[(0,e.jsx)(Re.Z,{content:(0,e.jsx)(M.Z,{style:{width:"500px",maxHeight:"500px",overflow:"auto",padding:"8px"},children:(0,e.jsx)(_,{children:P==null?void 0:P(Pe(ft($)||{steps:[],next_step_id:""})||"No plan")})}),children:(0,e.jsx)(O.ZP,{type:"primary",icon:(0,e.jsx)(it.Z,{}),children:"Show Latest Plan"})}),(0,e.jsx)(O.ZP,{type:"primary",danger:!0,icon:(0,e.jsx)(Nn.Z,{}),onClick:B()(b()().mark(function C(){var p;return b()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(ve){D.next=6;break}return Z(null),rt(!0),se(!0),ie("code"),D.abrupt("return");case 6:if(a){D.next=9;break}return F.ZP.warning("Please select a session to view the chat history."),D.abrupt("return");case 9:return D.next=11,vn(a,$||"");case 11:p=D.sent,p?(F.ZP.success("Explanations fetched successfully"),Z(p),se(!1),ie("explanations"),rt(!1)):F.ZP.warning("No explanations generated until now");case 13:case"end":return D.stop()}},C)})),children:ve?"Show Explanations":"Hide Explanations"}),(0,e.jsx)(O.ZP,{icon:(0,e.jsx)(it.Z,{}),style:{marginLeft:"8px",display:"none"},onClick:B()(b()().mark(function C(){return b()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:se(!re);case 1:case"end":return h.stop()}},C)})),children:re?"Show Result Panel":"Hide Result Panel"})]}),children:a?f.get($||"")&&f.get($||"").length>0?(0,e.jsxs)(Ze.Z,{className:"executor-container",children:[(0,e.jsx)(Se.Z,{span:re?24:12,className:"executor-container-right",children:(0,e.jsx)(Pn.Z,{items:De(),onChange:function(p){console.log("Tab changed to:",p),Ne(p)},activeKey:$||Array.from(f.keys())[0],type:"card",size:"small"})}),(0,e.jsx)(Se.Z,{span:re?0:12,className:"executor-container-left",children:de==="explanations"&&v?(0,e.jsx)(Kn,{explanationData:v,conversationId:a||""}):k?(0,e.jsxs)(M.Z,{className:"executor-container-left-bottom-content",children:[de==="code"&&(0,e.jsxs)(M.Z,{children:[(0,e.jsxs)(M.Z.Title,{level:5,children:["Code ",(0,e.jsx)(E.Z,{color:"grey",children:k.step_id}),fe()]}),(0,e.jsx)(_,{className:"executor-container-left-bottom-content-code",children:P==null?void 0:P("```python\n".concat(k.execution_code,"\n```")||0)})]}),de==="observation"&&(0,e.jsxs)(M.Z,{children:[(0,e.jsxs)(M.Z.Title,{level:5,children:["Observation ",(0,e.jsx)(E.Z,{color:"red",children:k.step_id}),fe()]}),(0,e.jsx)(_,{children:P==null?void 0:P(k.observation||k.solution||"No observation or solution")}),k.generated_files&&k.generated_files.length>0&&(0,e.jsx)(lt,{files:k.generated_files,conversationId:a})]}),de==="solution"&&(0,e.jsxs)(M.Z,{children:[(0,e.jsxs)(M.Z.Title,{level:5,children:["Solution ",(0,e.jsx)(E.Z,{color:"green",children:k.step_id}),fe()]}),(0,e.jsx)(_,{children:P==null?void 0:P(k.solution||"No solution")})]}),de==="plan"&&(0,e.jsxs)(M.Z,{children:[(0,e.jsxs)(M.Z.Title,{level:5,children:["Plan ",(0,e.jsx)(E.Z,{color:"blue",children:k.step_id}),fe()]}),(0,e.jsx)(_,{children:P==null?void 0:P(Pe(k.plan||{steps:[],next_step_id:""})||"No plan in current step")})]})]}):(0,e.jsx)(Ke.Z,{description:"Please select a step to view the code or results.",style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"}})})]}):(0,e.jsx)(Ke.Z,{description:"Please ask me anything and wait for the answer. It might take a while after the task is submitted.",style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"}}):(0,e.jsx)(Ke.Z,{description:"Please select a session to view the chat history.",style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"}})})]})},or=sr},98027:function(){}}]);
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="c6c0733f-1b79-53ff-a44d-547197dce6ec")}catch(e){}}();
//# debugId=c6c0733f-1b79-53ff-a44d-547197dce6ec
