"use strict";(self.webpackChunkbiominer_indexd_studio=self.webpackChunkbiominer_indexd_studio||[]).push([[5524],{77281:function(Qr,wa,f){f.r(wa),f.d(wa,{default:function(){return Pr},downloadTSV:function(){return ea}});var pn=f(9783),je=f.n(pn),yn=f(15009),Kt=f.n(yn),gn=f(99289),Ca=f.n(gn),xn=f(19632),ge=f.n(xn),bn=f(97857),u=f.n(bn),jn=f(5574),v=f.n(jn),s=f(67294),Te=f(2453),Sn=f(74330),ka=f(38437),wn=f(26410),Qe=f(21931),Mt=f(85418),ie=f(83622),Me=f(83062),it=f(89593),Et=f(82494),Je=f(71230),ht=f(15746),Qt=f(66309),et=f(42075),yt=f(28248),Cn=f(79559),tt=f(83170),gt=f(94272),Ot=f(56717),kn=f(57619),Za=f(43425),Zn=f(55102),za=f(84567),e=f(85893),oa=function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6;return n.filter(function(r){return r.order<=5}).map(function(r){return r.key}).slice(0,i)},sa=500,Jt=10,zn=function(n){var i=n.className,r=n.title,l=n.fields,j=n.selectedKeys,p=n.onChange,b=n.mode,m=b===void 0?"multiple":b,z=(0,s.useState)(""),R=v()(z,2),t=R[0],M=R[1],fe=(0,s.useState)(j),y=v()(fe,2),g=y[0],H=y[1],o=(0,s.useState)(!1),Z=v()(o,2),ae=Z[0],Y=Z[1],W=(0,s.useMemo)(function(){return l.filter(function(O){return O.name.toLowerCase().includes(t.toLowerCase())})},[t,l]),K=(0,s.useMemo)(function(){return W.slice(0,sa)},[W]),q=function(F,V){H(m==="single"?[F]:V?[].concat(ge()(g),[F]):g.filter(function(h){return h!==F}))},A=function(){if(j.length===l.length||j.length>=Jt)H(oa(l));else{var F=l.map(function(V){return V.key}).slice(0,Jt);H(F)}},_=(0,e.jsxs)("div",{style:{padding:8,width:400,backgroundColor:"white",borderRadius:8,border:"1px solid #d9d9d9"},children:[(0,e.jsxs)("div",{style:{marginBottom:8,display:"flex",gap:8},children:[m==="multiple"?(0,e.jsx)(Me.Z,{title:"".concat(l.length," columns in total, Allow up to select ").concat(Jt," columns"),children:(0,e.jsx)(ie.ZP,{size:"small",onClick:A,children:j.length===l.length?"Reset to default":"Select all (max ".concat(Jt," | ").concat(l.length," in total)")})}):(0,e.jsx)(Me.Z,{title:"".concat(l.length," columns in total, Allow up to select one column"),children:(0,e.jsx)(ie.ZP,{size:"small",children:"".concat(l.length," columns in total")})}),(0,e.jsx)(Zn.Z.Search,{placeholder:"Search...",size:"small",allowClear:!0,onChange:function(F){return M(F.target.value)},style:{flex:1}})]}),(0,e.jsxs)("div",{className:"column-selector-header",style:{fontWeight:"bold",display:"flex",padding:"4px 0"},children:[(0,e.jsx)("div",{style:{flex:1},children:"Name"}),(0,e.jsx)("div",{style:{width:50,textAlign:"right"},children:"Freq"})]}),(0,e.jsxs)("div",{style:{maxHeight:240,overflowY:"auto"},children:[K.map(function(O){return(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"2px 0"},children:[(0,e.jsxs)(za.Z,{checked:g.includes(O.key),onChange:function(V){return q(O.key,V.target.checked)},style:{flex:1},children:[O.name,(0,e.jsx)(Me.Z,{title:O.description||O.name,children:(0,e.jsx)(Ot.Z,{style:{marginLeft:4}})})]}),(0,e.jsx)("div",{style:{width:50,textAlign:"right",fontSize:12,color:"#888"},children:(0,e.jsx)(kn.Z,{})})]},O.key)}),W.length>sa&&(0,e.jsxs)("div",{style:{padding:"8px 0",textAlign:"center",color:"#888",fontSize:12},children:["Showing ",sa," of ",W.length," fields. Use search to find more."]})]}),(0,e.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,e.jsx)(ie.ZP,{type:"primary",onClick:function(){p(g),Y(!1),M("")},style:{marginTop:8},children:"Apply"})})]});return(0,e.jsx)(Mt.Z,{overlay:_,trigger:["click"],open:ae,onOpenChange:Y,children:(0,e.jsx)(ie.ZP,{icon:(0,e.jsx)(Za.Z,{}),className:"".concat(i),children:r!=null?r:"Select Columns"})})},Na=zn,Nn=f(52677),Pa=f.n(Nn),Da=["purple","green","geekblue","volcano","cyan","magenta"],Pn=function(n){return Pa()(n)==="object"&&"field"in n&&"value"in n},Dn=function(n,i,r,l){var j,p="";Array.isArray(n.value)?p=n.value.join(", "):p="".concat(n.value);var b=(j=l.find(function(m){return m.key===n.field}))===null||j===void 0?void 0:j.name;return(0,e.jsxs)(Qt.Z,{color:i,style:{marginBottom:0,marginRight:0,borderRadius:5},children:[(0,e.jsx)("strong",{children:b})," ",n.operator," ",(0,e.jsx)("strong",{children:p})]},r)},Rn=function de(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,l=Da[i%Da.length];return(0,e.jsxs)(et.Z,{size:[8,4],style:{marginBottom:0,height:"100%",overflowX:"scroll"},children:[(0,e.jsx)("span",{style:{marginRight:4,color:"#999"},children:"("}),n.items&&n.items.length>0&&n.items.map(function(j,p){return(0,e.jsxs)(s.Fragment,{children:[Pn(j)?Dn(j,l,p,r):de(j,i+1,r),p!==n.items.length-1&&(0,e.jsx)("span",{style:{margin:"0 6px",color:"#666",fontWeight:500,fontSize:13},children:n.operator.toUpperCase()})]},p)}),(0,e.jsx)("span",{style:{marginLeft:4,color:"#999"},children:")"})]})},Tn=f(79090),Vt=f(69753),bt=f(97245),Mn=f(20046),En=f(63783),On=f(85060),Ra=f(19669),Ta=f(50228),jt=f(61086),Vn=f(15611),An=f(64599),St=f.n(An),Fn=function(n){var i=n.visible,r=n.onCancel,l=n.onConfirm,j=n.dataDictionary,p=(0,s.useState)({operator:"and",rules:[]}),b=v()(p,2),m=b[0],z=b[1],R=function(o){var Z;return((Z=j.fields.find(function(ae){return ae.key===o}))===null||Z===void 0?void 0:Z.data_type)||"STRING"},t=function(o){switch(o.toUpperCase()){case"NUMBER":return["=","!=","<","<=",">",">=","in","not in"];case"STRING":return["=","!=","like","not like","ilike","in","not in"];case"BOOLEAN":return["=","!=","in","not in"];default:return["="]}},M=function(o,Z,ae){var Y,W,K,q=R(o.field),A=t(q),_=["in","not in"].includes(o.operator),O=function(h){var le=u()({},m),ne=le,ee=St()(Z),X;try{for(ee.s();!(X=ee.n()).done;){var oe=X.value;ne=ne.rules[oe]}}catch(c){ee.e(c)}finally{ee.f()}ne.rules[ae]=u()(u()({},ne.rules[ae]),h),z(le)},F=function(){var h=u()({},m),le=h,ne=St()(Z),ee;try{for(ne.s();!(ee=ne.n()).done;){var X=ee.value;le=le.rules[X]}}catch(oe){ne.e(oe)}finally{ne.f()}le.rules.splice(ae,1),z(h)};return(0,e.jsxs)(et.Z,{align:"start",children:[(0,e.jsx)(it.default,{value:o.field,onChange:function(h){return O({field:h,operator:t(R(h))[0],value:""})},options:j.fields.map(function(V){return{label:V.name,value:V.key}}),style:{width:160}}),(0,e.jsx)(it.default,{value:o.operator,onChange:function(h){return O({operator:h,value:""})},options:A.map(function(V){return{label:V,value:V}}),style:{width:120}}),(0,e.jsx)(it.default,{mode:_?"multiple":void 0,value:_?(Y=o.value)!==null&&Y!==void 0?Y:[]:(W=o.value)!==null&&W!==void 0?W:null,onChange:function(h){return O({value:h})},options:((K=j.fields.find(function(V){return V.key===o.field}))===null||K===void 0||(K=K.allowed_values)===null||K===void 0?void 0:K.map(function(V){return{label:V,value:V}}))||[],style:{width:200}}),(0,e.jsx)(ie.ZP,{danger:!0,onClick:F,children:"Remove"})]},ae)},fe=function H(o){var Z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],ae=Z.length===0,Y=function(){for(var K=u()({},m),q=K,A=0;A<Z.length-1;A++)q=q.rules[Z[A]];q.rules.splice(Z[Z.length-1],1),z(K)};return(0,e.jsx)("div",{style:{border:"1px solid #ddd",padding:12,marginBottom:12},children:(0,e.jsxs)(et.Z,{direction:"vertical",style:{width:"100%"},children:[(0,e.jsxs)(et.Z,{align:"center",children:[(0,e.jsx)(it.default,{value:o.operator,onChange:function(K){var q=u()({},m),A=q,_=St()(Z),O;try{for(_.s();!(O=_.n()).done;){var F=O.value;A=A.rules[F]}}catch(V){_.e(V)}finally{_.f()}A.operator=K,z(q)},options:[{label:"AND",value:"and"},{label:"OR",value:"or"}],style:{width:80}}),!ae&&(0,e.jsx)(ie.ZP,{danger:!0,size:"small",onClick:Y,children:"Remove Group"})]}),o.rules.map(function(W,K){return"field"in W?M(W,Z,K):H(W,[].concat(ge()(Z),[K]))}),(0,e.jsxs)(et.Z,{children:[(0,e.jsx)(ie.ZP,{onClick:function(){var K,q=u()({},m),A=q,_=St()(Z),O;try{for(_.s();!(O=_.n()).done;){var F=O.value;A=A.rules[F]}}catch(le){_.e(le)}finally{_.f()}var V=(K=j.fields[0])===null||K===void 0?void 0:K.key,h=t(R(V))[0];A.rules.push({field:V,operator:h,value:""}),z(q)},children:"+ Add Rule"}),(0,e.jsx)(ie.ZP,{onClick:function(){var K=u()({},m),q=K,A=St()(Z),_;try{for(A.s();!(_=A.n()).done;){var O=_.value;q=q.rules[O]}}catch(F){A.e(F)}finally{A.f()}q.rules.push({operator:"and",rules:[]}),z(K)},children:"+ Add Group"})]})]})},Z.join("-"))},y=function(o,Z,ae){return ae==="is"||ae==="is not"?null:Array.isArray(o)?Z==="NUMBER"?o.map(Number):Z==="BOOLEAN"?o.map(function(Y){return Y==="true"}):o:Z==="BOOLEAN"?o==="true":Z==="NUMBER"?o.toString().includes(".")?parseFloat(o):parseInt(o):o},g=function H(o){var Z=o.rules.map(function(ae){return"field"in ae?{field:ae.field,operator:ae.operator,value:y(ae.value,R(ae.field),ae.operator)}:H(ae)}).filter(Boolean);return Z.length===0?null:{operator:o.operator,items:Z}};return(0,e.jsx)(yt.Z,{open:i,title:"Build Query",onCancel:r,footer:[(0,e.jsx)(ie.ZP,{onClick:r,children:"Cancel"},"cancel"),(0,e.jsx)(ie.ZP,{type:"primary",onClick:function(){return l(g(m))},children:"Enter"},"confirm")],width:900,children:fe(m)})},Bn=Fn,Ma=f(38928),xt=f(3003),ke=f(32983),Xt=f(4393),ua=f(55241),Ea=f(31326),Oa=f(28508),Ln=f(78677),Va=f(94229),Ie=f(96486),In=f(25478),Aa=f.n(In),Fa=f(84922),wt=(0,Fa.default)(Aa()),Jr="sample_id",ze=20,Ba=function(n){return n.every(function(i){return i==null||i===""})},Un=[{label:"Bar Chart",value:"bar"},{label:"Box Plot",value:"box"},{label:"Violin Plot",value:"violin"},{label:"Scatter Plot",value:"scatter"},{label:"Histogram",value:"histogram"},{label:"KM Plot",value:"kmplot"},{label:"Summary",value:"summary"},{label:"Unsupported",value:"unsupported"}],$n=function(n,i,r){return n.filter(function(l){var j=l[i.key],p=l[r.key];return j!=null&&j!==""&&p!==null&&p!==void 0&&p!==""}).map(function(l){return u()(je()(je()({},i.key,l[i.key]),r.key,l[r.key]),l)})},Gn=function(n,i,r){var l=(0,Ie.groupBy)(n,i.key);return Object.entries(l).map(function(j){var p=v()(j,2),b=p[0],m=p[1],z=m.map(function(o){return o[r.key]}).filter(function(o){return typeof o=="number"&&!isNaN(o)}).map(function(o){return Number(o)});if(z.length===0)return{group:b,count:m.length,mean:0,median:0,min:0,max:0,std:0,values:[]};var R=(0,Ie.meanBy)(z),t=z.sort(function(o,Z){return o-Z}),M=t.length%2===0?(t[t.length/2-1]+t[t.length/2])/2:t[Math.floor(t.length/2)],fe=Math.min.apply(Math,ge()(z)),y=Math.max.apply(Math,ge()(z)),g=z.reduce(function(o,Z){return o+Math.pow(Z-R,2)},0)/z.length,H=Math.sqrt(g);return{group:b,count:m.length,mean:R,median:M,min:fe,max:y,std:H,values:z}})},La=function(n){var i=n.statsData,r=n.xField,l=n.yField,j=n.total,p=[{title:r.name,dataIndex:"group",width:"20%",ellipsis:!0},{title:"Count",dataIndex:"count",width:"10%"},{title:"Mean",dataIndex:"mean",width:"12%",render:function(m){return m.toFixed(2)}},{title:"Median",dataIndex:"median",width:"12%",render:function(m){return m.toFixed(2)}},{title:"Min",dataIndex:"min",width:"10%",render:function(m){return m.toFixed(2)}},{title:"Max",dataIndex:"max",width:"10%",render:function(m){return m.toFixed(2)}},{title:"Std",dataIndex:"std",width:"12%",render:function(m){return m.toFixed(2)}},{title:"Freq (%)",dataIndex:"count",width:"14%",render:function(m){return(0,e.jsxs)("span",{style:{color:"#1890ff"},children:[(m/j*100).toFixed(2),"%"]})}}];return(0,e.jsx)(xt.Z,{dataSource:i,columns:p,rowKey:function(m,z){return"".concat(m.group,"-").concat(z)},showHeader:!0,size:"small",pagination:!1,sticky:!0,scroll:{x:600}})},Ia=function(n,i){return n.data_type==="STRING"&&i.data_type==="NUMBER"?"box":n.data_type==="NUMBER"&&i.data_type==="NUMBER"?"scatter":n.data_type==="STRING"&&i.data_type==="STRING"?"summary":"unsupported"},Hn=function(n){var i=n.fields,r=n.allFields,l=n.data,j=n.selectedColumns,p=n.groupByField,b=n.onClose,m=n.className,z=n.resize,R=n.total,t=n.allowChangeChartType,M=t===void 0?!1:t,fe=n.idColumnName,y=i.find(function(N){return N.key===p}),g=i.find(function(N){return N.key!==p}),H=(0,s.useState)(y&&g?Ia(y,g):"unsupported"),o=v()(H,2),Z=o[0],ae=o[1],Y=64,W=(0,s.useState)(300),K=v()(W,2),q=K[0],A=K[1],_=(0,s.useState)(300),O=v()(_,2),F=O[0],V=O[1],h=(0,s.useState)("Grouped Analysis"),le=v()(h,2),ne=le[0],ee=le[1],X=(0,s.useRef)(null),oe=(0,s.useRef)(null),c=(0,s.useMemo)(function(){return!y||!g?[]:$n(l,y,g)},[l,y,g]),C=(0,s.useMemo)(function(){return!y||!g?[]:Gn(c,y,g)},[c,y,g]);(0,s.useEffect)(function(){y&&g&&ee("".concat(g.name," by ").concat(y.name))},[y,g]),(0,s.useEffect)(function(){if(z){var N=new ResizeObserver(function(){var E,D,G;(E=X.current)!==null&&E!==void 0&&(E=E.chart)!==null&&E!==void 0&&E.forceFit?X.current.chart.forceFit():window.dispatchEvent(new Event("resize")),A((((D=oe.current)===null||D===void 0?void 0:D.clientHeight)||332)-Y),V(((G=oe.current)===null||G===void 0?void 0:G.clientWidth)||300),z==null||z()});if(oe.current){var T;N.observe(oe.current),A((((T=oe.current)===null||T===void 0?void 0:T.clientHeight)||332)-Y)}return function(){N.disconnect()}}},[]);var x=function(){if(!p)return(0,e.jsx)(ke.Z,{description:"Please select a group by field",className:"chart-empty"});if(i.length<2)return(0,e.jsx)(ke.Z,{description:"Please select at least two fields",className:"chart-empty"});if(!i.some(function(k){return k.key===p}))return(0,e.jsx)(ke.Z,{description:"The group by field is not in the fields",className:"chart-empty"});if(!y||!g)return(0,e.jsx)(ke.Z,{description:"Please select two fields for grouped analysis",className:"chart-empty"});if(Ba(l.map(function(k){return k[y.key]})))return(0,e.jsx)(ke.Z,{description:(0,e.jsxs)("span",{children:["All values in ",(0,e.jsx)(Qt.Z,{color:"warning",children:y.name})," are missing"]}),className:"chart-empty"});if(Ba(l.map(function(k){return k[g.key]})))return(0,e.jsx)(ke.Z,{description:(0,e.jsxs)("span",{children:["All values in ",(0,e.jsx)(Qt.Z,{color:"warning",children:g.name})," are missing"]}),className:"chart-empty"});if(c.length===0)return(0,e.jsx)(ke.Z,{description:"No valid data for grouped analysis",className:"chart-empty"});if(Z==="summary")return(0,e.jsx)(La,{statsData:C,xField:y,yField:g,total:R});if(Z==="bar")if(y.data_type==="STRING"&&g.data_type==="NUMBER"){var T=(0,Ie.groupBy)(c,y.key),E=["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#fa541c","#2f54eb"],D=Object.keys(T),G=D.map(function(k){var Q=T[k],he=Q.map(function(se){return se[g.key]}).filter(function(se){return typeof se=="number"&&!isNaN(se)}).map(function(se){return Number(se)});return he.length>0?(0,Ie.meanBy)(he):0}),Se=D.map(function(k){var Q=T[k],he=Q.map(function(ue){return ue[g.key]}).filter(function(ue){return typeof ue=="number"&&!isNaN(ue)}).map(function(ue){return Number(ue)});if(he.length>1){var se=(0,Ie.meanBy)(he),De=(0,Ie.sumBy)(he,function(ue){return Math.pow(ue-se,2)})/(he.length-1),Re=Math.sqrt(De);return Re/Math.sqrt(he.length)}return 0});return(0,e.jsx)(wt,{data:[{x:D,y:G,error_y:{type:"data",array:Se,visible:!0,color:"#666",thickness:1.5,width:4},type:"bar",marker:{color:D.map(function(k,Q){return E[Q%E.length]})},text:D.map(function(k,Q){return"n=".concat(T[k].length)}),textposition:"outside",textfont:{size:ze,color:"#666"}}],layout:{width:F,height:q,margin:{l:60,r:20,t:40,b:80},xaxis:{title:{text:y.name,font:{size:ze,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,tickfont:{size:ze-2,color:"#000"},automargin:!0},yaxis:{title:{text:"Mean ".concat(g.name),font:{size:ze,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickfont:{size:ze-2,color:"#000"}},plot_bgcolor:"#fff",paper_bgcolor:"#fff",showlegend:!1}})}else{var Oe=(0,Ie.groupBy)(c,y.key),Ne=["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#fa541c","#2f54eb"],ce=Object.entries(Oe).map(function(k,Q){var he=v()(k,2),se=he[0],De=he[1];return{type:se,value:De.length,count:De.length}});return(0,e.jsx)(Ln.Z,{autoFit:!0,data:ce,xField:"type",yField:"value",seriesField:"type",ref:X,xAxis:{title:{text:y.name},label:{autoRotate:!0}},yAxis:{title:{text:"Count"}},columnStyle:{radius:[2,2,0,0]},color:Ne})}if(Z==="box"){var lt=(0,Ie.groupBy)(c,y.key),Be=Object.entries(lt).map(function(k,Q){var he=v()(k,2),se=he[0],De=he[1],Re=De.map(function(ue){return ue[g.key]}).filter(function(ue){return typeof ue=="number"&&!isNaN(ue)}).map(function(ue){return Number(ue)});return{y:Re,x:se,type:"box",name:se.length>10?se.slice(0,10)+"\u2026":se,boxpoints:"outliers",marker:{color:["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#fa541c","#2f54eb"][Q%8]},line:{color:["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#fa541c","#2f54eb"][Q%8]}}});return(0,e.jsx)(wt,{data:Be,layout:{width:F,height:q,margin:{l:60,r:20,t:40,b:80},xaxis:{title:{text:y.name,font:{size:ze,color:"#000"},type:"category"},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,tickfont:{size:ze-2,color:"#000"},automargin:!0},yaxis:{title:{text:g.name,font:{size:ze,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickfont:{size:ze-2,color:"#000"}},showlegend:!0,plot_bgcolor:"#fff",paper_bgcolor:"#fff"}})}if(Z==="violin"){var re=(0,Ie.groupBy)(c,y.key),ot=Object.entries(re).map(function(k,Q){var he=v()(k,2),se=he[0],De=he[1],Re=De.map(function(ue){return ue[g.key]}).filter(function(ue){return typeof ue=="number"&&!isNaN(ue)}).map(function(ue){return Number(ue)});return{y:Re,type:"violin",name:se.length>10?se.slice(0,10)+"\u2026":se,box:{visible:!0},meanline:{visible:!0},fillcolor:["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#fa541c","#2f54eb"][Q%8],opacity:.6,line:{color:["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#fa541c","#2f54eb"][Q%8]}}});return(0,e.jsx)(wt,{data:ot,layout:{width:F,height:q,margin:{l:60,r:20,t:40,b:80},xaxis:{title:{text:y.name,font:{size:ze,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,tickfont:{size:ze-2,color:"#000"},automargin:!0},yaxis:{title:{text:g.name,font:{size:ze,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickfont:{size:ze-2,color:"#000"}},violinmode:"group",showlegend:!0,plot_bgcolor:"#fff",paper_bgcolor:"#fff"}})}if(Z==="scatter")if(y.data_type==="NUMBER"&&g.data_type==="NUMBER"){var Xe=i.find(function(k){return k.key!==y.key&&k.key!==g.key&&k.data_type==="STRING"}),Pe=["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#fa541c","#2f54eb"],S;if(Xe&&j!==null&&j!==void 0&&j.includes(Xe.key)){var Ue=(0,Ie.groupBy)(c,Xe.key);S=Object.entries(Ue).map(function(k,Q){var he=v()(k,2),se=he[0],De=he[1];return{x:De.map(function(Re){return Re[y.key]}),y:De.map(function(Re){return Re[g.key]}),type:"scatter",mode:"markers",name:se.length>10?se.slice(0,10)+"\u2026":se,marker:{size:8,color:Pe[Q%Pe.length],opacity:.7}}})}else S=[{x:c.map(function(k){return k[y.key]}),y:c.map(function(k){return k[g.key]}),type:"scatter",mode:"markers",marker:{size:8,color:"#1890ff",opacity:.7},name:"".concat(g.name," vs ").concat(y.name)}];return(0,e.jsx)(wt,{data:S,layout:{width:F,height:q,margin:{l:60,r:20,t:40,b:60},xaxis:{title:{text:y.name,font:{size:ze,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickfont:{size:ze-2,color:"#000"}},yaxis:{title:{text:g.name,font:{size:ze,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickfont:{size:ze-2,color:"#000"}},plot_bgcolor:"#fff",paper_bgcolor:"#fff",showlegend:S.length>1}})}else return(0,e.jsx)(ke.Z,{description:"Scatter plot requires both fields to be numeric",className:"chart-empty"});if(Z==="histogram")if(y.data_type==="NUMBER"&&g.data_type==="NUMBER"){var Ye=(0,Ie.groupBy)(c,y.key),U=Object.entries(Ye).map(function(k){var Q=v()(k,2),he=Q[0],se=Q[1];return{x:se.map(function(De){return De[g.key]}),type:"histogram",name:"".concat(y.name,": ").concat(he),opacity:.7}});return(0,e.jsx)(wt,{data:U,layout:{width:F,height:q,margin:{l:60,r:20,t:40,b:60},xaxis:{title:{text:g.name,font:{size:ze,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,tickfont:{size:ze-2,color:"#000"}},yaxis:{title:{text:"Frequency",font:{size:ze,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickfont:{size:ze-2,color:"#000"}},barmode:"overlay",plot_bgcolor:"#fff",paper_bgcolor:"#fff"}})}else if(g.data_type==="NUMBER"){var we=c.map(function(k){return k[g.key]}).filter(function(k){return typeof k=="number"&&!isNaN(k)});return(0,e.jsx)(Va.Z,{autoFit:!0,data:we.map(function(k){return{value:k}}),binField:"value",binWidth:10,ref:X,xAxis:{title:{text:g.name}},yAxis:{title:{text:"Frequency"}}})}else return(0,e.jsx)(ke.Z,{description:"Histogram requires numeric fields",className:"chart-empty"});if(Z==="kmplot")if(y.data_type==="STRING"){var xe="",P="";y.key.includes("os")?(xe="os_months",P="os_status"):y.key.includes("dfs")?(xe="dfs_months",P="dfs_status"):y.key.includes("rfs")?(xe="rfs_months",P="rfs_status"):y.key.includes("dmfs")&&(xe="dmfs_months",P="dmfs_status");var B=i.find(function(k){return k.key===xe})||r.find(function(k){return k.key===xe}),te=i.find(function(k){return k.key===P})||r.find(function(k){return k.key===P});if(console.log("KM Plot - timeField",B," eventField",te,"fields",i),!B||!te)return(0,e.jsx)(ke.Z,{description:"KM Plot requires valid time/event fields, like os_months, os_status, dfs_months, dfs_status, rfs_months, rfs_status, dmfs_months, dmfs_status.",className:"chart-empty"});var at=function(Q){return Q==="1"||Q===1||Q===!0||Q===1?1:Q==="0"||Q===0||Q===!1||Q===0?0:typeof Q=="string"&&Q.startsWith("1")?1:(typeof Q=="string"&&Q.startsWith("0"),0)},_e=c.filter(function(k){return k[B.key]!==null&&k[te.key]!==null}).map(function(k){return u()(u()({},k),{},je()(je()({},B.key,Number(k[B.key])),te.key,at(k[te.key])))}).sort(function(k,Q){return k.time-Q.time}),st={};if(["STRING","BOOLEAN"].includes(g.data_type))st=(0,Ie.groupBy)(_e,g.key);else if(g.data_type==="NUMBER"){var qe=_e.map(function(k){return Number(k[g.key])}).filter(function(k){return!isNaN(k)}),$e=qe.sort(function(k,Q){return k-Q})[Math.floor(qe.length/2)];st=je()(je()({},"<= median (".concat($e.toFixed(2),")"),_e.filter(function(k){return Number(k[g.key])<=$e})),"> median (".concat($e.toFixed(2),")"),_e.filter(function(k){return Number(k[g.key])>$e}))}console.log("KM Plot - grouped",st,"formattedData",_e);var kt=["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#fa541c","#2f54eb"],Ge=Object.entries(st).map(function(k,Q){var he=v()(k,2),se=he[0],De=he[1],Re=De.filter(function(Fe){return typeof Fe[B.key]=="number"&&(Fe[te.key]===1||Fe[te.key]===0)}).sort(function(Fe,nt){return Fe[B.key]-nt[B.key]}),ue=Re.length,Le=1,be=[0],ut=[1],Zt=[];return Re.forEach(function(Fe){var nt=Fe[B.key],He=Fe[te.key];He===1&&(Le=Le*(ue-1)/ue),ue-=1,be.push(nt),ut.push(Le),Zt.push("Sample ID: ".concat(Fe[fe]||"N/A","<br>")+"% event free: ".concat((Le*100).toFixed(2),"%<br>")+"Time of event: ".concat(nt.toFixed(2)," months<br>")+"Number of patients at risk: ".concat(ue))}),{x:be,y:ut,text:Zt,type:"scatter",mode:"lines+markers",name:"".concat(se," (n=").concat(Re.length,")"),line:{shape:"hv",color:kt[Q%kt.length]},hovertemplate:"%{text}<extra></extra>"}});return(0,e.jsx)(wt,{data:Ge,layout:{width:F,height:q,margin:{l:80,r:20,t:40,b:80},xaxis:{title:B.name,showline:!0,linewidth:1,linecolor:"#000"},yaxis:{title:"Survival Probability",range:[0,1.05],tickformat:".0%",showline:!0,linewidth:1,linecolor:"#000"},hovermode:"x unified",legend:{orientation:"h",x:0,y:-.2,bgcolor:"rgba(255,255,255,0.9)",bordercolor:"#000",borderwidth:1},plot_bgcolor:"#fff",paper_bgcolor:"#fff",hoverlabel:{bgcolor:"rgba(255,255,255,0.9)",font:{color:"#000",size:12,family:"Arial"},align:"left",bordercolor:"#ccc",namelength:0}}})}else return(0,e.jsx)(ke.Z,{description:"KM Plot requires categorical grouping variable (X-axis), like os_status, dfs_status, rfs_status, dmfs_status.",className:"chart-empty"});return(0,e.jsx)(ke.Z,{description:"Unsupported chart type: ".concat(Z),className:"chart-empty"})};return(0,e.jsx)(Je.Z,{className:"grouped-chart-card",children:(0,e.jsx)(Xt.Z,{size:"small",title:(0,e.jsx)("div",{className:"chart-drag-handle",children:ne}),extra:(0,e.jsxs)(et.Z,{size:0,children:[(0,e.jsx)(ua.Z,{placement:"topRight",content:(0,e.jsx)(La,{statsData:C,xField:y,yField:g,total:R}),title:null,style:{width:"800px"},prefixCls:"grouped-chart-card-table-popover",trigger:"click",destroyOnHidden:!0,children:(0,e.jsx)(ie.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Ea.Z,{})})}),(0,e.jsx)(Me.Z,{title:"".concat(y==null?void 0:y.name," vs ").concat(g==null?void 0:g.name," Grouped Analysis"),children:(0,e.jsx)(ie.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Ot.Z,{})})}),M&&(0,e.jsx)(Me.Z,{title:"Switch Chart Type",children:(0,e.jsx)(it.default,{style:{width:150},options:Un,value:Z,onChange:function(T){ae(T)}})}),b&&(0,e.jsx)(ie.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Oa.Z,{}),onClick:b})]}),className:m,ref:oe,children:x()})})},Wn=Hn,Ua=f(46312),Yt=5,$a={bar:{w:128,h:64},box:{w:128,h:64},violin:{w:128,h:64},scatter:{w:128,h:64},histogram:{w:128,h:64},summary:{w:128,h:64},kmplot:{w:128,h:64},default:{w:128,h:64}},Kn=function(n){var i=n.fields,r=n.data,l=n.total,j=n.selectedColumns,p=n.yField,b=n.onClose,m=n.idColumnName;console.log("yField",p,"fields",i,"selectedColumns",j,"data",r,"total",l);var z=(0,s.useRef)(null),R=(0,s.useRef)(null),t=(0,s.useState)(!1),M=v()(t,2),fe=M[0],y=M[1],g=(0,s.useState)(i),H=v()(g,2),o=H[0],Z=H[1],ae=(0,s.useState)({}),Y=v()(ae,2),W=Y[0],K=Y[1],q=function(_,O){if(W[_])return W[_];var F=$a[O]||$a.default,V=F.w,h=F.h;return{width:V*Yt,height:h*Yt}};return(0,s.useEffect)(function(){return z.current&&(R.current=new Ma.Z(z.current,{dragEnabled:!0,layoutOnInit:!0,layoutDuration:300,layoutEasing:"ease",dragSort:!0,dragSortPredicate:{threshold:50,action:"move"},dragStartPredicate:{distance:10,delay:100},dragHandle:".chart-drag-handle"})),function(){var A;(A=R.current)===null||A===void 0||A.destroy()}},[o]),p?(0,e.jsx)(Je.Z,{className:"grouped-visual-panel-container",children:(0,e.jsx)("div",{className:"muuri-grid",ref:z,children:o.map(function(A){var _=Ia(A,p),O=q(A.key,_),F=O.width,V=O.height,h={width:"".concat(F,"px"),height:"".concat(V,"px")},le=[A,p];return(0,e.jsx)("div",{className:"item",style:h,children:(0,e.jsx)("div",{className:"item-content",children:(0,e.jsx)(Ua.e,{defaultSize:{width:F,height:V},minWidth:5*Yt,minHeight:5*Yt,onResizeStart:function(){return y(!0)},onResizeStop:function(ee,X,oe){var c,C;y(!1);var x=oe.offsetWidth,N=oe.offsetHeight;K(function(T){return u()(u()({},T),{},je()({},A.key,{width:x,height:N}))}),(c=R.current)===null||c===void 0||c.refreshItems(),(C=R.current)===null||C===void 0||C.layout(!0)},handleClasses:{bottomRight:"resizable-handle"},enable:{top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,topLeft:!1,bottomLeft:!1},children:(0,e.jsxs)("div",{className:"resizable-container",children:[fe&&(0,e.jsx)("div",{className:"resize-indicator"}),(0,e.jsx)(Wn,{fields:le,allFields:o,groupByField:A.key,data:r,total:l,idColumnName:m,onClose:function(){},resize:function(){var ee;(ee=R.current)===null||ee===void 0||ee.refreshItems().layout(!0)},selectedColumns:j,allowChangeChartType:!0})]})})})},A.key)})})}):(0,e.jsx)(ke.Z,{description:"Please specify the right yField, it should be one of the selected columns"})},Qn=Kn,At=f(53531),Jn=f(63430),Xn=f(79611),Yn=f(80652),ca=(0,Fa.default)(Aa()),da=20,Ct="sample_id",_n=["patient_id","sample_id"],Ga=[{label:"Line Chart",value:"linechart"},{label:"Bar Chart",value:"bar"},{label:"Histogram",value:"histogram"},{label:"Pie Chart",value:"pie"},{label:"Table",value:"table"},{label:"Summary",value:"summary"},{label:"Unsupported",value:"unsupported"},{label:"Kaplan-Meier",value:"kaplan_meier"},{label:"ID",value:"id"},{label:"Box Plot",value:"boxplot"},{label:"Violin Plot",value:"violinplot"},{label:"Statistic",value:"statistic"}],qn=function(n,i,r){var l=function(o){return o==="1"||o===1||o===!0||o===1?1:o==="0"||o===0||o===!1||o===0?0:typeof o=="string"&&o.startsWith("1")?1:(typeof o=="string"&&o.startsWith("0"),0)},j=n.filter(function(H){return H[i]!==null&&H[r]!==null}).map(function(H){return{time:Number(H[i]),event:l(H[r]),label:H.patient_id||"NA"}}).sort(function(H,o){return H.time-o.time}),p=[{time:0,survival:1,event:0,at_risk:j.length,label:"0"}],b=j.length,m=1,z=0,R=St()(j),t;try{for(R.s();!(t=R.n()).done;){var M=t.value,fe=M.time,y=M.event,g=M.label;fe!==z&&(z=fe),y===1&&(m*=(b-1)/b),b-=1,p.push({time:fe,survival:m,event:y,at_risk:b,label:g})}}catch(H){R.e(H)}finally{R.f()}return p},er=function(n,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},l=r.normalizeNull,j=l===void 0?!0:l,p=r.sort,b=p===void 0?!1:p,m=new Map;n.forEach(function(R){var t=R[i];if(t==null||t===""){if(!j)return;t="NA"}typeof t=="number"?t=Number.isInteger(t)?t.toString():t.toFixed(2).replace(/\.?0+$/,""):t=String(t),m.set(t,(m.get(t)||0)+1)});var z=Array.from(m.entries()).map(function(R){var t=v()(R,2),M=t[0],fe=t[1];return je()(je()({},i,M),"count",fe)});return b&&z.sort(function(R,t){return t.count-R.count}),z},tr=function(n){var i=n.tableData,r=n.field,l=n.total,j=[{title:r.name,dataIndex:r.key,width:"calc(100% - 160px)",ellipsis:!0},{title:"#",dataIndex:"count",width:80},{title:"Freq (%)",dataIndex:"count",width:80,render:function(b,m){return(0,e.jsxs)("span",{style:{color:"#1890ff"},children:[(m.count/l*100).toFixed(2),"%"]})}}];return(0,e.jsx)(xt.Z,{dataSource:i,columns:j,rowKey:function(b){return"".concat(b[r.key])},showHeader:!0,size:"small",pagination:!1,sticky:!0})},Ha=function(n,i){var r=[["os_months","os_status"],["dfs_months","dfs_status"],["rfs_months","rfs_status"],["dmfs_months","dmfs_status"]];return r.some(function(l){var j=v()(l,2),p=j[0],b=j[1];return i.includes(p)&&i.includes(b)&&n.key===p})},Wa=function(n,i,r,l){var j,p=((j=n.allowed_values)===null||j===void 0?void 0:j.length)||0,b=p/r,m=.8;if(Ha(n,l||[]))return"kaplan_meier";if(n.key==="__summary")return"summary";if(n.data_type==="BOOLEAN")return"pie";if(n.data_type==="STRING"){if(p<=6)return"pie";if(p>6&&p<=25)return"bar";if(b<=m&&p<=500&&p>25)return"table";if(b>m&&p>100)return"id"}return n.data_type==="NUMBER"?"violinplot":"unsupported"},Ka=function(n,i){return n.length<=i?n:n.slice(0,i)+"..."},ar=function(n){var i=n.field,r=n.data,l=n.isFileBased,j=n.total,p=n.onClose,b=n.className,m=n.resize,z=n.selectedColumns,R=n.allowChangeChartType,t=R===void 0?!1:R,M=n.magnification,fe=n.sizes,y=n.isChecked,g=n.setIsChecked,H=(0,s.useState)(Wa(i,r.length,j,z)),o=v()(H,2),Z=o[0],ae=o[1],Y=64,W=(0,s.useState)(300),K=v()(W,2),q=K[0],A=K[1],_=(0,s.useState)(300),O=v()(_,2),F=O[0],V=O[1],h=(0,s.useState)(i.name),le=v()(h,2),ne=le[0],ee=le[1],X=(0,s.useRef)(null),oe=(0,s.useRef)(null),c=(0,s.useState)([]),C=v()(c,2),x=C[0],N=C[1];(0,s.useEffect)(function(){console.log("ChartCard: ",r,i.key),N(er(r,i.key,{normalizeNull:!0,sort:!0}))},[r,i.key]),(0,s.useEffect)(function(){if(m){var E=new ResizeObserver(function(){var G,Se,Oe;(G=X.current)!==null&&G!==void 0&&(G=G.chart)!==null&&G!==void 0&&G.forceFit?X.current.chart.forceFit():window.dispatchEvent(new Event("resize")),A((((Se=oe.current)===null||Se===void 0?void 0:Se.clientHeight)||332)-Y),V(((Oe=oe.current)===null||Oe===void 0?void 0:Oe.clientWidth)||300),m==null||m(0,0)});if(oe.current){var D;E.observe(oe.current),A((((D=oe.current)===null||D===void 0?void 0:D.clientHeight)||332)-Y)}return function(){E.disconnect()}}},[fe,M]),(0,s.useEffect)(function(){Ha(i,z||[])?ee(i.key==="os_months"||i.key==="os_status"?"Overall Survival Curve":"Disease-Free Survival Curve"):ee(i.name)},[z]);var T=function(){if(r.length===0)return(0,e.jsx)(ke.Z,{description:"No Data",className:"chart-empty"});if(Z==="kaplan_meier"){var D="",G="";i.key==="os_months"||i.key==="os_status"?(D="os_status",G="os_months"):i.key==="dfs_months"||i.key==="dfs_status"?(D="dfs_status",G="dfs_months"):i.key==="rfs_months"||i.key==="rfs_status"?(D="rfs_status",G="rfs_months"):(i.key==="dmfs_months"||i.key==="dmfs_status")&&(D="dmfs_status",G="dmfs_months");var Se=qn(r,G,D),Oe=Se.map(function(P){return"Patient ID: ".concat(P.label||"N/A","<br>")+"% event free: ".concat((P.survival*100).toFixed(2),"%<br>")+"Time of event: ".concat(P.time.toFixed(2)," months<br>")+"Number of patients at risk: ".concat(P.at_risk)});return(0,e.jsx)(ca,{data:[{x:Se.map(function(P){return P.time}),y:Se.map(function(P){return P.survival}),type:"scatter",mode:"lines+markers",name:"Survival Curve",line:{shape:"hv",color:"red"},text:Oe,hovertemplate:"%{text}<extra></extra>"}],layout:{title:"Survival Curve",width:F,height:q,margin:{l:50,r:20,t:20,b:20},xaxis:{title:"Time (Months)",range:[0,null],showgrid:!1,zeroline:!0,linecolor:"#000",linewidth:1,mirror:!0,ticks:"outside",tickwidth:1,tickcolor:"#000"},yaxis:{title:"Survival Probability",range:[0,1.05],showgrid:!1,zeroline:!0,linecolor:"#000",linewidth:1,mirror:!0,ticks:"outside",tickwidth:1,tickcolor:"#000"},plot_bgcolor:"#fff",paper_bgcolor:"#fff",legend:{x:0,y:1},hoverlabel:{bgcolor:"rgba(255,255,255,0.9)",font:{color:"#000",size:12,family:"Arial"},align:"left",bordercolor:"#ccc",namelength:0}}})}if(Z==="id"){var Ne=new Set(r.map(function(P){return P[i.key]}));return(0,e.jsx)("span",{style:{color:"#1890ff",fontSize:"24px"},children:Ne.size})}if(Z==="table"){var ce=Object.entries((0,Ie.groupBy)(r,i.key)).map(function(P){var B=v()(P,2),te=B[0],at=B[1];return je()(je()({},i.key,te),"count",at.length)}).sort(function(P,B){return B.count-P.count}),lt=[{title:i.name,dataIndex:i.key,width:"calc(100% - 160px)",ellipsis:!0},{title:"#",dataIndex:"count",width:80},{title:"Freq (%)",dataIndex:"count",width:80,render:function(B,te){return(0,e.jsxs)("span",{style:{color:"#1890ff"},children:[Math.round(te.count/r.length*100),"%"]})}}];return(0,e.jsx)(xt.Z,{dataSource:ce,columns:lt,rowKey:function(B,te){return"".concat(B[i.key],"-").concat(te)},rowSelection:{type:"checkbox",selectedRowKeys:r.map(function(P){return P[i.key]}),onChange:function(B){console.log(B)}},showHeader:!0,size:"small",pagination:!1,sticky:!0,scroll:{y:q}})}if(Z==="summary"){var Be=r.length,re=Be/j*100,ot=re>0?re.toFixed(2):"0.00";return(0,e.jsx)(At.Z,{title:"Loaded ".concat(l?"Files":"Samples"," [Total]"),valueRender:function(){return(0,e.jsxs)("span",{style:{color:"#1890ff"},children:[Be," / ",j," (",ot,"%)"]})}})}if(Z==="statistic")return i.data_type==="NUMBER"?(0,e.jsxs)("div",{children:[(0,e.jsxs)(Je.Z,{gutter:16,children:[(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(At.Z,{title:"Mean",value:r.length>0?(r.reduce(function(P,B){return P+Number(B[i.key]||0)},0)/r.length).toFixed(2):0,precision:2})}),(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(At.Z,{title:"Median",value:r.length>0?function(){var P=r.map(function(te){return Number(te[i.key]||0)}).sort(function(te,at){return te-at}),B=Math.floor(P.length/2);return P.length%2===0?((P[B-1]+P[B])/2).toFixed(2):P[B].toFixed(2)}():0,precision:2})})]}),(0,e.jsxs)(Je.Z,{gutter:16,style:{marginTop:16},children:[(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(At.Z,{title:"Max",value:r.length>0?Math.max.apply(Math,ge()(r.map(function(P){return Number(P[i.key]||0)}))).toFixed(2):0,precision:2})}),(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(At.Z,{title:"Min",value:r.length>0?Math.min.apply(Math,ge()(r.map(function(P){return Number(P[i.key]||0)}))).toFixed(2):0,precision:2})})]})]}):(0,e.jsx)(ke.Z,{description:"Statistic Only Support Numeric Fields",className:"chart-empty"});if(Z==="boxplot")if(i.data_type==="NUMBER"){var Xe=r.map(function(P){var B=P[i.key];return typeof B=="number"?B:null}).filter(function(P){return P!==null});console.log("Box Plot Data: ",Xe);var Pe=[{y:Xe,type:"box",name:Ka(i.key,10),boxpoints:"outliers",jitter:.3,pointpos:-1.8}];return(0,e.jsx)(ca,{data:Pe,layout:{xaxis:{showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickwidth:1,tickcolor:"#000",mirror:!0},yaxis:{title:{text:"Value",standoff:20},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!0,zerolinecolor:"#000",zerolinewidth:1,mirror:!0,ticks:"outside",tickwidth:1,tickcolor:"#000"},margin:{l:50,r:20,t:20,b:30},showlegend:!1,plot_bgcolor:"#fff",paper_bgcolor:"#fff",width:F,height:q}})}else return(0,e.jsx)(ke.Z,{description:"Box Plot Only Support Numeric Fields",className:"chart-empty"});if(Z==="violinplot")if(i.data_type==="NUMBER"){var S=r.map(function(P){var B=P[i.key];return typeof B=="number"?B:null}).filter(function(P){return P!==null}),Ue=[{y:S,type:"violin",name:Ka(i.key,10),box:{visible:!0},meanline:{visible:!0},points:"outliers",jitter:.3,pointpos:0}];return(0,e.jsx)(ca,{data:Ue,layout:{xaxis:{showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickwidth:1,tickcolor:"#000",mirror:!0},yaxis:{title:{text:"Value",standoff:20},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!0,zerolinecolor:"#000",zerolinewidth:1,mirror:!0,ticks:"outside",tickwidth:1,tickcolor:"#000"},margin:{l:50,r:20,t:20,b:30},showlegend:!1,plot_bgcolor:"#fff",paper_bgcolor:"#fff",width:F,height:q}})}else return(0,e.jsx)(ke.Z,{description:"Violin Plot Only Support Numeric Fields",className:"chart-empty"});if(Z==="pie")return x.length>0?(0,e.jsx)(Jn.Z,{autoFit:!0,data:x,angleField:"count",colorField:i.key,radius:1,label:{text:"count"},ref:X,interaction:{elementHighlight:!0},state:{inactive:{opacity:.5}},legend:!1,tooltip:{title:i.key},onReady:function(B){B.chart.on("interval:pointerover",function(te){console.log("Pie tooltip: ",te,B)})}}):(0,e.jsx)(ke.Z,{description:"No data to show",className:"chart-empty"});if(Z==="bar")return x.length>0?(0,e.jsx)(Xn.Z,{autoFit:!0,data:x,xField:i.key,yField:"count",legend:!1,ref:X,xAxis:{title:{text:i.name,style:{fontSize:12}},label:{autoHide:!1,autoRotate:!0}},yAxis:{title:{text:"Frequency",style:{fontSize:12}}},columnStyle:{radius:[2,2,0,0]}}):(0,e.jsx)(ke.Z,{description:"No data to show",className:"chart-empty"});if(Z==="histogram"){var Ye=r.map(function(P){return P[i.key]}).filter(function(P){return typeof P=="number"});return Ye.length>0?(0,e.jsx)(Va.Z,{data:Ye.map(function(P){return{value:P}}),binField:"value",binWidth:10,xAxis:{title:{text:i.name}},yAxis:{title:{text:"Frequency"}},autoFit:!0}):(0,e.jsx)(ke.Z,{description:"No data to show",className:"chart-empty"})}if(Z==="linechart"){var U=Ct,we=i.key,xe=r.map(function(P){return je()(je()({},U,P[U]),we,P[we])});return(0,e.jsx)(Yn.Z,{data:xe,xField:U,yField:we})}return(0,e.jsx)(ke.Z,{description:"Unsupported ".concat(i.data_type," field"),className:"chart-empty"})};return(0,e.jsx)(Je.Z,{className:"chart-card",children:(0,e.jsx)(Xt.Z,{size:"small",title:(0,e.jsx)(Me.Z,{title:ne,children:(0,e.jsx)("div",{className:"chart-drag-handle",children:ne})}),extra:(0,e.jsxs)(et.Z,{size:0,children:[y!==void 0&&(0,e.jsx)(za.Z,{checked:y!=null?y:!1,onChange:function(D){D.target.checked?g==null||g({key:i.key,action:"add"}):g==null||g({key:i.key,action:"remove"})}}),(0,e.jsx)(ua.Z,{placement:"topRight",content:x.length<=200?(0,e.jsx)(tr,{tableData:x,field:i,total:j}):(0,e.jsx)(ke.Z,{description:"Too many data to show (".concat(x.length,")"),className:"chart-empty"}),title:!1,style:{width:"300px"},prefixCls:"chart-card-table-popover",trigger:"click",destroyOnHidden:!0,children:(0,e.jsx)(ie.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Ea.Z,{})})}),!t&&(0,e.jsx)(Mt.Z,{menu:{items:["1x1","2x2","3x3"].map(function(E){return{key:E,label:E,type:"item"}}),onClick:function(D){var G=da*Number(D.key.split("x")[0])*((M==null?void 0:M.w)||1),Se=da*Number(D.key.split("x")[1])*((M==null?void 0:M.h)||1);M!=null&&M.w&&M!==null&&M!==void 0&&M.h&&M.w>1&&M.h>1&&(m==null||m(G,Se),console.log("Resize Setting: ",M,D,G,Se,da))}},trigger:["click"],placement:"bottomRight",overlayClassName:"chart-type-dropdown",children:(0,e.jsx)(ie.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Za.Z,{})})}),!t&&(0,e.jsx)(Mt.Z,{menu:{items:Ga.sort(function(E,D){return E.label.localeCompare(D.label)}).map(function(E){return{key:E.value,label:E.label,type:"item"}}),onClick:function(D){ae(D.key)}},trigger:["click"],placement:"bottomRight",overlayClassName:"chart-type-dropdown",children:(0,e.jsx)(ie.ZP,{type:"text",size:"small",icon:(0,e.jsx)(jt.Z,{})})}),(0,e.jsx)(Me.Z,{title:i.description,children:(0,e.jsx)(ie.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Ot.Z,{})})}),t&&(0,e.jsx)(Me.Z,{title:"Change chart type",children:(0,e.jsx)(it.default,{style:{width:150},options:Ga.sort(function(E,D){return E.label.localeCompare(D.label)}),value:Z,onChange:function(D){ae(D)}})}),p&&(0,e.jsx)(ie.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Oa.Z,{}),onClick:p})]}),className:b,ref:oe,children:T()})})},Qa=ar,_t=20,qt={id:{w:16,h:16},table:{w:32,h:16},bar:{w:32,h:16},pie:{w:16,h:16},histogram:{w:32,h:16},dotplot:{w:16,h:16},kaplan_meier:{w:32,h:16},default:{w:16,h:16}},nr=function(n){var i=n.fields,r=n.data,l=n.isFileBased,j=n.total,p=n.selectedColumns,b=n.onClose,m=n.onSelectFields,z=(0,s.useRef)(null),R=(0,s.useRef)(null),t=(0,s.useState)(!1),M=v()(t,2),fe=M[0],y=M[1],g=(0,s.useState)([]),H=v()(g,2),o=H[0],Z=H[1],ae=(0,s.useState)({}),Y=v()(ae,2),W=Y[0],K=Y[1],q=(0,s.useState)(new Set),A=v()(q,2),_=A[0],O=A[1],F={key:"__summary",name:"Summary",data_type:"NUMBER",allowed_values:[],notes:"",order:0,description:"Total number of ".concat(l?"files":"samples"," in the dataset and loaded ").concat(l?"files":"samples")},V=function(le,ne){if(W[le])return W[le];var ee=qt[ne]||qt.default,X=ee.w,oe=ee.h,c={width:X*_t,height:oe*_t};return K(function(C){return u()(u()({},C),{},je()({},le,c))}),c};return(0,s.useEffect)(function(){return z.current&&(R.current=new Ma.Z(z.current,{dragEnabled:!0,layoutOnInit:!0,layoutDuration:300,layoutEasing:"ease",dragSort:!0,dragSortPredicate:{threshold:50,action:"move"},dragStartPredicate:{distance:10,delay:100},dragHandle:".chart-drag-handle"})),function(){var h;(h=R.current)===null||h===void 0||h.destroy()}},[o]),(0,s.useEffect)(function(){Z([F].concat(ge()(i.filter(function(h){return p.includes(h.key)}))))},[i,p]),(0,e.jsx)(Je.Z,{className:"visual-panel-container",children:(0,e.jsx)("div",{className:"muuri-grid",ref:z,children:o.map(function(h){var le=Wa(h,r.length,j,p),ne=V(h.key,le),ee=ne.width,X=ne.height,oe={width:"".concat(ee,"px"),height:"".concat(X,"px")};return(0,e.jsx)("div",{className:"item",style:oe,children:(0,e.jsx)("div",{className:"item-content",children:(0,e.jsx)(Ua.e,{defaultSize:{width:ee,height:X},minWidth:5*_t,minHeight:5*_t,onResizeStart:function(){return y(!0)},onResizeStop:function(C,x,N){var T,E;y(!1);var D=N.offsetWidth,G=N.offsetHeight;K(function(Se){return u()(u()({},Se),{},je()({},h.key,{width:D,height:G}))}),console.log("Resize: ",h.key,D,G),(T=R.current)===null||T===void 0||T.refreshItems(),(E=R.current)===null||E===void 0||E.layout(!0),window.dispatchEvent(new Event("resize"))},size:{width:ee,height:X},handleClasses:{bottomRight:"resizable-handle"},enable:{top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,topLeft:!1,bottomLeft:!1},children:(0,e.jsxs)("div",{className:"resizable-container",children:[fe&&(0,e.jsx)("div",{className:"resize-indicator"}),(0,e.jsx)(Qa,{field:h,data:r,isFileBased:l,total:j,onClose:function(){b==null||b(h)},resize:function(C,x){var N,T;console.log("Resize: ",h.key,C,x),C>0&&x>0&&K(function(E){return u()(u()({},E),{},je()({},h.key,{width:C,height:x}))}),(N=R.current)===null||N===void 0||N.refreshItems(),(T=R.current)===null||T===void 0||T.layout(!0),window.dispatchEvent(new Event("resize"))},selectedColumns:p,sizes:W[h.key],setIsChecked:function(C){if(C.action==="add"&&!_.has(C.key)){var x=new Set(_);x.add(C.key),O(x),m==null||m(Array.from(x))}else if(C.action==="remove"&&_.has(C.key)){var N=new Set(_);N.delete(C.key),O(N),m==null||m(Array.from(N))}Te.ZP.success("".concat(C.action," ").concat(C.key))},magnification:qt[le]||qt.default})]})})})},h.key)})})})},rr=nr,ir=f(13769),lr=f.n(ir),or=f(74061),sr=["dataSource","scroll","size","rowKey","pagination","dataDictionary","onCellClick","isFileBased"],ur=function(n){var i,r=n.dataSource,l=n.scroll,j=n.size,p=n.rowKey,b=n.pagination,m=n.dataDictionary,z=n.onCellClick,R=n.isFileBased,t=lr()(n,sr),M=(i=l==null?void 0:l.y)!==null&&i!==void 0?i:500,fe=42,y=(0,s.useRef)(),g=(0,s.useRef)(null),H=(0,s.useState)([]),o=v()(H,2),Z=o[0],ae=o[1];(0,s.useEffect)(function(){var O=m.map(function(F){return{title:function(h){return(0,e.jsxs)("div",{className:"table-column-name-container",style:{display:"flex",whiteSpace:"nowrap",gap:4,alignItems:"center"},children:[(0,e.jsx)(Me.Z,{title:F.name,children:(0,e.jsx)("span",{className:"table-column-name",style:{maxWidth:h-56},children:F.name})}),(0,e.jsxs)(et.Z,{children:[(0,e.jsx)(Me.Z,{title:F.description||"No description",children:(0,e.jsx)(ie.ZP,{size:"small",icon:(0,e.jsx)(Ot.Z,{})})}),(0,e.jsx)(ua.Z,{content:(0,e.jsx)(Qa,{className:"chart-card-popover",allowChangeChartType:!0,field:F,data:r,isFileBased:R,total:r.length}),trigger:"click",destroyOnHidden:!0,children:(0,e.jsx)(ie.ZP,{size:"small",icon:(0,e.jsx)(jt.Z,{}),type:"primary"})})]})]})},dataIndex:F.key,key:F.key,render:function(h,le,ne){return F.key==="patient_id"?(0,e.jsx)("a",{onClick:function(){return z==null?void 0:z(le,ne,F)},children:h}):h}}});ae(O)},[m,r]);var Y=(0,s.useState)(function(){var O={};return Object.defineProperty(O,"scrollLeft",{get:function(){if(y.current){var V;return((V=y.current.state)===null||V===void 0?void 0:V.scrollLeft)||0}return 0},set:function(V){y.current&&y.current.scrollTo({scrollLeft:V}),g.current&&(g.current.scrollLeft=V)}}),O}),W=v()(Y,1),K=W[0];(0,s.useEffect)(function(){y.current&&(console.log("\u{1F6E0} Recalculating columns for Grid"),y.current.resetAfterColumnIndex(0,!0))},[Z.length]);var q=Z.filter(function(O){return!O.width}).length,A=Z.map(function(O){return O.width?O:u()(u()({},O),{},{width:Math.floor((l==null?void 0:l.x)/q)})}),_=function(F,V){var h=V.scrollbarSize,le=V.ref,ne=V.onScroll;return le&&Pa()(le)==="object"&&(le.current=K),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{ref:g,style:{display:"flex",width:l==null?void 0:l.x,overflow:"hidden"},children:A.map(function(ee,X){return(0,e.jsx)("div",{style:{width:ee.width,padding:8,background:"#fafafa",borderBottom:"1px solid #f0f0f0",fontWeight:500},children:ee.title(ee.width)},X)})}),(0,e.jsx)(or.cd,{className:"datatable-table-grid",ref:y,columnCount:A.length,columnWidth:function(X){return A[X].width},height:M,rowCount:F.length,rowHeight:function(){return fe},width:l==null?void 0:l.x,onScroll:function(X){var oe=X.scrollLeft;typeof ne=="function"&&ne({scrollLeft:oe}),g.current&&(g.current.scrollLeft=oe)},onItemsRendered:function(){},children:function(X){var oe=X.columnIndex,c=X.rowIndex,C=X.style,x=A[oe],N=F[c],T=N[x.dataIndex];return(0,e.jsx)("div",{className:c%2===0?"datatable-table-grid-row-even":"datatable-table-grid-row-odd",style:u()(u()({},C),{},{padding:"8px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",textAlign:"".concat(x.align)}),children:typeof x.render=="function"?x.render(T,N,c):T})}})]})};return(0,e.jsx)(xt.Z,u()(u()({},t),{},{size:j,bordered:!0,columns:A,dataSource:r,pagination:b,rowKey:p,scroll:l,showHeader:!1,components:{body:_},summary:function(){return(0,e.jsx)(xt.Z.Summary,{fixed:!0,children:(0,e.jsx)(xt.Z.Summary.Row,{style:{fontSize:16,fontWeight:500},children:(0,e.jsxs)(xt.Z.Summary.Cell,{index:0,colSpan:Z.length,children:["\u{1F522} Showing ",r.length," of ",b==null?void 0:b.total," samples"]})})})}}))},Ja=ur,Xa=f(26412),cr=Qe.Z.Title,dr=function(n){var i=n.data,r=n.dataDictionary,l=n.title,j=l===void 0?"Patient Details":l;return i?(0,e.jsxs)("div",{style:{background:"#fff",padding:24,borderRadius:8},children:[(0,e.jsx)(cr,{level:4,style:{marginBottom:16},children:j}),(0,e.jsx)(Je.Z,{className:"data-info-modal-content",children:(0,e.jsx)(Xa.Z,{column:1,bordered:!0,size:"small",labelStyle:{width:"40%",fontWeight:500},children:Object.entries(i).map(function(p){var b,m,z=v()(p,2),R=z[0],t=z[1];return(0,e.jsx)(Xa.Z.Item,{label:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{style:{fontWeight:500,marginRight:4},children:((b=r.fields.find(function(M){return M.key===R}))===null||b===void 0?void 0:b.name)||R}),(0,e.jsx)(Me.Z,{title:((m=r.fields.find(function(M){return M.key===R}))===null||m===void 0?void 0:m.description)||"",children:(0,e.jsx)(Ot.Z,{})})]}),children:t!=null?String(t):"\u2014"},R)})})})]}):null},fr=dr,fa=f(84702),ha=f(23315),hr=f(63366),ma="/assets/data_downloader.md",mr=function(n){var i=n.open,r=n.onClose,l=n.onDownloadMetadataTable,j=n.onDownloadDatafiles,p=(0,s.useState)(""),b=v()(p,2),m=b[0],z=b[1];return(0,s.useEffect)(function(){ma&&fetch(ma).then(function(R){return R.text()}).then(function(R){z(R)})},[ma]),(0,e.jsx)(yt.Z,{className:"datatable-data-info-modal",open:i,width:800,destroyOnHidden:!0,onCancel:r,title:(0,e.jsx)(Qe.Z.Title,{level:4,children:"Download Dataset"}),footer:(0,e.jsxs)("div",{children:[(0,e.jsx)(ie.ZP,{type:"primary",onClick:function(){l(),r()},icon:(0,e.jsx)(Vt.Z,{}),children:"Download Metadata Table"}),(0,e.jsx)(ie.ZP,{type:"primary",onClick:function(){j(),r()},icon:(0,e.jsx)(Vt.Z,{}),children:"Download Datafile Table"})]}),children:(0,e.jsx)(Qe.Z.Text,{style:{fontSize:"16px"},children:(0,e.jsx)(fa.D,{className:"modal-markdown-content",remarkPlugins:[ha.Z],rehypePlugins:[hr.Z],children:m})})})},vr=mr,pr=f(25889),yr=f(57460),gr=f.n(yr),xr=f(81249),br=f.n(xr),jr=function(n,i,r){var l=r.leftOn,j=r.rightOn,p=r.how,b=p===void 0?"inner":p,m=new Map;i.forEach(function(t){var M=t[j];m.has(M)||m.set(M,[]),m.get(M).push(t)});var z=[],R=new Set;return n.forEach(function(t){var M=t[l],fe=m.get(M);fe&&fe.length>0?(R.add(M),fe.forEach(function(y){z.push(u()(u()({},t),y))})):(b==="left"||b==="outer")&&z.push(u()({},t))}),(b==="right"||b==="outer")&&i.forEach(function(t){var M=t[j];R.has(M)||z.push(u()({},t))}),z},va=f(57489),Sr=f(96074),wr=f(58660),Ya=it.default.Option,Cr=Qe.Z.Text,Ft={scatter:{name:"Scatter Plot",mappings:["x","y","color","size","text"],required:["x","y"]},line:{name:"Line Plot",mappings:["x","y","color","text"],required:["x","y"]},bar:{name:"Bar Plot",mappings:["x","y","color","text"],required:["x","y"]},histogram:{name:"Histogram",mappings:["x","color","text"],required:["x"]},box:{name:"Box Plot",mappings:["x","y","color","text"],required:["y"]},violin:{name:"Violin Plot",mappings:["x","y","color","text"],required:["y"]},heatmap:{name:"Heatmap",mappings:["x","y","z","text"],required:["x","y","z"]},pie:{name:"Pie Chart",mappings:["labels","text"],required:["labels"]}},_a={x:"X Axis",y:"Y Axis",z:"Z Axis (Numeric)",color:"Color",size:"Size",text:"Text Label",labels:"Labels",values:"Values"},kr=function(n){var i,r=n.data,l=n.fieldDataDictionary,j=(0,s.useState)("scatter"),p=v()(j,2),b=p[0],m=p[1],z=(0,s.useState)({}),R=v()(z,2),t=R[0],M=R[1],fe=(0,s.useState)(0),y=v()(fe,2),g=y[0],H=y[1],o=va.Z.useForm(),Z=v()(o,1),ae=Z[0],Y=(0,s.useCallback)(function(c){var C=typeof c=="string"?parseFloat(c):c;return isNaN(C)?"0":C.toFixed(3)},[]),W=(0,s.useMemo)(function(){var c=[],C=[],x=[];return l.forEach(function(N){x.push(N),["number","float","integer"].includes(N.data_type.toLowerCase())?c.push(N):C.push(N)}),{numericFields:c,categoricalFields:C,allFields:x}},[l]),K=W.numericFields,q=W.categoricalFields,A=W.allFields,_=(0,s.useCallback)(function(c){m(c),M({}),ae.resetFields()},[ae]),O=(0,s.useCallback)(function(c,C){M(function(x){return u()(u()({},x),{},je()({},c,C))})},[]);(0,s.useEffect)(function(){var c=function(){H(function(x){return x+1})};return window.addEventListener("resize",c),function(){return window.removeEventListener("resize",c)}},[]);var F=(0,s.useCallback)(function(c){var C=A;return b==="heatmap"?c==="x"||c==="y"?C=q:c==="z"?C=K:c==="text"&&(C=A):["y","z","values","size"].includes(c)?C=K:["color","labels"].includes(c)&&(C=[].concat(ge()(q),ge()(K))),console.log("Fields for ".concat(c," (").concat(b,"): "),C),C},[A,K,q,b]),V=(0,s.useCallback)(function(c){var C=F(c);return C.map(function(x){return(0,e.jsx)(Ya,{value:x.key,children:(0,e.jsxs)(Me.Z,{title:"".concat(x.key,": ").concat(x.description),children:[x.name," (",x.key,")"]})},x.key)})},[F]),h=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#aec7e8","#ffbb78","#98df8a","#ff9896","#c5b0d5","#c49c94","#f7b6d3","#c7c7c7","#dbdb8d","#9edae5"],le=(0,s.useCallback)(function(c,C,x,N,T){var E=l.find(function(ce){return ce.key===c}),D=l.find(function(ce){return ce.key===C}),G=x?l.find(function(ce){return ce.key===x}):null,Se=N?l.find(function(ce){return ce.key===N}):null,Oe=T?l.find(function(ce){return ce.key===T}):null,Ne="";return Ne+="".concat((E==null?void 0:E.name)||c,": %{x}<br>"),Ne+="".concat((D==null?void 0:D.name)||C,": %{y}<br>"),x&&G&&(Ne+="".concat(G.name||x,": %{customdata[0]}<br>")),N&&Se&&(Ne+="".concat(Se.name||N,": %{customdata[1]}<br>")),T&&Oe&&(Ne+="".concat(Oe.name||T,": %{customdata[2]}<br>")),Ne+="<extra></extra>",Ne},[l]),ne=(0,s.useCallback)(function(c,C){var x=l.find(function(D){return D.key===c});if(!x)return[];var N=Math.min.apply(Math,ge()(C)),T=Math.max.apply(Math,ge()(C)),E=(N+T)/2;return[{type:"scatter",mode:"markers",x:[null],y:[null],marker:{size:8,color:"rgba(0,0,0,0)",symbol:"circle"},name:"".concat(x.name||c," (Size)"),showlegend:!0,legendgroup:"size-legend"},{type:"scatter",mode:"markers",x:[null],y:[null],marker:{size:12,color:"rgba(0,0,0,0)",symbol:"circle"},name:"Min: ".concat(Y(N)),showlegend:!0,legendgroup:"size-legend"},{type:"scatter",mode:"markers",x:[null],y:[null],marker:{size:16,color:"rgba(0,0,0,0)",symbol:"circle"},name:"Mid: ".concat(Y(E)),showlegend:!0,legendgroup:"size-legend"},{type:"scatter",mode:"markers",x:[null],y:[null],marker:{size:20,color:"rgba(0,0,0,0)",symbol:"circle"},name:"Max: ".concat(Y(T)),showlegend:!0,legendgroup:"size-legend"}]},[l]),ee=(0,s.useCallback)(function(c,C,x,N,T,E){var D=[],G=le(C,x,N,T,E);if(!N){var Se={type:"scatter",mode:"markers",x:c.map(function(U){return U[C]}),y:c.map(function(U){return U[x]}),marker:{size:T?c.map(function(U){return U[T]}):void 0},text:E?c.map(function(U){return U[E]}):void 0,customdata:c.map(function(U){return[null,T?U[T]:null,E?U[E]:null]}),hovertemplate:G,name:"Data Points",showlegend:!1};if(D.push(Se),T){var Oe=c.map(function(U){return U[T]}),Ne=ne(T,Oe);D.push.apply(D,ge()(Ne))}return D}var ce=l.find(function(U){return U.key===N}),lt=ce&&["number","float","integer"].includes(ce.data_type.toLowerCase());if(lt){var Be=c.map(function(U){return U[N]}),re={type:"scatter",mode:"markers",x:c.map(function(U){return U[C]}),y:c.map(function(U){return U[x]}),marker:{color:Be,colorscale:"Viridis",showscale:!0,colorbar:{title:(ce==null?void 0:ce.name)||N},size:T?c.map(function(U){return U[T]}):void 0},text:E?c.map(function(U){return U[E]}):void 0,customdata:c.map(function(U){return[U[N],T?U[T]:null,E?U[E]:null]}),hovertemplate:G,name:"Data Points",showlegend:!1};if(D.push(re),T){var ot=c.map(function(U){return U[T]}),Xe=ne(T,ot);D.push.apply(D,ge()(Xe))}return D}else{var Pe={};c.forEach(function(U){var we=U[N];Pe[we]||(Pe[we]=[]),Pe[we].push(U)});var S=Object.entries(Pe).map(function(U,we){var xe=v()(U,2),P=xe[0],B=xe[1];return{type:"scatter",mode:"markers",x:B.map(function(te){return te[C]}),y:B.map(function(te){return te[x]}),marker:{color:h[we%h.length],size:T?B.map(function(te){return te[T]}):void 0},text:E?B.map(function(te){return te[E]}):void 0,customdata:B.map(function(te){return[te[N],T?te[T]:null,E?te[E]:null]}),hovertemplate:G,name:"".concat((ce==null?void 0:ce.name)||N,": ").concat(P),showlegend:!0}});if(D.push.apply(D,ge()(S)),T){var Ue=c.map(function(U){return U[T]}),Ye=ne(T,Ue);D.push.apply(D,ge()(Ye))}return D}},[l,ne]),X=(0,s.useMemo)(function(){if(!r||r.length===0||!b)return[];var c=Ft[b];if(!c)return[];var C=c.required.every(function(a){return t[a]});if(!C)return[];console.log("Plot Data: ",r,t);try{switch(b){case"scatter":return ee(r,t.x,t.y,t.color,t.size,t.text);case"line":var x=[],N=le(t.x,t.y,t.color,t.size,t.text);if(!t.color){var T={type:"scatter",mode:"lines+markers",x:r.map(function(a){return a[t.x]}),y:r.map(function(a){return a[t.y]}),text:t.text?r.map(function(a){return a[t.text]}):void 0,customdata:r.map(function(a){return[null,t.size?a[t.size]:null,t.text?a[t.text]:null]}),hovertemplate:N,name:"Line Plot",showlegend:!1};if(x.push(T),t.size){var E=r.map(function(a){return a[t.size]}),D=ne(t.size,E);x.push.apply(x,ge()(D))}return x}var G=l.find(function(a){return a.key===t.color}),Se=G&&["number","float","integer"].includes(G.data_type.toLowerCase());if(Se){var Oe=r.map(function(a){return a[t.color]}),Ne={type:"scatter",mode:"lines+markers",x:r.map(function(a){return a[t.x]}),y:r.map(function(a){return a[t.y]}),line:{color:Oe,colorscale:"Viridis",showscale:!0,colorbar:{title:(G==null?void 0:G.name)||t.color}},text:t.text?r.map(function(a){return a[t.text]}):void 0,customdata:r.map(function(a){return[a[t.color],t.size?a[t.size]:null,t.text?a[t.text]:null]}),hovertemplate:N,name:"Line Plot",showlegend:!1};if(x.push(Ne),t.size){var ce=r.map(function(a){return a[t.size]}),lt=ne(t.size,ce);x.push.apply(x,ge()(lt))}return x}else{var Be={};r.forEach(function(a){var L=a[t.color];Be[L]||(Be[L]=[]),Be[L].push(a)});var re=Object.entries(Be).map(function(a,L){var pe=v()(a,2),me=pe[0],J=pe[1];return{type:"scatter",mode:"lines+markers",x:J.map(function(ve){return ve[t.x]}),y:J.map(function(ve){return ve[t.y]}),line:{color:h[L%h.length]},text:t.text?J.map(function(ve){return ve[t.text]}):void 0,customdata:J.map(function(ve){return[ve[t.color],t.size?ve[t.size]:null,t.text?ve[t.text]:null]}),hovertemplate:N,name:"".concat((G==null?void 0:G.name)||t.color,": ").concat(me),showlegend:!0}});if(x.push.apply(x,ge()(re)),t.size){var ot=r.map(function(a){return a[t.size]}),Xe=ne(t.size,ot);x.push.apply(x,ge()(Xe))}return x}case"bar":var Pe=[],S={};r.forEach(function(a){var L=a[t.x],pe=parseFloat(a[t.y])||0;S[L]||(S[L]={sum:0,count:0,values:[],mean:0,std:0}),S[L].sum+=pe,S[L].count+=1,S[L].values.push(pe),t.color&&(S[L].color=a[t.color]),t.text&&(S[L].text=a[t.text])}),Object.keys(S).forEach(function(a){var L=S[a];L.mean=L.sum/L.count;var pe=L.values.reduce(function(me,J){return me+Math.pow(J-L.mean,2)},0)/L.count;L.std=Math.sqrt(pe)});var Ue=l.find(function(a){return a.key===t.x}),Ye=l.find(function(a){return a.key===t.y}),U=t.color?l.find(function(a){return a.key===t.color}):null,we=t.text?l.find(function(a){return a.key===t.text}):null,xe="";if(xe+="".concat((Ue==null?void 0:Ue.name)||t.x,": %{x}<br>"),xe+="".concat((Ye==null?void 0:Ye.name)||t.y,": %{y}<br>"),xe+="Count: %{customdata[3]}<br>",xe+="Std Dev: %{customdata[4]}<br>",t.color&&U&&(xe+="".concat(U.name||t.color,": %{customdata[0]}<br>")),t.text&&we&&(xe+="".concat(we.name||t.text,": %{customdata[2]}<br>")),xe+="<extra></extra>",!t.color){var P={type:"bar",x:Object.keys(S),y:Object.values(S).map(function(a){return parseFloat(Y(a.mean))}),error_y:{type:"data",array:Object.values(S).map(function(a){return parseFloat(Y(a.std))}),visible:!0},text:t.text?Object.values(S).map(function(a){return a.text}):void 0,customdata:Object.values(S).map(function(a){return[null,null,t.text?a.text:null,a.count,Y(a.std)]}),hovertemplate:xe,name:"Bar Plot",showlegend:!1};return Pe.push(P),Pe}var B=l.find(function(a){return a.key===t.color}),te=B&&["number","float","integer"].includes(B.data_type.toLowerCase());if(te){var at={type:"bar",x:Object.keys(S),y:Object.values(S).map(function(a){return parseFloat(Y(a.mean))}),error_y:{type:"data",array:Object.values(S).map(function(a){return parseFloat(Y(a.std))}),visible:!0},marker:{color:Object.values(S).map(function(a){return a.color}),colorscale:"Viridis",showscale:!0,colorbar:{title:(B==null?void 0:B.name)||t.color}},text:t.text?Object.values(S).map(function(a){return a.text}):void 0,customdata:Object.values(S).map(function(a){return[Y(a.color),null,t.text?a.text:null,a.count,Y(a.std)]}),hovertemplate:xe,name:"Bar Plot",showlegend:!1};return Pe.push(at),Pe}else{var _e={};Object.entries(S).forEach(function(a){var L=v()(a,2),pe=L[0],me=L[1],J=me.color;_e[J]||(_e[J]={}),_e[J][pe]=me});var st=Object.entries(_e).map(function(a,L){var pe=v()(a,2),me=pe[0],J=pe[1];return{type:"bar",x:Object.keys(J),y:Object.values(J).map(function(ve){return parseFloat(Y(ve.mean))}),error_y:{type:"data",array:Object.values(J).map(function(ve){return parseFloat(Y(ve.std))}),visible:!0},marker:{color:h[L%h.length]},text:t.text?Object.values(J).map(function(ve){return ve.text}):void 0,customdata:Object.values(J).map(function(ve){return[me,null,t.text?ve.text:null,ve.count,Y(ve.std)]}),hovertemplate:xe,name:"".concat((B==null?void 0:B.name)||t.color,": ").concat(me),showlegend:!0}});return Pe.push.apply(Pe,ge()(st)),Pe}case"histogram":var qe=[],$e=le(t.x,"Count",t.color,void 0,void 0);if(!t.color){var kt={type:"histogram",x:r.map(function(a){return a[t.x]}),customdata:r.map(function(a){return[null,null,null]}),hovertemplate:$e,name:"Histogram",showlegend:!1};return qe.push(kt),qe}var Ge=l.find(function(a){return a.key===t.color}),k=Ge&&["number","float","integer"].includes(Ge.data_type.toLowerCase());if(k){var Q=r.map(function(a){return a[t.color]}),he={type:"histogram",x:r.map(function(a){return a[t.x]}),marker:{color:Q,colorscale:"Viridis",showscale:!0,colorbar:{title:(Ge==null?void 0:Ge.name)||t.color}},customdata:r.map(function(a){return[a[t.color],null,null]}),hovertemplate:$e,name:"Histogram",showlegend:!1};return qe.push(he),qe}else{var se={};r.forEach(function(a){var L=a[t.color];se[L]||(se[L]=[]),se[L].push(a)});var De=Object.entries(se).map(function(a,L){var pe=v()(a,2),me=pe[0],J=pe[1];return{type:"histogram",x:J.map(function(ve){return ve[t.x]}),marker:{color:h[L%h.length]},customdata:J.map(function(ve){return[ve[t.color],null,null]}),hovertemplate:$e,name:"".concat((Ge==null?void 0:Ge.name)||t.color,": ").concat(me),showlegend:!0}});return qe.push.apply(qe,ge()(De)),qe}case"box":var Re=[],ue=l.find(function(a){return a.key===t.x}),Le=l.find(function(a){return a.key===t.y});if(t.x){var be={};r.forEach(function(a){var L=a[t.x];be[L]||(be[L]=[]),be[L].push(a[t.y])});var ut=Object.entries(be).map(function(a,L){var pe=v()(a,2),me=pe[0],J=pe[1];return{type:"box",y:J,name:me,boxpoints:"all",jitter:.3,marker:{color:h[L%h.length]},hovertemplate:"<b>".concat(me,"</b><br>")+"".concat((ue==null?void 0:ue.name)||t.x,": ").concat(me,"<br>")+"".concat((Le==null?void 0:Le.name)||t.y,": %{y}<br>")+"<extra></extra>"}});return ut}else{var Zt={type:"box",y:r.map(function(a){return a[t.y]}),name:"Box Plot",boxpoints:"all",jitter:.3,hovertemplate:"<b>Box Plot</b><br>"+"".concat((Le==null?void 0:Le.name)||t.y,": %{y}<br>")+"<extra></extra>"};return Re.push(Zt),Re}case"violin":var Fe=[],nt=l.find(function(a){return a.key===t.x}),He=l.find(function(a){return a.key===t.y});if(t.x){var zt={};r.forEach(function(a){var L=a[t.x];zt[L]||(zt[L]=[]),zt[L].push(a[t.y])});var ta=Object.entries(zt).map(function(a,L){var pe=v()(a,2),me=pe[0],J=pe[1];return{type:"violin",y:J,name:me,box:{visible:!0},meanline:{visible:!0},marker:{color:h[L%h.length]},hovertemplate:"<b>".concat(me,"</b><br>")+"".concat((nt==null?void 0:nt.name)||t.x,": ").concat(me,"<br>")+"".concat((He==null?void 0:He.name)||t.y,": %{y}<br>")+"<extra></extra>"}});return ta}else{var Bt={type:"violin",y:r.map(function(a){return a[t.y]}),name:"Violin Plot",box:{visible:!0},meanline:{visible:!0},hovertemplate:"<b>Violin Plot</b><br>"+"".concat((He==null?void 0:He.name)||t.y,": %{y}<br>")+"<extra></extra>"};return Fe.push(Bt),Fe}case"heatmap":var aa=ge()(new Set(r.map(function(a){return a[t.x]}))),na=ge()(new Set(r.map(function(a){return a[t.y]}))),Nt=[];na.forEach(function(a,L){Nt[L]=[],aa.forEach(function(pe,me){var J=r.find(function(Ut){return Ut[t.x]===pe&&Ut[t.y]===a}),ve=J&&parseFloat(J[t.z])||0;Nt[L][me]=parseFloat(Y(ve))})});var mt=l.find(function(a){return a.key===t.x}),Lt=l.find(function(a){return a.key===t.y}),It=l.find(function(a){return a.key===t.z});return[{type:"heatmap",x:aa,y:na,z:Nt,colorscale:"Viridis",name:"Heatmap",hovertemplate:"<b>Heatmap</b><br>"+"".concat((mt==null?void 0:mt.name)||t.x,": %{x}<br>")+"".concat((Lt==null?void 0:Lt.name)||t.y,": %{y}<br>")+"".concat((It==null?void 0:It.name)||t.z,": %{z}<br>")+"<extra></extra>"}];case"pie":var vt={};r.forEach(function(a){var L=a[t.labels];vt[L]?vt[L]+=1:vt[L]=1});var pt=l.find(function(a){return a.key===t.labels});return[{type:"pie",labels:Object.keys(vt),values:Object.values(vt),textinfo:"label+percent",name:"Pie Chart",hovertemplate:"<b>%{label}</b><br>"+"".concat((pt==null?void 0:pt.name)||t.labels,": %{label}<br>")+"Count: %{value}<br>Percentage: %{percent}<br><extra></extra>"}];default:return[]}}catch(a){return console.error("Error generating plot data:",a),[]}},[r,b,t]),oe=(0,s.useMemo)(function(){var c=Ft[b],C=l.find(function(N){return N.key===t.x}),x=l.find(function(N){return N.key===t.y});return{title:(c==null?void 0:c.name)||"Chart",xaxis:{title:{text:(C==null?void 0:C.key)||t.x||"X Axis",standoff:20},automargin:!0,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickwidth:1,tickcolor:"#000",mirror:!0,gridcolor:"#f0f0f0",gridwidth:1,showgrid:!1},yaxis:{title:{text:(x==null?void 0:x.key)||t.y||"Y Axis",standoff:20},automargin:!0,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickwidth:1,tickcolor:"#000",mirror:!0,gridcolor:"#f0f0f0",gridwidth:1,showgrid:!1},margin:{t:30,l:50,r:15,b:50},showlegend:!0,legend:{orientation:"v",x:1.02,y:1,xanchor:"left",yanchor:"top",bgcolor:"rgba(255,255,255,0.8)",bordercolor:"#ccc",borderwidth:1},height:void 0,width:void 0,autosize:!0,plot_bgcolor:"rgba(0,0,0,0)",paper_bgcolor:"rgba(0,0,0,0)"}},[b,t,l]);return(0,e.jsx)("div",{className:"visualizer-container",children:(0,e.jsxs)(Je.Z,{gutter:[16,16],style:{height:"100%"},children:[(0,e.jsx)(ht.Z,{xs:24,lg:7,children:(0,e.jsx)(Xt.Z,{title:"Chart Configuration",size:"small",className:"control-panel",style:{height:"100%"},children:(0,e.jsxs)(et.Z,{direction:"vertical",style:{width:"100%"},size:"middle",children:[(0,e.jsxs)("div",{className:"config-section",children:[(0,e.jsx)("div",{className:"section-title",children:"Chart Type"}),(0,e.jsx)(it.default,{value:b,onChange:_,style:{width:"100%"},placeholder:"Select Chart Type",size:"middle",children:Object.entries(Ft).map(function(c){var C=v()(c,2),x=C[0],N=C[1];return(0,e.jsx)(Ya,{value:x,children:N.name},x)})})]}),(0,e.jsx)(Sr.Z,{}),(0,e.jsxs)("div",{className:"config-section",children:[(0,e.jsx)("div",{className:"section-title",children:"Variable Mapping"}),(0,e.jsx)(va.Z,{form:ae,layout:"vertical",className:"mapping-form",children:b&&((i=Ft[b])===null||i===void 0?void 0:i.mappings.map(function(c){var C=Ft[b].required.includes(c);return(0,e.jsx)(va.Z.Item,{label:(0,e.jsxs)("span",{children:[_a[c],C&&(0,e.jsx)("span",{className:"required-mark",children:" *"})]}),name:c,rules:C?[{required:!0,message:"This field is required"}]:[],children:(0,e.jsx)(it.default,{placeholder:"Select ".concat(_a[c]," Variable"),onChange:function(N){return O(c,N)},allowClear:!0,size:"middle",showSearch:!0,optionFilterProp:"children",children:V(c)})},c)}))})]}),(0,e.jsx)("div",{className:"status-info",children:(0,e.jsxs)(Cr,{type:"secondary",children:["Data Points: ",(r==null?void 0:r.length)||0," | Fields: ",(l==null?void 0:l.length)||0]})})]})})}),(0,e.jsx)(ht.Z,{xs:24,lg:17,children:(0,e.jsx)(Xt.Z,{title:"Chart Display",size:"small",className:"chart-panel",style:{height:"100%"},children:(0,e.jsx)("div",{className:"chart-container",children:X.length>0?(0,e.jsx)(wr.Z,{data:X,layout:oe,config:{responsive:!0,displayModeBar:!0,displaylogo:!1,modeBarButtonsToRemove:["pan2d","lasso2d","select2d"],toImageButtonOptions:{format:"png",filename:"chart",height:500,width:700,scale:1}},className:"plotly-container",style:{width:"100%",height:"100%"},useResizeHandler:!0},g):(0,e.jsxs)("div",{className:"empty-state",children:[(0,e.jsx)(jt.Z,{className:"empty-icon"}),(0,e.jsx)("div",{className:"empty-text",children:b?Object.keys(t).length===0?"Please configure variable mapping":"Please complete the required variable mapping configuration":"Please select a chart type to start visualization"}),r.length===0&&(0,e.jsx)(ka.Z,{message:"No data available",type:"error",description:"You should select your interested fields to visualize first."})]})})})})]})})},Zr=kr,zr=function(n,i){var r=n.filter(function(l){return l.key!==i});if(r.length!==0)return r[0]},ea=function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"metadata.tsv",r=gr().unparse(n,{delimiter:"	",quotes:!1}),l=new Blob(["\uFEFF"+r],{type:"text/tab-separated-values;charset=utf-8;"}),j=URL.createObjectURL(l),p=document.createElement("a");p.href=j,p.download=i,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(j)},Nr=function(n){var i,r,l,j=n.key,p=(0,gt.useLocation)(),b=(0,s.useState)(!1),m=v()(b,2),z=m[0],R=m[1],t=(0,s.useState)([]),M=v()(t,2),fe=M[0],y=M[1],g=(0,s.useState)(null),H=v()(g,2),o=H[0],Z=H[1],ae=(0,s.useState)({fields:[]}),Y=v()(ae,2),W=Y[0],K=Y[1],q=(0,s.useState)(!1),A=v()(q,2),_=A[0],O=A[1],F=(0,s.useState)({records:[],page:1,page_size:100,total:0}),V=v()(F,2),h=V[0],le=V[1],ne=(0,s.useState)([]),ee=v()(ne,2),X=ee[0],oe=ee[1],c=(0,s.useState)([]),C=v()(c,2),x=C[0],N=C[1],T=(0,s.useState)(h.page),E=v()(T,2),D=E[0],G=E[1],Se=(0,s.useState)(h.page_size),Oe=v()(Se,2),Ne=Oe[0],ce=Oe[1],lt=(0,s.useState)(void 0),Be=v()(lt,2),re=Be[0],ot=Be[1],Xe=(0,s.useState)(void 0),Pe=v()(Xe,2),S=Pe[0],Ue=Pe[1],Ye=(0,s.useState)(void 0),U=v()(Ye,2),we=U[0],xe=U[1],P=(0,s.useState)(null),B=v()(P,2),te=B[0],at=B[1],_e=(0,s.useState)(!1),st=v()(_e,2),qe=st[0],$e=st[1],kt=(0,s.useState)(!1),Ge=v()(kt,2),k=Ge[0],Q=Ge[1],he=(0,s.useState)(!1),se=v()(he,2),De=se[0],Re=se[1],ue=(0,s.useState)("summary"),Le=v()(ue,2),be=Le[0],ut=Le[1],Zt=(0,s.useState)(!1),Fe=v()(Zt,2),nt=Fe[0],He=Fe[1],zt=(0,s.useState)(void 0),ta=v()(zt,2),Bt=ta[0],aa=ta[1],na=(0,s.useState)(void 0),Nt=v()(na,2),mt=Nt[0],Lt=Nt[1],It=(0,s.useState)(!1),vt=v()(It,2),pt=vt[0],a=vt[1],L=(0,s.useState)({metadata:!1,data:!1,datafileTables:!1,rendering:!1}),pe=v()(L,2),me=pe[0],J=pe[1],ve=(0,s.useState)({current:0,total:0,message:""}),Ut=v()(ve,2),ra=Ut[0],Ve=Ut[1],Dr=(0,s.useState)(void 0),qa=v()(Dr,2),pa=qa[0],Pt=qa[1],Rr=(0,s.useState)(void 0),en=v()(Rr,2),ya=en[0],Dt=en[1],Tr=(0,s.useState)([]),tn=v()(Tr,2),$t=tn[0],an=tn[1],Mr=(0,s.useState)({}),nn=v()(Mr,2),ga=nn[0],rn=nn[1],Er=(0,s.useState)({}),ln=v()(Er,2),Gt=ln[0],on=ln[1],Or=(0,s.useState)({}),sn=v()(Or,2),Rt=sn[0],un=sn[1],Vr=(0,s.useState)({}),cn=v()(Vr,2),xa=cn[0],dn=cn[1],Ar=(0,s.useState)({}),fn=v()(Ar,2),ba=fn[0],hn=fn[1],Fr=(0,s.useState)({}),mn=v()(Fr,2),ct=mn[0],ja=mn[1],Br=(0,s.useState)({}),vn=v()(Br,2),Ht=vn[0],Lr=vn[1],Ir=function(){var w=j!=null?j:"";if(!w){var $=window.location.pathname,I=$.split("/").pop();if(!I)return gt.history.push("/"),"";w=I}return w},Ur=function(){var w=new URLSearchParams(window.location.search),$=w.get("version");return $!=null?$:void 0},$r=function(w,$){J(function(I){return u()(u()({},I),{},{metadata:!0})}),Ve({current:0,total:3,message:"Loading dataset metadata..."}),(0,tt.getDatasets)({page:1,page_size:1e3}).then(function(I){Ve(function(Ee){return u()(u()({},Ee),{},{current:1,message:"Processing dataset information..."})});var ye=I.records.filter(function(Ee){return Ee.key===w});if(!ye){gt.history.push("/");return}y(ye);var We=ye.sort(function(Ee,dt){return br().rcompare(Ee.version,dt.version)}),Ze=We[0],Ce=$!=null?$:Ze==null?void 0:Ze.version,Ae=ye.find(function(Ee){return Ee.version===Ce});!Ae&&Ze&&(Ae=Ze),console.log("latestDataset",Ze,"version",$,"sortedDatasets",We,"dataset",Ae,"filteredDatasets",ye),Ae?(Ue(Ae.version),Z(Ae),ce(Ae.total),Ve(function(Ee){return u()(u()({},Ee),{},{current:2,message:"Dataset metadata loaded"})})):(Te.ZP.error("Dataset not found"),gt.history.push("/")),J(function(Ee){return u()(u()({},Ee),{},{metadata:!1})})}).catch(function(I){I.handled||(Te.ZP.error("Failed to fetch the dataset metadata."),console.error("Failed to fetch the dataset metadata.",I),gt.history.push("/"),J(function(ye){return u()(u()({},ye),{},{metadata:!1})}))})};(0,s.useEffect)(function(){var d=Ir(),w=Ur();ot(d),Ue(w),console.log("datasetKey",d,"version",w),$r(d,w)},[p.pathname,p.search]),(0,s.useEffect)(function(){var d=function(){R(window.innerWidth<=768)};return d(),window.addEventListener("resize",d),function(){return window.removeEventListener("resize",d)}},[]),(0,s.useEffect)(function(){if(re&&S){var d="".concat(window.location.origin,"/datatable/").concat(re,"?version=").concat(S),w='<iframe width="1000" height="800" src="'.concat(d,'&hideHeader=true" title="BioMiner Indexd - ').concat(o==null?void 0:o.name,'" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>');aa(d),Lt(w),J(function($){return u()(u()({},$),{},{metadata:!0})}),Ve({current:0,total:2,message:"Loading data dictionary..."}),(0,tt.getDataDictionary)({key:re,version:S!=null?S:""}).then(function($){Ve(function(I){return u()(u()({},I),{},{current:1,message:"Processing data dictionary..."})}),K($),oe(oa($.fields)),Ve(function(I){return u()(u()({},I),{},{current:2,message:"Data dictionary loaded"})}),J(function(I){return u()(u()({},I),{},{metadata:!1})})}).catch(function($){$.handled||(Te.ZP.error("Failed to fetch the dataset data dictionary."),console.error("Failed to fetch the dataset data dictionary.",$),gt.history.push("/"),J(function(I){return u()(u()({},I),{},{metadata:!1})}))}),J(function($){return u()(u()({},$),{},{datafileTables:!0})}),(0,tt.getDatafileTables)({key:re,version:S!=null?S:""}).then(function($){an($),ja(u()(u()({},ct),$.reduce(function(I,ye){var We=oa(ye.data_dictionary.fields.filter(function(Ze){return Ze.key!==ye.id_column_name}),1);return I[ye.table_name]=[].concat(ge()(We),[ye.id_column_name]),I},{}))),J(function(I){return u()(u()({},I),{},{datafileTables:!1})})}).catch(function($){$.handled||(Te.ZP.error("Failed to fetch the dataset datafile tables."),console.error("Failed to fetch the dataset datafile tables.",$),J(function(I){return u()(u()({},I),{},{datafileTables:!1})}))})}},[re,S]),(0,s.useEffect)(function(){W.fields.length>0&&o&&O(!0)},[W,o]),(0,s.useEffect)(function(){N(W.fields.filter(function(d){return X.includes(d.key)}))},[W,X]),(0,s.useEffect)(function(){if(re&&S&&_){J(function(w){return u()(u()({},w),{},{data:!0})}),Ve({current:0,total:3,message:"Building query plan..."});var d=function(){var w=Ca()(Kt()().mark(function $(){var I,ye;return Kt()().wrap(function(Ze){for(;;)switch(Ze.prev=Ze.next){case 0:return Ve(function(Ce){return u()(u()({},Ce),{},{current:1,message:"Executing data query..."})}),I={table:"metadata_table",joins:[],selects:X.map(function(Ce){return{type:"field",value:Ce}}),filters:we,group_by:[],having:void 0,order_by:[],limit:Ne,offset:(D-1)*Ne,distinct:!1},we&&(I.query=we),Ze.next=5,(0,tt.fetchDatasetDataWithQueryPlan)({key:re,version:S!=null?S:""},{query_plan:JSON.stringify(I)}).catch(function(Ce){return Te.ZP.error("Failed to fetch the dataset data."),console.error("Failed to fetch the dataset data.",Ce),J(function(Ae){return u()(u()({},Ae),{},{data:!1})}),Ve({current:0,total:0,message:""}),{records:[],page:1,page_size:100,total:0}});case 5:ye=Ze.sent,Ve(function(Ce){return u()(u()({},Ce),{},{current:2,message:"Processing query result..."})}),le(ye),Ve(function(Ce){return u()(u()({},Ce),{},{current:3,message:"Data loaded, rendering components..."})}),J(function(Ce){return u()(u()({},Ce),{},{rendering:!0})}),setTimeout(function(){J(function(Ce){return u()(u()({},Ce),{},{rendering:!1,data:!1})}),Ve({current:0,total:0,message:""})},500);case 11:case"end":return Ze.stop()}},$)}));return function(){return w.apply(this,arguments)}}();d()}},[D,Ne,re,S,we,X,_]),(0,s.useEffect)(function(){var d;if(re&&S&&_){if(!$t.find(function(I){return I.table_name===be})){J(function(I){return u()(u()({},I),{},{data:!1})});return}console.log("Fetching data file table: ",be,we,h,_,ct,Gt,Rt),J(function(I){return u()(u()({},I),{},{data:!0})}),Ve({current:0,total:2,message:"Loading ".concat(be," table data...")});var w={field:(d=$t.find(function(I){return I.table_name===be}))===null||d===void 0?void 0:d.id_column_name,operator:"in",value:h.records.map(function(I){return I[Ct]})},$=function(){var I=Ca()(Kt()().mark(function ye(){var We,Ze,Ce,Ae,Ee,dt;return Kt()().wrap(function(ft){for(;;)switch(ft.prev=ft.next){case 0:return Ve(function(Ke){return u()(u()({},Ke),{},{current:1,message:"Querying data file..."})}),Ee={table:be,joins:[],selects:((We=ct[be])!==null&&We!==void 0?We:[]).map(function(Ke){return{type:"field",value:Ke}}),filters:w,group_by:[],having:void 0,order_by:[],limit:(Ze=Rt[be])!==null&&Ze!==void 0?Ze:100,offset:((Ce=Gt[be])!==null&&Ce!==void 0?Ce:0)*((Ae=Rt[be])!==null&&Ae!==void 0?Ae:100),distinct:!1},ft.next=4,(0,tt.fetchDatasetDataWithQueryPlan)({key:re,version:S!=null?S:""},{query_plan:JSON.stringify(Ee)}).catch(function(Ke){return Te.ZP.error("Failed to fetch the dataset data."),console.error("Failed to fetch the dataset data.",Ke),J(function(rt){return u()(u()({},rt),{},{data:!1})}),Ve({current:0,total:0,message:""}),{records:[],page:1,page_size:100,total:0}});case 4:dt=ft.sent,Ve(function(Ke){return u()(u()({},Ke),{},{current:2,message:"Processing data file result..."})}),rn(u()(u()({},ga),{},je()({},be,dt.records))),dn(u()(u()({},xa),{},je()({},be,dt.total))),J(function(Ke){return u()(u()({},Ke),{},{data:!1})}),Ve({current:0,total:0,message:""});case 10:case"end":return ft.stop()}},ye)}));return function(){return I.apply(this,arguments)}}();$()}},[be,we,h,_,ct,Gt,Rt]),(0,s.useEffect)(function(){var d;if(re&&S&&_){var w=$t.find(function(ye){return ye.table_name===be});if(w){var $=(d=ct[be])!==null&&d!==void 0?d:[],I=w.data_dictionary.fields.filter(function(ye){return $.includes(ye.key)});hn(u()(u()({},ba),{},je()({},be,I)))}}},[be,$t,ct]),(0,s.useEffect)(function(){ut(pt?"ai-copilot":"summary")},[pt]);var Gr=function(){G(1),ce(100)},Hr=function(){G(1),ce(100),xe(void 0),at(null),$e(!1),ut("summary"),Pt(void 0),Dt(void 0),an([]),rn({}),on({}),un({}),dn({}),hn({}),ja({})},Wr=function(w){console.log("setDatasetVersion",w),Ue(w),Hr(),gt.history.replace("/datatable/".concat(re,"?version=").concat(w))},ia=me.metadata||me.data||me.datafileTables||me.rendering,Kr=ra.total>0;return(0,e.jsxs)(Sn.Z,{spinning:ia,indicator:(0,e.jsx)(Tn.Z,{style:{fontSize:24},spin:!0}),children:[Kr&&(0,e.jsx)(ka.Z,{message:(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,e.jsx)("span",{children:ra.message}),(0,e.jsx)(wn.Z,{percent:Math.round(ra.current/ra.total*100),size:"small",style:{maxWidth:"calc(100% - 240px)"},showInfo:!1})]}),type:"info",showIcon:!0,style:{margin:"0 auto 16px",width:"50%"}}),(0,e.jsxs)("div",{className:"datatable-header",children:[(0,e.jsxs)("div",{className:"datatable-header-top",children:[(0,e.jsx)(Qe.Z.Title,{level:4,className:"datatable-title",children:o==null?void 0:o.name}),!ia&&(0,e.jsxs)("div",{className:"datatable-header-actions",children:[z?(0,e.jsx)(Mt.Z,{menu:{items:[{key:"download",label:"Download Dataset",icon:(0,e.jsx)(Vt.Z,{}),onClick:function(){return $e(!0)}},{key:"cite",label:"Cite Dataset",icon:(0,e.jsx)(bt.Z,{}),disabled:!(o!=null&&o.pmid),onClick:function(){window.open("https://www.ncbi.nlm.nih.gov/pubmed/".concat(o==null?void 0:o.pmid),"_blank")}},{key:"readme",label:"README",icon:(0,e.jsx)(bt.Z,{}),onClick:function(){(0,tt.getDatasetReadme)({key:re!=null?re:"",version:S!=null?S:""}).then(function(w){Pt(w||"No readme found")}).catch(function(w){w.handled||(Te.ZP.error("Failed to fetch the dataset readme."),Pt(void 0))})}},{key:"license",label:"License",icon:(0,e.jsx)(bt.Z,{}),onClick:function(){(0,tt.getDatasetLicense)({key:re!=null?re:"",version:S!=null?S:""}).then(function(w){Dt(w||"No license found")}).catch(function(w){w.handled||(Te.ZP.error("Failed to fetch the dataset license."),Dt(void 0))})}}]},trigger:["click"],children:(0,e.jsxs)(ie.ZP,{type:"default",children:["Actions ",(0,e.jsx)(Vt.Z,{})]})}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Me.Z,{title:"Download the dataset (each dataset might have at least two files: metadata table and datafile table which contain information about the data)",children:(0,e.jsx)(ie.ZP,{onClick:function(){$e(!0)},icon:(0,e.jsx)(Vt.Z,{}),type:"default",children:"Download Dataset"})}),(0,e.jsx)(Me.Z,{title:"Cite the dataset",placement:"top",children:(0,e.jsx)(ie.ZP,{disabled:!(o!=null&&o.pmid),onClick:function(){window.open("https://www.ncbi.nlm.nih.gov/pubmed/".concat(o==null?void 0:o.pmid),"_blank")},icon:(0,e.jsx)(bt.Z,{}),type:"default",children:"Cite Dataset"})}),(0,e.jsx)(Me.Z,{title:"Share the dataset",placement:"top",children:(0,e.jsx)(ie.ZP,{icon:(0,e.jsx)(Mn.Z,{}),type:"default",onClick:function(){He(!0)},children:"Share"})}),(0,e.jsx)(ie.ZP,{onClick:function(){(0,tt.getDatasetReadme)({key:re!=null?re:"",version:S!=null?S:""}).then(function(w){Pt(w||"No readme found")}).catch(function(w){w.handled||(Te.ZP.error("Failed to fetch the dataset readme."),Pt(void 0))})},icon:(0,e.jsx)(bt.Z,{}),type:"default",children:"README"}),(0,e.jsx)(ie.ZP,{onClick:function(){(0,tt.getDatasetLicense)({key:re!=null?re:"",version:S!=null?S:""}).then(function(w){Dt(w||"No license found")}).catch(function(w){w.handled||(Te.ZP.error("Failed to fetch the dataset license."),Dt(void 0))})},icon:(0,e.jsx)(bt.Z,{}),type:"default",children:"License"})]}),(0,e.jsx)(it.default,{defaultValue:S!=null?S:"Select Version",style:{width:120},options:fe.map(function(d){return{label:d.version,value:d.version}}),onChange:function(w){Wr(w)}})]})]}),(0,e.jsx)("p",{className:"datatable-description",dangerouslySetInnerHTML:{__html:(i=o==null?void 0:o.description)!==null&&i!==void 0?i:""}})]}),(0,e.jsxs)(Et.Z,{defaultActiveKey:"summary",activeKey:be,onChange:function(w){ut(w),w!=="ai-copilot"&&pt&&a(!1)},destroyOnHidden:!1,className:"datatable-tabs",tabBarExtraContent:(0,e.jsxs)(Je.Z,{className:"datatable-tabs-extra-content",children:[(0,e.jsx)(ht.Z,{className:"datatable-tabs-extra-content-left",children:ia?null:(0,e.jsxs)(e.Fragment,{children:[we&&(0,e.jsx)(Je.Z,{className:"datatable-filters",children:Rn(we,0,W.fields)}),(0,e.jsxs)(Qe.Z.Text,{style:{fontSize:16},className:"sample-file-count",children:["\u26A0\uFE0F Loaded ",h.records.length," ",o!=null&&o.is_filebased?"files":"samples",", ",h.total," ",o!=null&&o.is_filebased?"files":"samples"," in total.",(0,e.jsx)(Me.Z,{title:(0,e.jsxs)("span",{children:["If you want to load all the data, please click the button ",(0,e.jsxs)(Qt.Z,{color:"gray",children:["Load All (",h.total,")"]}),". But it will take a while to load."]}),children:(0,e.jsx)(En.Z,{style:{marginLeft:8}})}),(0,e.jsx)(ie.ZP,{disabled:h.records.length===h.total,onClick:function(){G(1),h.total>1e3&&Te.ZP.warning("The dataset is too large, it will take a while to load."),ce(h.total)},icon:(0,e.jsx)(On.Z,{}),type:"primary",size:"small",style:{marginLeft:8},children:"Load All"})]})]})}),(0,e.jsx)(ht.Z,{className:"datatable-tabs-extra-content-right",children:ia?null:z?(0,e.jsxs)(et.Z,{children:[(0,e.jsx)(ie.ZP,{type:"primary",onClick:function(){Q(!0)},icon:(0,e.jsx)(Ra.Z,{}),children:"Filter"}),(0,e.jsx)(Mt.Z,{menu:{items:[{key:"ai-copilot",label:"AI Copilot",icon:(0,e.jsx)(Ta.Z,{}),onClick:function(){a(!0)}},{key:"visualize",label:"Visualize",icon:(0,e.jsx)(jt.Z,{}),onClick:function(){Re(!0)}}]},trigger:["click"],children:(0,e.jsx)(ie.ZP,{children:"More Actions"})})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Me.Z,{title:"AI Copilot",children:(0,e.jsx)(ie.ZP,{onClick:function(){a(!0)},icon:(0,e.jsx)(Ta.Z,{}),type:"default",children:"AI Copilot"})}),(0,e.jsx)(ie.ZP,{onClick:function(){Re(!0)},icon:(0,e.jsx)(jt.Z,{}),type:"default",children:"Visualize"}),(0,e.jsx)(Na,{fields:W.fields,selectedKeys:X,onChange:oe}),(0,e.jsx)(ie.ZP,{type:"primary",onClick:function(){Q(!0)},icon:(0,e.jsx)(Ra.Z,{}),children:"Filter"})]})})]}),children:[(0,e.jsx)(Et.Z.TabPane,{tab:"Summary",children:(0,e.jsx)(rr,{fields:W.fields,data:h.records,isFileBased:(r=o==null?void 0:o.is_filebased)!==null&&r!==void 0?r:!1,total:h.total,selectedColumns:X,onClose:function(w){oe(X.filter(function($){return $!==w.key}))}})},"summary"),(0,e.jsx)(Et.Z.TabPane,{tab:"Clinical Data",children:(0,e.jsx)(Cn.Z,{type:"table",rows:8,loading:me.data,children:(0,e.jsx)(Ja,{className:"datatable-table",size:"small",dataSource:h.records,rowKey:function(w,$){var I;return(I=$==null?void 0:$.toString())!==null&&I!==void 0?I:""},scroll:{y:z?window.innerHeight-350:window.innerHeight-276,x:z?window.innerWidth-20:window.innerWidth-48},pagination:{position:["bottomRight"],pageSize:Ne,current:D,total:h.total,onChange:function(w,$){G(w),ce($)},showSizeChanger:!z,showQuickJumper:!z,pageSizeOptions:[100,200,300,500,1e3],simple:z},onCellClick:function(w,$,I){at(w)},dataDictionary:x,isFileBased:(l=o==null?void 0:o.is_filebased)!==null&&l!==void 0?l:!1})})},"table"),$t.map(function(d){var w,$,I,ye,We,Ze,Ce,Ae,Ee,dt,la,ft,Ke;return(0,e.jsx)(Et.Z.TabPane,{tab:(0,e.jsx)(Me.Z,{title:d.description,children:d.title}),children:(0,e.jsxs)(Je.Z,{children:[(0,e.jsx)(ie.ZP,{onClick:function(){Lr(u()(u()({},Ht),{},je()({},d.table_name,!Ht[d.table_name])))},className:"switch-".concat(d.table_name),icon:Ht[d.table_name]?(0,e.jsx)(jt.Z,{}):(0,e.jsx)(Vn.Z,{}),children:Ht[d.table_name]?"Show Charts":"Show Table"}),(0,e.jsx)(Na,{fields:d.data_dictionary.fields.filter(function(rt){return rt.key!==d.id_column_name}),selectedKeys:(w=ct[d.table_name])!==null&&w!==void 0?w:[],className:"column-selector-".concat(d.table_name),title:"Columns",onChange:function(Tt){ja(u()(u()({},ct),{},je()({},d.table_name,[].concat(ge()(Tt),[d.id_column_name]))))},mode:"single"}),Ht[d.table_name]?(0,e.jsx)(Ja,{className:"datatable-table",size:"small",dataSource:(Ee=ga[d.table_name])!==null&&Ee!==void 0?Ee:[],rowKey:function(Tt,Wt){var Sa;return(Sa=Wt==null?void 0:Wt.toString())!==null&&Sa!==void 0?Sa:""},scroll:{y:window.innerHeight-276,x:window.innerWidth-48},pagination:{position:["bottomRight"],pageSize:(dt=Rt[d.table_name])!==null&&dt!==void 0?dt:100,current:(la=Gt[d.table_name])!==null&&la!==void 0?la:1,total:(ft=xa[d.table_name])!==null&&ft!==void 0?ft:0,onChange:function(Tt,Wt){on(u()(u()({},Gt),{},je()({},d.table_name,Tt))),un(u()(u()({},Rt),{},je()({},d.table_name,Wt)))},showSizeChanger:!0,showQuickJumper:!0,pageSizeOptions:[100,200,300,500,1e3]},dataDictionary:(Ke=ba[d.table_name])!==null&&Ke!==void 0?Ke:[],isFileBased:!1}):(0,e.jsx)(Qn,{fields:W.fields.filter(function(rt){return X.find(function(Tt){return Tt===rt.key})&&!_n.includes(rt.key)}),data:jr(($=ga[d.table_name])!==null&&$!==void 0?$:[],h.records,{leftOn:(I=d.id_column_name)!==null&&I!==void 0?I:Ct,rightOn:Ct,how:"left"}),idColumnName:(ye=d.id_column_name)!==null&&ye!==void 0?ye:Ct,total:(We=xa[d.table_name])!==null&&We!==void 0?We:0,selectedColumns:(Ze=ct[d.table_name])!==null&&Ze!==void 0?Ze:[],yField:zr((Ce=ba[d.table_name])!==null&&Ce!==void 0?Ce:[],(Ae=d.id_column_name)!==null&&Ae!==void 0?Ae:Ct),onClose:function(){}})]})},d.table_name)}),pt?(0,e.jsx)(Et.Z.TabPane,{tab:"AI Copilot",children:(0,e.jsx)(pr.default,{embedded:!0,datasetKeyVersion:"".concat(re,":").concat(S)})},"ai-copilot"):null]}),(0,e.jsx)(Bn,{visible:k,onCancel:function(){return Q(!1)},onConfirm:function(w){Q(!1),console.log("QueryBuilder",w),xe(w),w||Gr()},dataDictionary:W}),te?(0,e.jsx)(yt.Z,{className:"datatable-data-info-modal",open:te!==null,width:800,onCancel:function(){return at(null)},footer:null,children:(0,e.jsx)(fr,{data:te,dataDictionary:W,title:"Patient ".concat(te.patient_id," - Details")})}):null,(0,e.jsx)(vr,{open:qe,onClose:function(){return $e(!1)},onDownloadMetadataTable:function(){if(Te.ZP.info("Downloading the metadata table, it will take a while. Please don't close or refresh the page."),h.records.length===h.total)ea(h.records,"metadata.tsv");else{if(!re||!S)return;(0,tt.getDatasetData)({key:re,version:S!=null?S:"",page:1,page_size:h.total}).then(function(w){ea(w.records,"metadata.tsv")}).catch(function(w){w.handled||(console.error("Failed to download the metadata table.",w),Te.ZP.error("Failed to download the metadata table, please try again later."))})}},onDownloadDatafiles:function(){if(Te.ZP.info("Downloading the datafiles, it will take a while. Please don't close or refresh the page."),!re){Te.ZP.error("Failed to download the datafiles, please try again later.");return}(0,tt.getDatafiles)({key:re,version:S!=null?S:""}).then(function(w){ea(w,"datafiles.tsv")}).catch(function(w){w.handled||(Te.ZP.error("Failed to download the datafiles, please try again later."),console.error("Failed to download the datafiles.",w))})}}),pa?(0,e.jsx)(yt.Z,{open:pa!==null,width:800,height:600,onCancel:function(){return Pt(void 0)},footer:null,title:(0,e.jsx)(Qe.Z.Title,{level:4,children:"README"}),children:(0,e.jsx)(fa.D,{remarkPlugins:[ha.Z],children:pa})}):null,ya?(0,e.jsx)(yt.Z,{open:ya!==null,width:800,height:600,onCancel:function(){return Dt(void 0)},footer:null,title:(0,e.jsx)(Qe.Z.Title,{level:4,children:"License"}),children:(0,e.jsx)(fa.D,{remarkPlugins:[ha.Z],children:ya})}):null,De?(0,e.jsx)(yt.Z,{open:De,width:"80%",onCancel:function(){return Re(!1)},footer:null,title:(0,e.jsx)(Qe.Z.Title,{level:4,children:"Selected Data Visualizer"}),children:(0,e.jsx)(Zr,{data:h.records,fieldDataDictionary:x})}):null,nt?(0,e.jsxs)(yt.Z,{open:nt,width:800,height:600,onCancel:function(){return He(!1)},footer:null,title:(0,e.jsx)(Qe.Z.Title,{level:4,children:"Share the dataset"}),children:[(0,e.jsxs)(et.Z,{children:[(0,e.jsx)(ie.ZP,{type:"default",onClick:function(){He(!1),navigator.clipboard.writeText(Bt!=null?Bt:""),Te.ZP.success("Link copied to clipboard")},children:"Copy Link"}),(0,e.jsx)(ie.ZP,{type:"default",onClick:function(){He(!1),navigator.clipboard.writeText(mt!=null?mt:""),Te.ZP.success("Iframe code copied to clipboard")},children:"Copy Embed Code"})]}),(0,e.jsxs)(Je.Z,{style:{marginTop:16},children:[(0,e.jsx)(Qe.Z.Text,{style:{fontSize:16},children:"You can use the following code to embed the dataset in your website or blog:"}),(0,e.jsx)(Qe.Z.Text,{copyable:!0,style:{fontSize:16,border:"1px solid #e0e0e0",padding:8,borderRadius:4},children:mt})]})]}):null]})},Pr=Nr}}]);
