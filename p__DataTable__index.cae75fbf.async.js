"use strict";(self.webpackChunkbiominer_indexd_studio=self.webpackChunkbiominer_indexd_studio||[]).push([[5524],{77281:function(Qr,wa,f){f.r(wa),f.d(wa,{default:function(){return Pr},downloadTSV:function(){return ta}});var pn=f(9783),Ce=f.n(pn),yn=f(15009),Qt=f.n(yn),gn=f(99289),Ca=f.n(gn),xn=f(19632),be=f.n(xn),bn=f(97857),u=f.n(bn),jn=f(5574),v=f.n(jn),s=f(67294),Ee=f(2453),Sn=f(74330),ka=f(38437),wn=f(26410),Je=f(21931),Et=f(85418),re=f(83622),Oe=f(83062),ot=f(89593),Ot=f(82494),Xe=f(71230),mt=f(15746),Jt=f(66309),tt=f(42075),gt=f(28248),Cn=f(79559),at=f(83170),st=f(94272),Vt=f(56717),kn=f(57619),Za=f(43425),Zn=f(55102),za=f(84567),e=f(85893),oa=function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6;return n.filter(function(r){return r.order<=5}).map(function(r){return r.key}).slice(0,i)},sa=500,Xt=10,zn=function(n){var i=n.className,r=n.title,l=n.fields,k=n.selectedKeys,p=n.onChange,j=n.mode,m=j===void 0?"multiple":j,z=(0,s.useState)(""),R=v()(z,2),t=R[0],M=R[1],me=(0,s.useState)(k),y=v()(me,2),g=y[0],U=y[1],o=(0,s.useState)(!1),Z=v()(o,2),ee=Z[0],J=Z[1],G=(0,s.useMemo)(function(){return l.filter(function(O){return O.name.toLowerCase().includes(t.toLowerCase())})},[t,l]),H=(0,s.useMemo)(function(){return G.slice(0,sa)},[G]),Y=function(B,V){U(m==="single"?[B]:V?[].concat(be()(g),[B]):g.filter(function(h){return h!==B}))},A=function(){if(k.length===l.length||k.length>=Xt)U(oa(l));else{var B=l.map(function(V){return V.key}).slice(0,Xt);U(B)}},X=(0,e.jsxs)("div",{style:{padding:8,width:400,backgroundColor:"white",borderRadius:8,border:"1px solid #d9d9d9"},children:[(0,e.jsxs)("div",{style:{marginBottom:8,display:"flex",gap:8},children:[m==="multiple"?(0,e.jsx)(Oe.Z,{title:"".concat(l.length," columns in total, Allow up to select ").concat(Xt," columns"),children:(0,e.jsx)(re.ZP,{size:"small",onClick:A,children:k.length===l.length?"Reset to default":"Select all (max ".concat(Xt," | ").concat(l.length," in total)")})}):(0,e.jsx)(Oe.Z,{title:"".concat(l.length," columns in total, Allow up to select one column"),children:(0,e.jsx)(re.ZP,{size:"small",children:"".concat(l.length," columns in total")})}),(0,e.jsx)(Zn.Z.Search,{placeholder:"Search...",size:"small",allowClear:!0,onChange:function(B){return M(B.target.value)},style:{flex:1}})]}),(0,e.jsxs)("div",{className:"column-selector-header",style:{fontWeight:"bold",display:"flex",padding:"4px 0"},children:[(0,e.jsx)("div",{style:{flex:1},children:"Name"}),(0,e.jsx)("div",{style:{width:50,textAlign:"right"},children:"Freq"})]}),(0,e.jsxs)("div",{style:{maxHeight:240,overflowY:"auto"},children:[H.map(function(O){return(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"2px 0"},children:[(0,e.jsxs)(za.Z,{checked:g.includes(O.key),onChange:function(V){return Y(O.key,V.target.checked)},style:{flex:1},children:[O.name,(0,e.jsx)(Oe.Z,{title:O.description||O.name,children:(0,e.jsx)(Vt.Z,{style:{marginLeft:4}})})]}),(0,e.jsx)("div",{style:{width:50,textAlign:"right",fontSize:12,color:"#888"},children:(0,e.jsx)(kn.Z,{})})]},O.key)}),G.length>sa&&(0,e.jsxs)("div",{style:{padding:"8px 0",textAlign:"center",color:"#888",fontSize:12},children:["Showing ",sa," of ",G.length," fields. Use search to find more."]})]}),(0,e.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,e.jsx)(re.ZP,{type:"primary",onClick:function(){p(g),J(!1),M("")},style:{marginTop:8},children:"Apply"})})]});return(0,e.jsx)(Et.Z,{overlay:X,trigger:["click"],open:ee,onOpenChange:J,children:(0,e.jsx)(re.ZP,{icon:(0,e.jsx)(Za.Z,{}),className:"".concat(i),children:r!=null?r:"Select Columns"})})},Na=zn,Nn=f(52677),Pa=f.n(Nn),Da=["purple","green","geekblue","volcano","cyan","magenta"],Pn=function(n){return Pa()(n)==="object"&&"field"in n&&"value"in n},Dn=function(n,i,r,l){var k,p="";Array.isArray(n.value)?p=n.value.join(", "):p="".concat(n.value);var j=(k=l.find(function(m){return m.key===n.field}))===null||k===void 0?void 0:k.name;return(0,e.jsxs)(Jt.Z,{color:i,style:{marginBottom:0,marginRight:0,borderRadius:5},children:[(0,e.jsx)("strong",{children:j})," ",n.operator," ",(0,e.jsx)("strong",{children:p})]},r)},Rn=function he(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,l=Da[i%Da.length];return(0,e.jsxs)(tt.Z,{size:[8,4],style:{marginBottom:0,height:"100%",overflowX:"scroll"},children:[(0,e.jsx)("span",{style:{marginRight:4,color:"#999"},children:"("}),n.items&&n.items.length>0&&n.items.map(function(k,p){return(0,e.jsxs)(s.Fragment,{children:[Pn(k)?Dn(k,l,p,r):he(k,i+1,r),p!==n.items.length-1&&(0,e.jsx)("span",{style:{margin:"0 6px",color:"#666",fontWeight:500,fontSize:13},children:n.operator.toUpperCase()})]},p)}),(0,e.jsx)("span",{style:{marginLeft:4,color:"#999"},children:")"})]})},Tn=f(79090),At=f(69753),bt=f(97245),Mn=f(20046),En=f(63783),On=f(85060),Ra=f(43031),Ta=f(50228),jt=f(61086),Vn=f(15611),An=f(64599),St=f.n(An),Bn=function(n){var i=n.visible,r=n.onCancel,l=n.onConfirm,k=n.dataDictionary,p=(0,s.useState)({operator:"and",rules:[]}),j=v()(p,2),m=j[0],z=j[1],R=function(o){var Z;return((Z=k.fields.find(function(ee){return ee.key===o}))===null||Z===void 0?void 0:Z.data_type)||"STRING"},t=function(o){switch(o.toUpperCase()){case"NUMBER":return["=","!=","<","<=",">",">=","in","not in"];case"STRING":return["=","!=","like","not like","ilike","in","not in"];case"BOOLEAN":return["=","!=","in","not in"];default:return["="]}},M=function(o,Z,ee){var J,G,H,Y=R(o.field),A=t(Y),X=["in","not in"].includes(o.operator),O=function(h){var ie=u()({},m),te=ie,_=St()(Z),Q;try{for(_.s();!(Q=_.n()).done;){var le=Q.value;te=te.rules[le]}}catch(c){_.e(c)}finally{_.f()}te.rules[ee]=u()(u()({},te.rules[ee]),h),z(ie)},B=function(){var h=u()({},m),ie=h,te=St()(Z),_;try{for(te.s();!(_=te.n()).done;){var Q=_.value;ie=ie.rules[Q]}}catch(le){te.e(le)}finally{te.f()}ie.rules.splice(ee,1),z(h)};return(0,e.jsxs)(tt.Z,{align:"start",children:[(0,e.jsx)(ot.default,{value:o.field,onChange:function(h){return O({field:h,operator:t(R(h))[0],value:""})},options:k.fields.map(function(V){return{label:V.name,value:V.key}}),style:{width:160}}),(0,e.jsx)(ot.default,{value:o.operator,onChange:function(h){return O({operator:h,value:""})},options:A.map(function(V){return{label:V,value:V}}),style:{width:120}}),(0,e.jsx)(ot.default,{mode:X?"multiple":void 0,value:X?(J=o.value)!==null&&J!==void 0?J:[]:(G=o.value)!==null&&G!==void 0?G:null,onChange:function(h){return O({value:h})},options:((H=k.fields.find(function(V){return V.key===o.field}))===null||H===void 0||(H=H.allowed_values)===null||H===void 0?void 0:H.map(function(V){return{label:V,value:V}}))||[],style:{width:200}}),(0,e.jsx)(re.ZP,{danger:!0,onClick:B,children:"Remove"})]},ee)},me=function U(o){var Z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],ee=Z.length===0,J=function(){for(var H=u()({},m),Y=H,A=0;A<Z.length-1;A++)Y=Y.rules[Z[A]];Y.rules.splice(Z[Z.length-1],1),z(H)};return(0,e.jsx)("div",{style:{border:"1px solid #ddd",padding:12,marginBottom:12},children:(0,e.jsxs)(tt.Z,{direction:"vertical",style:{width:"100%"},children:[(0,e.jsxs)(tt.Z,{align:"center",children:[(0,e.jsx)(ot.default,{value:o.operator,onChange:function(H){var Y=u()({},m),A=Y,X=St()(Z),O;try{for(X.s();!(O=X.n()).done;){var B=O.value;A=A.rules[B]}}catch(V){X.e(V)}finally{X.f()}A.operator=H,z(Y)},options:[{label:"AND",value:"and"},{label:"OR",value:"or"}],style:{width:80}}),!ee&&(0,e.jsx)(re.ZP,{danger:!0,size:"small",onClick:J,children:"Remove Group"})]}),o.rules.map(function(G,H){return"field"in G?M(G,Z,H):U(G,[].concat(be()(Z),[H]))}),(0,e.jsxs)(tt.Z,{children:[(0,e.jsx)(re.ZP,{onClick:function(){var H,Y=u()({},m),A=Y,X=St()(Z),O;try{for(X.s();!(O=X.n()).done;){var B=O.value;A=A.rules[B]}}catch(ie){X.e(ie)}finally{X.f()}var V=(H=k.fields[0])===null||H===void 0?void 0:H.key,h=t(R(V))[0];A.rules.push({field:V,operator:h,value:""}),z(Y)},children:"+ Add Rule"}),(0,e.jsx)(re.ZP,{onClick:function(){var H=u()({},m),Y=H,A=St()(Z),X;try{for(A.s();!(X=A.n()).done;){var O=X.value;Y=Y.rules[O]}}catch(B){A.e(B)}finally{A.f()}Y.rules.push({operator:"and",rules:[]}),z(H)},children:"+ Add Group"})]})]})},Z.join("-"))},y=function(o,Z,ee){return ee==="is"||ee==="is not"?null:Array.isArray(o)?Z==="NUMBER"?o.map(Number):Z==="BOOLEAN"?o.map(function(J){return J==="true"}):o:Z==="BOOLEAN"?o==="true":Z==="NUMBER"?o.toString().includes(".")?parseFloat(o):parseInt(o):o},g=function U(o){var Z=o.rules.map(function(ee){return"field"in ee?{field:ee.field,operator:ee.operator,value:y(ee.value,R(ee.field),ee.operator)}:U(ee)}).filter(Boolean);return Z.length===0?null:{operator:o.operator,items:Z}};return(0,e.jsx)(gt.Z,{open:i,title:"Build Query",onCancel:r,footer:[(0,e.jsx)(re.ZP,{onClick:r,children:"Cancel"},"cancel"),(0,e.jsx)(re.ZP,{type:"primary",onClick:function(){return l(g(m))},children:"Enter"},"confirm")],width:900,children:me(m)})},Fn=Bn,Ma=f(38928),xt=f(3003),Ne=f(32983),Yt=f(4393),ua=f(55241),Ea=f(31326),Oa=f(28508),Ln=f(78677),Va=f(94229),Ue=f(96486),In=f(25478),Aa=f.n(In),Ba=f(84922),wt=(0,Ba.default)(Aa()),Jr="sample_id",Pe=20,Fa=function(n){return n.every(function(i){return i==null||i===""})},$n=[{label:"Bar Chart",value:"bar"},{label:"Box Plot",value:"box"},{label:"Violin Plot",value:"violin"},{label:"Scatter Plot",value:"scatter"},{label:"Histogram",value:"histogram"},{label:"KM Plot",value:"kmplot"},{label:"Summary",value:"summary"},{label:"Unsupported",value:"unsupported"}],Un=function(n,i,r){return n.filter(function(l){var k=l[i.key],p=l[r.key];return k!=null&&k!==""&&p!==null&&p!==void 0&&p!==""}).map(function(l){return u()(Ce()(Ce()({},i.key,l[i.key]),r.key,l[r.key]),l)})},Gn=function(n,i,r){var l=(0,Ue.groupBy)(n,i.key);return Object.entries(l).map(function(k){var p=v()(k,2),j=p[0],m=p[1],z=m.map(function(o){return o[r.key]}).filter(function(o){return typeof o=="number"&&!isNaN(o)}).map(function(o){return Number(o)});if(z.length===0)return{group:j,count:m.length,mean:0,median:0,min:0,max:0,std:0,values:[]};var R=(0,Ue.meanBy)(z),t=z.sort(function(o,Z){return o-Z}),M=t.length%2===0?(t[t.length/2-1]+t[t.length/2])/2:t[Math.floor(t.length/2)],me=Math.min.apply(Math,be()(z)),y=Math.max.apply(Math,be()(z)),g=z.reduce(function(o,Z){return o+Math.pow(Z-R,2)},0)/z.length,U=Math.sqrt(g);return{group:j,count:m.length,mean:R,median:M,min:me,max:y,std:U,values:z}})},La=function(n){var i=n.statsData,r=n.xField,l=n.yField,k=n.total,p=[{title:r.name,dataIndex:"group",width:"20%",ellipsis:!0},{title:"Count",dataIndex:"count",width:"10%"},{title:"Mean",dataIndex:"mean",width:"12%",render:function(m){return m.toFixed(2)}},{title:"Median",dataIndex:"median",width:"12%",render:function(m){return m.toFixed(2)}},{title:"Min",dataIndex:"min",width:"10%",render:function(m){return m.toFixed(2)}},{title:"Max",dataIndex:"max",width:"10%",render:function(m){return m.toFixed(2)}},{title:"Std",dataIndex:"std",width:"12%",render:function(m){return m.toFixed(2)}},{title:"Freq (%)",dataIndex:"count",width:"14%",render:function(m){return(0,e.jsxs)("span",{style:{color:"#1890ff"},children:[(m/k*100).toFixed(2),"%"]})}}];return(0,e.jsx)(xt.Z,{dataSource:i,columns:p,rowKey:function(m,z){return"".concat(m.group,"-").concat(z)},showHeader:!0,size:"small",pagination:!1,sticky:!0,scroll:{x:600}})},Ia=function(n,i){return n.data_type==="STRING"&&i.data_type==="NUMBER"?"box":n.data_type==="NUMBER"&&i.data_type==="NUMBER"?"scatter":n.data_type==="STRING"&&i.data_type==="STRING"?"summary":"unsupported"},Hn=function(n){var i=n.fields,r=n.allFields,l=n.data,k=n.selectedColumns,p=n.groupByField,j=n.onClose,m=n.className,z=n.resize,R=n.total,t=n.allowChangeChartType,M=t===void 0?!1:t,me=n.idColumnName,y=i.find(function(N){return N.key===p}),g=i.find(function(N){return N.key!==p}),U=(0,s.useState)(y&&g?Ia(y,g):"unsupported"),o=v()(U,2),Z=o[0],ee=o[1],J=64,G=(0,s.useState)(300),H=v()(G,2),Y=H[0],A=H[1],X=(0,s.useState)(300),O=v()(X,2),B=O[0],V=O[1],h=(0,s.useState)("Grouped Analysis"),ie=v()(h,2),te=ie[0],_=ie[1],Q=(0,s.useRef)(null),le=(0,s.useRef)(null),c=(0,s.useMemo)(function(){return!y||!g?[]:Un(l,y,g)},[l,y,g]),w=(0,s.useMemo)(function(){return!y||!g?[]:Gn(c,y,g)},[c,y,g]);(0,s.useEffect)(function(){y&&g&&_("".concat(g.name," by ").concat(y.name))},[y,g]),(0,s.useEffect)(function(){if(z){var N=new ResizeObserver(function(){var E,D,$;(E=Q.current)!==null&&E!==void 0&&(E=E.chart)!==null&&E!==void 0&&E.forceFit?Q.current.chart.forceFit():window.dispatchEvent(new Event("resize")),A((((D=le.current)===null||D===void 0?void 0:D.clientHeight)||332)-J),V((($=le.current)===null||$===void 0?void 0:$.clientWidth)||300),z==null||z()});if(le.current){var T;N.observe(le.current),A((((T=le.current)===null||T===void 0?void 0:T.clientHeight)||332)-J)}return function(){N.disconnect()}}},[]);var x=function(){if(!p)return(0,e.jsx)(Ne.Z,{description:"Please select a group by field",className:"chart-empty"});if(i.length<2)return(0,e.jsx)(Ne.Z,{description:"Please select at least two fields",className:"chart-empty"});if(!i.some(function(C){return C.key===p}))return(0,e.jsx)(Ne.Z,{description:"The group by field is not in the fields",className:"chart-empty"});if(!y||!g)return(0,e.jsx)(Ne.Z,{description:"Please select two fields for grouped analysis",className:"chart-empty"});if(Fa(l.map(function(C){return C[y.key]})))return(0,e.jsx)(Ne.Z,{description:(0,e.jsxs)("span",{children:["All values in ",(0,e.jsx)(Jt.Z,{color:"warning",children:y.name})," are missing"]}),className:"chart-empty"});if(Fa(l.map(function(C){return C[g.key]})))return(0,e.jsx)(Ne.Z,{description:(0,e.jsxs)("span",{children:["All values in ",(0,e.jsx)(Jt.Z,{color:"warning",children:g.name})," are missing"]}),className:"chart-empty"});if(c.length===0)return(0,e.jsx)(Ne.Z,{description:"No valid data for grouped analysis",className:"chart-empty"});if(Z==="summary")return(0,e.jsx)(La,{statsData:w,xField:y,yField:g,total:R});if(Z==="bar")if(y.data_type==="STRING"&&g.data_type==="NUMBER"){var T=(0,Ue.groupBy)(c,y.key),E=["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#fa541c","#2f54eb"],D=Object.keys(T),$=D.map(function(C){var W=T[C],ve=W.map(function(oe){return oe[g.key]}).filter(function(oe){return typeof oe=="number"&&!isNaN(oe)}).map(function(oe){return Number(oe)});return ve.length>0?(0,Ue.meanBy)(ve):0}),ke=D.map(function(C){var W=T[C],ve=W.map(function(se){return se[g.key]}).filter(function(se){return typeof se=="number"&&!isNaN(se)}).map(function(se){return Number(se)});if(ve.length>1){var oe=(0,Ue.meanBy)(ve),Te=(0,Ue.sumBy)(ve,function(se){return Math.pow(se-oe,2)})/(ve.length-1),Me=Math.sqrt(Te);return Me/Math.sqrt(ve.length)}return 0});return(0,e.jsx)(wt,{data:[{x:D,y:$,error_y:{type:"data",array:ke,visible:!0,color:"#666",thickness:1.5,width:4},type:"bar",marker:{color:D.map(function(C,W){return E[W%E.length]})},text:D.map(function(C,W){return"n=".concat(T[C].length)}),textposition:"outside",textfont:{size:Pe,color:"#666"}}],layout:{width:B,height:Y,margin:{l:60,r:20,t:40,b:80},xaxis:{title:{text:y.name,font:{size:Pe,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,tickfont:{size:Pe-2,color:"#000"},automargin:!0},yaxis:{title:{text:"Mean ".concat(g.name),font:{size:Pe,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickfont:{size:Pe-2,color:"#000"}},plot_bgcolor:"#fff",paper_bgcolor:"#fff",showlegend:!1}})}else{var Ve=(0,Ue.groupBy)(c,y.key),De=["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#fa541c","#2f54eb"],fe=Object.entries(Ve).map(function(C,W){var ve=v()(C,2),oe=ve[0],Te=ve[1];return{type:oe,value:Te.length,count:Te.length}});return(0,e.jsx)(Ln.Z,{autoFit:!0,data:fe,xField:"type",yField:"value",seriesField:"type",ref:Q,xAxis:{title:{text:y.name},label:{autoRotate:!0}},yAxis:{title:{text:"Count"}},columnStyle:{radius:[2,2,0,0]},color:De})}if(Z==="box"){var ut=(0,Ue.groupBy)(c,y.key),Le=Object.entries(ut).map(function(C,W){var ve=v()(C,2),oe=ve[0],Te=ve[1],Me=Te.map(function(se){return se[g.key]}).filter(function(se){return typeof se=="number"&&!isNaN(se)}).map(function(se){return Number(se)});return{y:Me,x:oe,type:"box",name:oe.length>10?oe.slice(0,10)+"\u2026":oe,boxpoints:"outliers",marker:{color:["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#fa541c","#2f54eb"][W%8]},line:{color:["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#fa541c","#2f54eb"][W%8]}}});return(0,e.jsx)(wt,{data:Le,layout:{width:B,height:Y,margin:{l:60,r:20,t:40,b:80},xaxis:{title:{text:y.name,font:{size:Pe,color:"#000"},type:"category"},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,tickfont:{size:Pe-2,color:"#000"},automargin:!0},yaxis:{title:{text:g.name,font:{size:Pe,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickfont:{size:Pe-2,color:"#000"}},showlegend:!0,plot_bgcolor:"#fff",paper_bgcolor:"#fff"}})}if(Z==="violin"){var ae=(0,Ue.groupBy)(c,y.key),ct=Object.entries(ae).map(function(C,W){var ve=v()(C,2),oe=ve[0],Te=ve[1],Me=Te.map(function(se){return se[g.key]}).filter(function(se){return typeof se=="number"&&!isNaN(se)}).map(function(se){return Number(se)});return{y:Me,type:"violin",name:oe.length>10?oe.slice(0,10)+"\u2026":oe,box:{visible:!0},meanline:{visible:!0},fillcolor:["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#fa541c","#2f54eb"][W%8],opacity:.6,line:{color:["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#fa541c","#2f54eb"][W%8]}}});return(0,e.jsx)(wt,{data:ct,layout:{width:B,height:Y,margin:{l:60,r:20,t:40,b:80},xaxis:{title:{text:y.name,font:{size:Pe,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,tickfont:{size:Pe-2,color:"#000"},automargin:!0},yaxis:{title:{text:g.name,font:{size:Pe,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickfont:{size:Pe-2,color:"#000"}},violinmode:"group",showlegend:!0,plot_bgcolor:"#fff",paper_bgcolor:"#fff"}})}if(Z==="scatter")if(y.data_type==="NUMBER"&&g.data_type==="NUMBER"){var Ye=i.find(function(C){return C.key!==y.key&&C.key!==g.key&&C.data_type==="STRING"}),Re=["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#fa541c","#2f54eb"],S;if(Ye&&k!==null&&k!==void 0&&k.includes(Ye.key)){var Ge=(0,Ue.groupBy)(c,Ye.key);S=Object.entries(Ge).map(function(C,W){var ve=v()(C,2),oe=ve[0],Te=ve[1];return{x:Te.map(function(Me){return Me[y.key]}),y:Te.map(function(Me){return Me[g.key]}),type:"scatter",mode:"markers",name:oe.length>10?oe.slice(0,10)+"\u2026":oe,marker:{size:8,color:Re[W%Re.length],opacity:.7}}})}else S=[{x:c.map(function(C){return C[y.key]}),y:c.map(function(C){return C[g.key]}),type:"scatter",mode:"markers",marker:{size:8,color:"#1890ff",opacity:.7},name:"".concat(g.name," vs ").concat(y.name)}];return(0,e.jsx)(wt,{data:S,layout:{width:B,height:Y,margin:{l:60,r:20,t:40,b:60},xaxis:{title:{text:y.name,font:{size:Pe,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickfont:{size:Pe-2,color:"#000"}},yaxis:{title:{text:g.name,font:{size:Pe,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickfont:{size:Pe-2,color:"#000"}},plot_bgcolor:"#fff",paper_bgcolor:"#fff",showlegend:S.length>1}})}else return(0,e.jsx)(Ne.Z,{description:"Scatter plot requires both fields to be numeric",className:"chart-empty"});if(Z==="histogram")if(y.data_type==="NUMBER"&&g.data_type==="NUMBER"){var _e=(0,Ue.groupBy)(c,y.key),I=Object.entries(_e).map(function(C){var W=v()(C,2),ve=W[0],oe=W[1];return{x:oe.map(function(Te){return Te[g.key]}),type:"histogram",name:"".concat(y.name,": ").concat(ve),opacity:.7}});return(0,e.jsx)(wt,{data:I,layout:{width:B,height:Y,margin:{l:60,r:20,t:40,b:60},xaxis:{title:{text:g.name,font:{size:Pe,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,tickfont:{size:Pe-2,color:"#000"}},yaxis:{title:{text:"Frequency",font:{size:Pe,color:"#000"}},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickfont:{size:Pe-2,color:"#000"}},barmode:"overlay",plot_bgcolor:"#fff",paper_bgcolor:"#fff"}})}else if(g.data_type==="NUMBER"){var Ze=c.map(function(C){return C[g.key]}).filter(function(C){return typeof C=="number"&&!isNaN(C)});return(0,e.jsx)(Va.Z,{autoFit:!0,data:Ze.map(function(C){return{value:C}}),binField:"value",binWidth:10,ref:Q,xAxis:{title:{text:g.name}},yAxis:{title:{text:"Frequency"}}})}else return(0,e.jsx)(Ne.Z,{description:"Histogram requires numeric fields",className:"chart-empty"});if(Z==="kmplot")if(y.data_type==="STRING"){var je="",P="";y.key.includes("os")?(je="os_months",P="os_status"):y.key.includes("dfs")?(je="dfs_months",P="dfs_status"):y.key.includes("rfs")?(je="rfs_months",P="rfs_status"):y.key.includes("dmfs")&&(je="dmfs_months",P="dmfs_status");var F=i.find(function(C){return C.key===je})||r.find(function(C){return C.key===je}),q=i.find(function(C){return C.key===P})||r.find(function(C){return C.key===P});if(console.log("KM Plot - timeField",F," eventField",q,"fields",i),!F||!q)return(0,e.jsx)(Ne.Z,{description:"KM Plot requires valid time/event fields, like os_months, os_status, dfs_months, dfs_status, rfs_months, rfs_status, dmfs_months, dmfs_status.",className:"chart-empty"});var nt=function(W){return W==="1"||W===1||W===!0||W===1?1:W==="0"||W===0||W===!1||W===0?0:typeof W=="string"&&W.startsWith("1")?1:(typeof W=="string"&&W.startsWith("0"),0)},qe=c.filter(function(C){return C[F.key]!==null&&C[q.key]!==null}).map(function(C){return u()(u()({},C),{},Ce()(Ce()({},F.key,Number(C[F.key])),q.key,nt(C[q.key])))}).sort(function(C,W){return C.time-W.time}),dt={};if(["STRING","BOOLEAN"].includes(g.data_type))dt=(0,Ue.groupBy)(qe,g.key);else if(g.data_type==="NUMBER"){var et=qe.map(function(C){return Number(C[g.key])}).filter(function(C){return!isNaN(C)}),He=et.sort(function(C,W){return C-W})[Math.floor(et.length/2)];dt=Ce()(Ce()({},"<= median (".concat(He.toFixed(2),")"),qe.filter(function(C){return Number(C[g.key])<=He})),"> median (".concat(He.toFixed(2),")"),qe.filter(function(C){return Number(C[g.key])>He}))}console.log("KM Plot - grouped",dt,"formattedData",qe);var kt=["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#fa541c","#2f54eb"],We=Object.entries(dt).map(function(C,W){var ve=v()(C,2),oe=ve[0],Te=ve[1],Me=Te.filter(function(Fe){return typeof Fe[F.key]=="number"&&(Fe[q.key]===1||Fe[q.key]===0)}).sort(function(Fe,rt){return Fe[F.key]-rt[F.key]}),se=Me.length,Ie=1,Se=[0],ft=[1],Zt=[];return Me.forEach(function(Fe){var rt=Fe[F.key],Ke=Fe[q.key];Ke===1&&(Ie=Ie*(se-1)/se),se-=1,Se.push(rt),ft.push(Ie),Zt.push("Sample ID: ".concat(Fe[me]||"N/A","<br>")+"% event free: ".concat((Ie*100).toFixed(2),"%<br>")+"Time of event: ".concat(rt.toFixed(2)," months<br>")+"Number of patients at risk: ".concat(se))}),{x:Se,y:ft,text:Zt,type:"scatter",mode:"lines+markers",name:"".concat(oe," (n=").concat(Me.length,")"),line:{shape:"hv",color:kt[W%kt.length]},hovertemplate:"%{text}<extra></extra>"}});return(0,e.jsx)(wt,{data:We,layout:{width:B,height:Y,margin:{l:80,r:20,t:40,b:80},xaxis:{title:F.name,showline:!0,linewidth:1,linecolor:"#000"},yaxis:{title:"Survival Probability",range:[0,1.05],tickformat:".0%",showline:!0,linewidth:1,linecolor:"#000"},hovermode:"x unified",legend:{orientation:"h",x:0,y:-.2,bgcolor:"rgba(255,255,255,0.9)",bordercolor:"#000",borderwidth:1},plot_bgcolor:"#fff",paper_bgcolor:"#fff",hoverlabel:{bgcolor:"rgba(255,255,255,0.9)",font:{color:"#000",size:12,family:"Arial"},align:"left",bordercolor:"#ccc",namelength:0}}})}else return(0,e.jsx)(Ne.Z,{description:"KM Plot requires categorical grouping variable (X-axis), like os_status, dfs_status, rfs_status, dmfs_status.",className:"chart-empty"});return(0,e.jsx)(Ne.Z,{description:"Unsupported chart type: ".concat(Z),className:"chart-empty"})};return(0,e.jsx)(Xe.Z,{className:"grouped-chart-card",children:(0,e.jsx)(Yt.Z,{size:"small",title:(0,e.jsx)("div",{className:"chart-drag-handle",children:te}),extra:(0,e.jsxs)(tt.Z,{size:0,children:[(0,e.jsx)(ua.Z,{placement:"topRight",content:(0,e.jsx)(La,{statsData:w,xField:y,yField:g,total:R}),title:null,style:{width:"800px"},prefixCls:"grouped-chart-card-table-popover",trigger:"click",destroyOnHidden:!0,children:(0,e.jsx)(re.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Ea.Z,{})})}),(0,e.jsx)(Oe.Z,{title:"".concat(y==null?void 0:y.name," vs ").concat(g==null?void 0:g.name," Grouped Analysis"),children:(0,e.jsx)(re.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Vt.Z,{})})}),M&&(0,e.jsx)(Oe.Z,{title:"Switch Chart Type",children:(0,e.jsx)(ot.default,{style:{width:150},options:$n,value:Z,onChange:function(T){ee(T)}})}),j&&(0,e.jsx)(re.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Oa.Z,{}),onClick:j})]}),className:m,ref:le,children:x()})})},Wn=Hn,$a=f(46312),_t=5,Ua={bar:{w:128,h:64},box:{w:128,h:64},violin:{w:128,h:64},scatter:{w:128,h:64},histogram:{w:128,h:64},summary:{w:128,h:64},kmplot:{w:128,h:64},default:{w:128,h:64}},Kn=function(n){var i=n.fields,r=n.data,l=n.total,k=n.selectedColumns,p=n.yField,j=n.onClose,m=n.idColumnName;console.log("yField",p,"fields",i,"selectedColumns",k,"data",r,"total",l);var z=(0,s.useRef)(null),R=(0,s.useRef)(null),t=(0,s.useState)(!1),M=v()(t,2),me=M[0],y=M[1],g=(0,s.useState)(i),U=v()(g,2),o=U[0],Z=U[1],ee=(0,s.useState)({}),J=v()(ee,2),G=J[0],H=J[1],Y=function(X,O){if(G[X])return G[X];var B=Ua[O]||Ua.default,V=B.w,h=B.h;return{width:V*_t,height:h*_t}};return(0,s.useEffect)(function(){return z.current&&(R.current=new Ma.Z(z.current,{dragEnabled:!0,layoutOnInit:!0,layoutDuration:300,layoutEasing:"ease",dragSort:!0,dragSortPredicate:{threshold:50,action:"move"},dragStartPredicate:{distance:10,delay:100},dragHandle:".chart-drag-handle"})),function(){var A;(A=R.current)===null||A===void 0||A.destroy()}},[o]),p?(0,e.jsx)(Xe.Z,{className:"grouped-visual-panel-container",children:(0,e.jsx)("div",{className:"muuri-grid",ref:z,children:o.map(function(A){var X=Ia(A,p),O=Y(A.key,X),B=O.width,V=O.height,h={width:"".concat(B,"px"),height:"".concat(V,"px")},ie=[A,p];return(0,e.jsx)("div",{className:"item",style:h,children:(0,e.jsx)("div",{className:"item-content",children:(0,e.jsx)($a.e,{defaultSize:{width:B,height:V},minWidth:5*_t,minHeight:5*_t,onResizeStart:function(){return y(!0)},onResizeStop:function(_,Q,le){var c,w;y(!1);var x=le.offsetWidth,N=le.offsetHeight;H(function(T){return u()(u()({},T),{},Ce()({},A.key,{width:x,height:N}))}),(c=R.current)===null||c===void 0||c.refreshItems(),(w=R.current)===null||w===void 0||w.layout(!0)},handleClasses:{bottomRight:"resizable-handle"},enable:{top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,topLeft:!1,bottomLeft:!1},children:(0,e.jsxs)("div",{className:"resizable-container",children:[me&&(0,e.jsx)("div",{className:"resize-indicator"}),(0,e.jsx)(Wn,{fields:ie,allFields:o,groupByField:A.key,data:r,total:l,idColumnName:m,onClose:function(){},resize:function(){var _;(_=R.current)===null||_===void 0||_.refreshItems().layout(!0)},selectedColumns:k,allowChangeChartType:!0})]})})})},A.key)})})}):(0,e.jsx)(Ne.Z,{description:"Please specify the right yField, it should be one of the selected columns"})},Qn=Kn,Bt=f(53531),Jn=f(63430),Xn=f(79611),Yn=f(80652),ca=(0,Ba.default)(Aa()),da=20,Ct="sample_id",_n=["patient_id","sample_id"],Ga=[{label:"Line Chart",value:"linechart"},{label:"Bar Chart",value:"bar"},{label:"Histogram",value:"histogram"},{label:"Pie Chart",value:"pie"},{label:"Table",value:"table"},{label:"Summary",value:"summary"},{label:"Unsupported",value:"unsupported"},{label:"Kaplan-Meier",value:"kaplan_meier"},{label:"ID",value:"id"},{label:"Box Plot",value:"boxplot"},{label:"Violin Plot",value:"violinplot"},{label:"Statistic",value:"statistic"}],qn=function(n,i,r){var l=function(o){return o==="1"||o===1||o===!0||o===1?1:o==="0"||o===0||o===!1||o===0?0:typeof o=="string"&&o.startsWith("1")?1:(typeof o=="string"&&o.startsWith("0"),0)},k=n.filter(function(U){return U[i]!==null&&U[r]!==null}).map(function(U){return{time:Number(U[i]),event:l(U[r]),label:U.patient_id||"NA"}}).sort(function(U,o){return U.time-o.time}),p=[{time:0,survival:1,event:0,at_risk:k.length,label:"0"}],j=k.length,m=1,z=0,R=St()(k),t;try{for(R.s();!(t=R.n()).done;){var M=t.value,me=M.time,y=M.event,g=M.label;me!==z&&(z=me),y===1&&(m*=(j-1)/j),j-=1,p.push({time:me,survival:m,event:y,at_risk:j,label:g})}}catch(U){R.e(U)}finally{R.f()}return p},er=function(n,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},l=r.normalizeNull,k=l===void 0?!0:l,p=r.sort,j=p===void 0?!1:p,m=new Map;n.forEach(function(R){var t=R[i];if(t==null||t===""){if(!k)return;t="NA"}typeof t=="number"?t=Number.isInteger(t)?t.toString():t.toFixed(2).replace(/\.?0+$/,""):t=String(t),m.set(t,(m.get(t)||0)+1)});var z=Array.from(m.entries()).map(function(R){var t=v()(R,2),M=t[0],me=t[1];return Ce()(Ce()({},i,M),"count",me)});return j&&z.sort(function(R,t){return t.count-R.count}),z},tr=function(n){var i=n.tableData,r=n.field,l=n.total,k=[{title:r.name,dataIndex:r.key,width:"calc(100% - 160px)",ellipsis:!0},{title:"#",dataIndex:"count",width:80},{title:"Freq (%)",dataIndex:"count",width:80,render:function(j,m){return(0,e.jsxs)("span",{style:{color:"#1890ff"},children:[(m.count/l*100).toFixed(2),"%"]})}}];return(0,e.jsx)(xt.Z,{dataSource:i,columns:k,rowKey:function(j){return"".concat(j[r.key])},showHeader:!0,size:"small",pagination:!1,sticky:!0})},Ha=function(n,i){var r=[["os_months","os_status"],["dfs_months","dfs_status"],["rfs_months","rfs_status"],["dmfs_months","dmfs_status"]];return r.some(function(l){var k=v()(l,2),p=k[0],j=k[1];return i.includes(p)&&i.includes(j)&&n.key===p})},Wa=function(n,i,r,l){var k,p=((k=n.allowed_values)===null||k===void 0?void 0:k.length)||0,j=p/r,m=.8;if(Ha(n,l||[]))return"kaplan_meier";if(n.key==="__summary")return"summary";if(n.data_type==="BOOLEAN")return"pie";if(n.data_type==="STRING"){if(p<=6)return"pie";if(p>6&&p<=25)return"bar";if(j<=m&&p<=500&&p>25)return"table";if(j>m&&p>100)return"id"}return n.data_type==="NUMBER"?"violinplot":"unsupported"},Ka=function(n,i){return n.length<=i?n:n.slice(0,i)+"..."},ar=function(n){var i=n.field,r=n.data,l=n.isFileBased,k=n.total,p=n.onClose,j=n.className,m=n.resize,z=n.selectedColumns,R=n.allowChangeChartType,t=R===void 0?!1:R,M=n.magnification,me=n.sizes,y=n.isChecked,g=n.setIsChecked,U=(0,s.useState)(Wa(i,r.length,k,z)),o=v()(U,2),Z=o[0],ee=o[1],J=64,G=(0,s.useState)(300),H=v()(G,2),Y=H[0],A=H[1],X=(0,s.useState)(300),O=v()(X,2),B=O[0],V=O[1],h=(0,s.useState)(i.name),ie=v()(h,2),te=ie[0],_=ie[1],Q=(0,s.useRef)(null),le=(0,s.useRef)(null),c=(0,s.useState)([]),w=v()(c,2),x=w[0],N=w[1];(0,s.useEffect)(function(){console.log("ChartCard: ",r,i.key),N(er(r,i.key,{normalizeNull:!0,sort:!0}))},[r,i.key]),(0,s.useEffect)(function(){if(m){var E=new ResizeObserver(function(){var $,ke,Ve;($=Q.current)!==null&&$!==void 0&&($=$.chart)!==null&&$!==void 0&&$.forceFit?Q.current.chart.forceFit():window.dispatchEvent(new Event("resize")),A((((ke=le.current)===null||ke===void 0?void 0:ke.clientHeight)||332)-J),V(((Ve=le.current)===null||Ve===void 0?void 0:Ve.clientWidth)||300),m==null||m(0,0)});if(le.current){var D;E.observe(le.current),A((((D=le.current)===null||D===void 0?void 0:D.clientHeight)||332)-J)}return function(){E.disconnect()}}},[me,M]),(0,s.useEffect)(function(){Ha(i,z||[])?_(i.key==="os_months"||i.key==="os_status"?"Overall Survival Curve":"Disease-Free Survival Curve"):_(i.name)},[z]);var T=function(){if(r.length===0)return(0,e.jsx)(Ne.Z,{description:"No Data",className:"chart-empty"});if(Z==="kaplan_meier"){var D="",$="";i.key==="os_months"||i.key==="os_status"?(D="os_status",$="os_months"):i.key==="dfs_months"||i.key==="dfs_status"?(D="dfs_status",$="dfs_months"):i.key==="rfs_months"||i.key==="rfs_status"?(D="rfs_status",$="rfs_months"):(i.key==="dmfs_months"||i.key==="dmfs_status")&&(D="dmfs_status",$="dmfs_months");var ke=qn(r,$,D),Ve=ke.map(function(P){return"Patient ID: ".concat(P.label||"N/A","<br>")+"% event free: ".concat((P.survival*100).toFixed(2),"%<br>")+"Time of event: ".concat(P.time.toFixed(2)," months<br>")+"Number of patients at risk: ".concat(P.at_risk)});return(0,e.jsx)(ca,{data:[{x:ke.map(function(P){return P.time}),y:ke.map(function(P){return P.survival}),type:"scatter",mode:"lines+markers",name:"Survival Curve",line:{shape:"hv",color:"red"},text:Ve,hovertemplate:"%{text}<extra></extra>"}],layout:{title:"Survival Curve",width:B,height:Y,margin:{l:50,r:20,t:20,b:20},xaxis:{title:"Time (Months)",range:[0,null],showgrid:!1,zeroline:!0,linecolor:"#000",linewidth:1,mirror:!0,ticks:"outside",tickwidth:1,tickcolor:"#000"},yaxis:{title:"Survival Probability",range:[0,1.05],showgrid:!1,zeroline:!0,linecolor:"#000",linewidth:1,mirror:!0,ticks:"outside",tickwidth:1,tickcolor:"#000"},plot_bgcolor:"#fff",paper_bgcolor:"#fff",legend:{x:0,y:1},hoverlabel:{bgcolor:"rgba(255,255,255,0.9)",font:{color:"#000",size:12,family:"Arial"},align:"left",bordercolor:"#ccc",namelength:0}}})}if(Z==="id"){var De=new Set(r.map(function(P){return P[i.key]}));return(0,e.jsx)("span",{style:{color:"#1890ff",fontSize:"24px"},children:De.size})}if(Z==="table"){var fe=Object.entries((0,Ue.groupBy)(r,i.key)).map(function(P){var F=v()(P,2),q=F[0],nt=F[1];return Ce()(Ce()({},i.key,q),"count",nt.length)}).sort(function(P,F){return F.count-P.count}),ut=[{title:i.name,dataIndex:i.key,width:"calc(100% - 160px)",ellipsis:!0},{title:"#",dataIndex:"count",width:80},{title:"Freq (%)",dataIndex:"count",width:80,render:function(F,q){return(0,e.jsxs)("span",{style:{color:"#1890ff"},children:[Math.round(q.count/r.length*100),"%"]})}}];return(0,e.jsx)(xt.Z,{dataSource:fe,columns:ut,rowKey:function(F,q){return"".concat(F[i.key],"-").concat(q)},rowSelection:{type:"checkbox",selectedRowKeys:r.map(function(P){return P[i.key]}),onChange:function(F){console.log(F)}},showHeader:!0,size:"small",pagination:!1,sticky:!0,scroll:{y:Y}})}if(Z==="summary"){var Le=r.length,ae=Le/k*100,ct=ae>0?ae.toFixed(2):"0.00";return(0,e.jsx)(Bt.Z,{title:"Loaded ".concat(l?"Files":"Samples"," [Total]"),valueRender:function(){return(0,e.jsxs)("span",{style:{color:"#1890ff"},children:[Le," / ",k," (",ct,"%)"]})}})}if(Z==="statistic")return i.data_type==="NUMBER"?(0,e.jsxs)("div",{children:[(0,e.jsxs)(Xe.Z,{gutter:16,children:[(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(Bt.Z,{title:"Mean",value:r.length>0?(r.reduce(function(P,F){return P+Number(F[i.key]||0)},0)/r.length).toFixed(2):0,precision:2})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(Bt.Z,{title:"Median",value:r.length>0?function(){var P=r.map(function(q){return Number(q[i.key]||0)}).sort(function(q,nt){return q-nt}),F=Math.floor(P.length/2);return P.length%2===0?((P[F-1]+P[F])/2).toFixed(2):P[F].toFixed(2)}():0,precision:2})})]}),(0,e.jsxs)(Xe.Z,{gutter:16,style:{marginTop:16},children:[(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(Bt.Z,{title:"Max",value:r.length>0?Math.max.apply(Math,be()(r.map(function(P){return Number(P[i.key]||0)}))).toFixed(2):0,precision:2})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(Bt.Z,{title:"Min",value:r.length>0?Math.min.apply(Math,be()(r.map(function(P){return Number(P[i.key]||0)}))).toFixed(2):0,precision:2})})]})]}):(0,e.jsx)(Ne.Z,{description:"Statistic Only Support Numeric Fields",className:"chart-empty"});if(Z==="boxplot")if(i.data_type==="NUMBER"){var Ye=r.map(function(P){var F=P[i.key];return typeof F=="number"?F:null}).filter(function(P){return P!==null});console.log("Box Plot Data: ",Ye);var Re=[{y:Ye,type:"box",name:Ka(i.key,10),boxpoints:"outliers",jitter:.3,pointpos:-1.8}];return(0,e.jsx)(ca,{data:Re,layout:{xaxis:{showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickwidth:1,tickcolor:"#000",mirror:!0},yaxis:{title:{text:"Value",standoff:20},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!0,zerolinecolor:"#000",zerolinewidth:1,mirror:!0,ticks:"outside",tickwidth:1,tickcolor:"#000"},margin:{l:50,r:20,t:20,b:30},showlegend:!1,plot_bgcolor:"#fff",paper_bgcolor:"#fff",width:B,height:Y}})}else return(0,e.jsx)(Ne.Z,{description:"Box Plot Only Support Numeric Fields",className:"chart-empty"});if(Z==="violinplot")if(i.data_type==="NUMBER"){var S=r.map(function(P){var F=P[i.key];return typeof F=="number"?F:null}).filter(function(P){return P!==null}),Ge=[{y:S,type:"violin",name:Ka(i.key,10),box:{visible:!0},meanline:{visible:!0},points:"outliers",jitter:.3,pointpos:0}];return(0,e.jsx)(ca,{data:Ge,layout:{xaxis:{showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickwidth:1,tickcolor:"#000",mirror:!0},yaxis:{title:{text:"Value",standoff:20},showgrid:!1,showline:!0,linecolor:"#000",linewidth:1,zeroline:!0,zerolinecolor:"#000",zerolinewidth:1,mirror:!0,ticks:"outside",tickwidth:1,tickcolor:"#000"},margin:{l:50,r:20,t:20,b:30},showlegend:!1,plot_bgcolor:"#fff",paper_bgcolor:"#fff",width:B,height:Y}})}else return(0,e.jsx)(Ne.Z,{description:"Violin Plot Only Support Numeric Fields",className:"chart-empty"});if(Z==="pie")return x.length>0?(0,e.jsx)(Jn.Z,{autoFit:!0,data:x,angleField:"count",colorField:i.key,radius:1,label:{text:"count"},ref:Q,interaction:{elementHighlight:!0},state:{inactive:{opacity:.5}},legend:!1,tooltip:{title:i.key},onReady:function(F){F.chart.on("interval:pointerover",function(q){console.log("Pie tooltip: ",q,F)})}}):(0,e.jsx)(Ne.Z,{description:"No data to show",className:"chart-empty"});if(Z==="bar")return x.length>0?(0,e.jsx)(Xn.Z,{autoFit:!0,data:x,xField:i.key,yField:"count",legend:!1,ref:Q,xAxis:{title:{text:i.name,style:{fontSize:12}},label:{autoHide:!1,autoRotate:!0}},yAxis:{title:{text:"Frequency",style:{fontSize:12}}},columnStyle:{radius:[2,2,0,0]}}):(0,e.jsx)(Ne.Z,{description:"No data to show",className:"chart-empty"});if(Z==="histogram"){var _e=r.map(function(P){return P[i.key]}).filter(function(P){return typeof P=="number"});return _e.length>0?(0,e.jsx)(Va.Z,{data:_e.map(function(P){return{value:P}}),binField:"value",binWidth:10,xAxis:{title:{text:i.name}},yAxis:{title:{text:"Frequency"}},autoFit:!0}):(0,e.jsx)(Ne.Z,{description:"No data to show",className:"chart-empty"})}if(Z==="linechart"){var I=Ct,Ze=i.key,je=r.map(function(P){return Ce()(Ce()({},I,P[I]),Ze,P[Ze])});return(0,e.jsx)(Yn.Z,{data:je,xField:I,yField:Ze})}return(0,e.jsx)(Ne.Z,{description:"Unsupported ".concat(i.data_type," field"),className:"chart-empty"})};return(0,e.jsx)(Xe.Z,{className:"chart-card",children:(0,e.jsx)(Yt.Z,{size:"small",title:(0,e.jsx)(Oe.Z,{title:te,children:(0,e.jsx)("div",{className:"chart-drag-handle",children:te})}),extra:(0,e.jsxs)(tt.Z,{size:0,children:[y!==void 0&&(0,e.jsx)(za.Z,{checked:y!=null?y:!1,onChange:function(D){D.target.checked?g==null||g({key:i.key,action:"add"}):g==null||g({key:i.key,action:"remove"})}}),(0,e.jsx)(ua.Z,{placement:"topRight",content:x.length<=200?(0,e.jsx)(tr,{tableData:x,field:i,total:k}):(0,e.jsx)(Ne.Z,{description:"Too many data to show (".concat(x.length,")"),className:"chart-empty"}),title:!1,style:{width:"300px"},prefixCls:"chart-card-table-popover",trigger:"click",destroyOnHidden:!0,children:(0,e.jsx)(re.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Ea.Z,{})})}),!t&&(0,e.jsx)(Et.Z,{menu:{items:["1x1","2x2","3x3"].map(function(E){return{key:E,label:E,type:"item"}}),onClick:function(D){var $=da*Number(D.key.split("x")[0])*((M==null?void 0:M.w)||1),ke=da*Number(D.key.split("x")[1])*((M==null?void 0:M.h)||1);M!=null&&M.w&&M!==null&&M!==void 0&&M.h&&M.w>1&&M.h>1&&(m==null||m($,ke),console.log("Resize Setting: ",M,D,$,ke,da))}},trigger:["click"],placement:"bottomRight",overlayClassName:"chart-type-dropdown",children:(0,e.jsx)(re.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Za.Z,{})})}),!t&&(0,e.jsx)(Et.Z,{menu:{items:Ga.sort(function(E,D){return E.label.localeCompare(D.label)}).map(function(E){return{key:E.value,label:E.label,type:"item"}}),onClick:function(D){ee(D.key)}},trigger:["click"],placement:"bottomRight",overlayClassName:"chart-type-dropdown",children:(0,e.jsx)(re.ZP,{type:"text",size:"small",icon:(0,e.jsx)(jt.Z,{})})}),(0,e.jsx)(Oe.Z,{title:i.description,children:(0,e.jsx)(re.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Vt.Z,{})})}),t&&(0,e.jsx)(Oe.Z,{title:"Change chart type",children:(0,e.jsx)(ot.default,{style:{width:150},options:Ga.sort(function(E,D){return E.label.localeCompare(D.label)}),value:Z,onChange:function(D){ee(D)}})}),p&&(0,e.jsx)(re.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Oa.Z,{}),onClick:p})]}),className:j,ref:le,children:T()})})},Qa=ar,qt=20,ea={id:{w:16,h:16},table:{w:32,h:16},bar:{w:32,h:16},pie:{w:16,h:16},histogram:{w:32,h:16},dotplot:{w:16,h:16},kaplan_meier:{w:32,h:16},default:{w:16,h:16}},nr=function(n){var i=n.fields,r=n.data,l=n.isFileBased,k=n.total,p=n.selectedColumns,j=n.onClose,m=n.onSelectFields,z=(0,s.useRef)(null),R=(0,s.useRef)(null),t=(0,s.useState)(!1),M=v()(t,2),me=M[0],y=M[1],g=(0,s.useState)([]),U=v()(g,2),o=U[0],Z=U[1],ee=(0,s.useState)({}),J=v()(ee,2),G=J[0],H=J[1],Y=(0,s.useState)(new Set),A=v()(Y,2),X=A[0],O=A[1],B={key:"__summary",name:"Summary",data_type:"NUMBER",allowed_values:[],notes:"",order:0,description:"Total number of ".concat(l?"files":"samples"," in the dataset and loaded ").concat(l?"files":"samples")},V=function(ie,te){if(G[ie])return G[ie];var _=ea[te]||ea.default,Q=_.w,le=_.h,c={width:Q*qt,height:le*qt};return H(function(w){return u()(u()({},w),{},Ce()({},ie,c))}),c};return(0,s.useEffect)(function(){return z.current&&(R.current=new Ma.Z(z.current,{dragEnabled:!0,layoutOnInit:!0,layoutDuration:300,layoutEasing:"ease",dragSort:!0,dragSortPredicate:{threshold:50,action:"move"},dragStartPredicate:{distance:10,delay:100},dragHandle:".chart-drag-handle"})),function(){var h;(h=R.current)===null||h===void 0||h.destroy()}},[o]),(0,s.useEffect)(function(){Z([B].concat(be()(i.filter(function(h){return p.includes(h.key)}))))},[i,p]),(0,e.jsx)(Xe.Z,{className:"visual-panel-container",children:(0,e.jsx)("div",{className:"muuri-grid",ref:z,children:o.map(function(h){var ie=Wa(h,r.length,k,p),te=V(h.key,ie),_=te.width,Q=te.height,le={width:"".concat(_,"px"),height:"".concat(Q,"px")};return(0,e.jsx)("div",{className:"item",style:le,children:(0,e.jsx)("div",{className:"item-content",children:(0,e.jsx)($a.e,{defaultSize:{width:_,height:Q},minWidth:5*qt,minHeight:5*qt,onResizeStart:function(){return y(!0)},onResizeStop:function(w,x,N){var T,E;y(!1);var D=N.offsetWidth,$=N.offsetHeight;H(function(ke){return u()(u()({},ke),{},Ce()({},h.key,{width:D,height:$}))}),console.log("Resize: ",h.key,D,$),(T=R.current)===null||T===void 0||T.refreshItems(),(E=R.current)===null||E===void 0||E.layout(!0),window.dispatchEvent(new Event("resize"))},size:{width:_,height:Q},handleClasses:{bottomRight:"resizable-handle"},enable:{top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,topLeft:!1,bottomLeft:!1},children:(0,e.jsxs)("div",{className:"resizable-container",children:[me&&(0,e.jsx)("div",{className:"resize-indicator"}),(0,e.jsx)(Qa,{field:h,data:r,isFileBased:l,total:k,onClose:function(){j==null||j(h)},resize:function(w,x){var N,T;console.log("Resize: ",h.key,w,x),w>0&&x>0&&H(function(E){return u()(u()({},E),{},Ce()({},h.key,{width:w,height:x}))}),(N=R.current)===null||N===void 0||N.refreshItems(),(T=R.current)===null||T===void 0||T.layout(!0),window.dispatchEvent(new Event("resize"))},selectedColumns:p,sizes:G[h.key],setIsChecked:function(w){if(w.action==="add"&&!X.has(w.key)){var x=new Set(X);x.add(w.key),O(x),m==null||m(Array.from(x))}else if(w.action==="remove"&&X.has(w.key)){var N=new Set(X);N.delete(w.key),O(N),m==null||m(Array.from(N))}Ee.ZP.success("".concat(w.action," ").concat(w.key))},magnification:ea[ie]||ea.default})]})})})},h.key)})})})},rr=nr,ir=f(13769),lr=f.n(ir),or=f(74061),sr=["dataSource","scroll","size","rowKey","pagination","dataDictionary","onCellClick","isFileBased"],ur=function(n){var i,r=n.dataSource,l=n.scroll,k=n.size,p=n.rowKey,j=n.pagination,m=n.dataDictionary,z=n.onCellClick,R=n.isFileBased,t=lr()(n,sr),M=(i=l==null?void 0:l.y)!==null&&i!==void 0?i:500,me=42,y=(0,s.useRef)(),g=(0,s.useRef)(null),U=(0,s.useState)([]),o=v()(U,2),Z=o[0],ee=o[1];(0,s.useEffect)(function(){var O=m.map(function(B){return{title:function(h){return(0,e.jsxs)("div",{className:"table-column-name-container",style:{display:"flex",whiteSpace:"nowrap",gap:4,alignItems:"center"},children:[(0,e.jsx)(Oe.Z,{title:B.name,children:(0,e.jsx)("span",{className:"table-column-name",style:{maxWidth:h-56},children:B.name})}),(0,e.jsxs)(tt.Z,{children:[(0,e.jsx)(Oe.Z,{title:B.description||"No description",children:(0,e.jsx)(re.ZP,{size:"small",icon:(0,e.jsx)(Vt.Z,{})})}),(0,e.jsx)(ua.Z,{content:(0,e.jsx)(Qa,{className:"chart-card-popover",allowChangeChartType:!0,field:B,data:r,isFileBased:R,total:r.length}),trigger:"click",destroyOnHidden:!0,children:(0,e.jsx)(re.ZP,{size:"small",icon:(0,e.jsx)(jt.Z,{}),type:"primary"})})]})]})},dataIndex:B.key,key:B.key,render:function(h,ie,te){return B.key==="patient_id"?(0,e.jsx)("a",{onClick:function(){return z==null?void 0:z(ie,te,B)},children:h}):h}}});ee(O)},[m,r]);var J=(0,s.useState)(function(){var O={};return Object.defineProperty(O,"scrollLeft",{get:function(){if(y.current){var V;return((V=y.current.state)===null||V===void 0?void 0:V.scrollLeft)||0}return 0},set:function(V){y.current&&y.current.scrollTo({scrollLeft:V}),g.current&&(g.current.scrollLeft=V)}}),O}),G=v()(J,1),H=G[0];(0,s.useEffect)(function(){y.current&&(console.log("\u{1F6E0} Recalculating columns for Grid"),y.current.resetAfterColumnIndex(0,!0))},[Z.length]);var Y=Z.filter(function(O){return!O.width}).length,A=Z.map(function(O){return O.width?O:u()(u()({},O),{},{width:Math.floor((l==null?void 0:l.x)/Y)})}),X=function(B,V){var h=V.scrollbarSize,ie=V.ref,te=V.onScroll;return ie&&Pa()(ie)==="object"&&(ie.current=H),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{ref:g,style:{display:"flex",width:l==null?void 0:l.x,overflow:"hidden"},children:A.map(function(_,Q){return(0,e.jsx)("div",{style:{width:_.width,padding:8,background:"#fafafa",borderBottom:"1px solid #f0f0f0",fontWeight:500},children:_.title(_.width)},Q)})}),(0,e.jsx)(or.cd,{className:"datatable-table-grid",ref:y,columnCount:A.length,columnWidth:function(Q){return A[Q].width},height:M,rowCount:B.length,rowHeight:function(){return me},width:l==null?void 0:l.x,onScroll:function(Q){var le=Q.scrollLeft;typeof te=="function"&&te({scrollLeft:le}),g.current&&(g.current.scrollLeft=le)},onItemsRendered:function(){},children:function(Q){var le=Q.columnIndex,c=Q.rowIndex,w=Q.style,x=A[le],N=B[c],T=N[x.dataIndex];return(0,e.jsx)("div",{className:c%2===0?"datatable-table-grid-row-even":"datatable-table-grid-row-odd",style:u()(u()({},w),{},{padding:"8px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",textAlign:"".concat(x.align)}),children:typeof x.render=="function"?x.render(T,N,c):T})}})]})};return(0,e.jsx)(xt.Z,u()(u()({},t),{},{size:k,bordered:!0,columns:A,dataSource:r,pagination:j,rowKey:p,scroll:l,showHeader:!1,components:{body:X},summary:function(){return(0,e.jsx)(xt.Z.Summary,{fixed:!0,children:(0,e.jsx)(xt.Z.Summary.Row,{style:{fontSize:16,fontWeight:500},children:(0,e.jsxs)(xt.Z.Summary.Cell,{index:0,colSpan:Z.length,children:["\u{1F522} Showing ",r.length," of ",j==null?void 0:j.total," samples"]})})})}}))},Ja=ur,Xa=f(26412),cr=Je.Z.Title,dr=function(n){var i=n.data,r=n.dataDictionary,l=n.title,k=l===void 0?"Patient Details":l;return i?(0,e.jsxs)("div",{style:{background:"#fff",padding:24,borderRadius:8},children:[(0,e.jsx)(cr,{level:4,style:{marginBottom:16},children:k}),(0,e.jsx)(Xe.Z,{className:"data-info-modal-content",children:(0,e.jsx)(Xa.Z,{column:1,bordered:!0,size:"small",labelStyle:{width:"40%",fontWeight:500},children:Object.entries(i).map(function(p){var j,m,z=v()(p,2),R=z[0],t=z[1];return(0,e.jsx)(Xa.Z.Item,{label:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{style:{fontWeight:500,marginRight:4},children:((j=r.fields.find(function(M){return M.key===R}))===null||j===void 0?void 0:j.name)||R}),(0,e.jsx)(Oe.Z,{title:((m=r.fields.find(function(M){return M.key===R}))===null||m===void 0?void 0:m.description)||"",children:(0,e.jsx)(Vt.Z,{})})]}),children:t!=null?String(t):"\u2014"},R)})})})]}):null},fr=dr,fa=f(84702),ha=f(23315),hr=f(63366),ma="/assets/data_downloader.md",mr=function(n){var i=n.open,r=n.onClose,l=n.onDownloadMetadataTable,k=n.onDownloadDatafiles,p=(0,s.useState)(""),j=v()(p,2),m=j[0],z=j[1];return(0,s.useEffect)(function(){ma&&fetch(ma).then(function(R){return R.text()}).then(function(R){z(R)})},[ma]),(0,e.jsx)(gt.Z,{className:"datatable-data-info-modal",open:i,width:800,destroyOnHidden:!0,onCancel:r,title:(0,e.jsx)(Je.Z.Title,{level:4,children:"Download Dataset"}),footer:(0,e.jsxs)("div",{children:[(0,e.jsx)(re.ZP,{type:"primary",onClick:function(){l(),r()},icon:(0,e.jsx)(At.Z,{}),children:"Download Metadata Table"}),(0,e.jsx)(re.ZP,{type:"primary",onClick:function(){k(),r()},icon:(0,e.jsx)(At.Z,{}),children:"Download Datafile Table"})]}),children:(0,e.jsx)(Je.Z.Text,{style:{fontSize:"16px"},children:(0,e.jsx)(fa.D,{className:"modal-markdown-content",remarkPlugins:[ha.Z],rehypePlugins:[hr.Z],children:m})})})},vr=mr,pr=f(74964),yr=f(57460),gr=f.n(yr),xr=f(81249),br=f.n(xr),jr=function(n,i,r){var l=r.leftOn,k=r.rightOn,p=r.how,j=p===void 0?"inner":p,m=new Map;i.forEach(function(t){var M=t[k];m.has(M)||m.set(M,[]),m.get(M).push(t)});var z=[],R=new Set;return n.forEach(function(t){var M=t[l],me=m.get(M);me&&me.length>0?(R.add(M),me.forEach(function(y){z.push(u()(u()({},t),y))})):(j==="left"||j==="outer")&&z.push(u()({},t))}),(j==="right"||j==="outer")&&i.forEach(function(t){var M=t[k];R.has(M)||z.push(u()({},t))}),z},va=f(57489),Sr=f(96074),wr=f(58660),Ya=ot.default.Option,Cr=Je.Z.Text,Ft={scatter:{name:"Scatter Plot",mappings:["x","y","color","size","text"],required:["x","y"]},line:{name:"Line Plot",mappings:["x","y","color","text"],required:["x","y"]},bar:{name:"Bar Plot",mappings:["x","y","color","text"],required:["x","y"]},histogram:{name:"Histogram",mappings:["x","color","text"],required:["x"]},box:{name:"Box Plot",mappings:["x","y","color","text"],required:["y"]},violin:{name:"Violin Plot",mappings:["x","y","color","text"],required:["y"]},heatmap:{name:"Heatmap",mappings:["x","y","z","text"],required:["x","y","z"]},pie:{name:"Pie Chart",mappings:["labels","text"],required:["labels"]}},_a={x:"X Axis",y:"Y Axis",z:"Z Axis (Numeric)",color:"Color",size:"Size",text:"Text Label",labels:"Labels",values:"Values"},kr=function(n){var i,r=n.data,l=n.fieldDataDictionary,k=(0,s.useState)("scatter"),p=v()(k,2),j=p[0],m=p[1],z=(0,s.useState)({}),R=v()(z,2),t=R[0],M=R[1],me=(0,s.useState)(0),y=v()(me,2),g=y[0],U=y[1],o=va.Z.useForm(),Z=v()(o,1),ee=Z[0],J=(0,s.useCallback)(function(c){var w=typeof c=="string"?parseFloat(c):c;return isNaN(w)?"0":w.toFixed(3)},[]),G=(0,s.useMemo)(function(){var c=[],w=[],x=[];return l.forEach(function(N){x.push(N),["number","float","integer"].includes(N.data_type.toLowerCase())?c.push(N):w.push(N)}),{numericFields:c,categoricalFields:w,allFields:x}},[l]),H=G.numericFields,Y=G.categoricalFields,A=G.allFields,X=(0,s.useCallback)(function(c){m(c),M({}),ee.resetFields()},[ee]),O=(0,s.useCallback)(function(c,w){M(function(x){return u()(u()({},x),{},Ce()({},c,w))})},[]);(0,s.useEffect)(function(){var c=function(){U(function(x){return x+1})};return window.addEventListener("resize",c),function(){return window.removeEventListener("resize",c)}},[]);var B=(0,s.useCallback)(function(c){var w=A;return j==="heatmap"?c==="x"||c==="y"?w=Y:c==="z"?w=H:c==="text"&&(w=A):["y","z","values","size"].includes(c)?w=H:["color","labels"].includes(c)&&(w=[].concat(be()(Y),be()(H))),console.log("Fields for ".concat(c," (").concat(j,"): "),w),w},[A,H,Y,j]),V=(0,s.useCallback)(function(c){var w=B(c);return w.map(function(x){return(0,e.jsx)(Ya,{value:x.key,children:(0,e.jsxs)(Oe.Z,{title:"".concat(x.key,": ").concat(x.description),children:[x.name," (",x.key,")"]})},x.key)})},[B]),h=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#aec7e8","#ffbb78","#98df8a","#ff9896","#c5b0d5","#c49c94","#f7b6d3","#c7c7c7","#dbdb8d","#9edae5"],ie=(0,s.useCallback)(function(c,w,x,N,T){var E=l.find(function(fe){return fe.key===c}),D=l.find(function(fe){return fe.key===w}),$=x?l.find(function(fe){return fe.key===x}):null,ke=N?l.find(function(fe){return fe.key===N}):null,Ve=T?l.find(function(fe){return fe.key===T}):null,De="";return De+="".concat((E==null?void 0:E.name)||c,": %{x}<br>"),De+="".concat((D==null?void 0:D.name)||w,": %{y}<br>"),x&&$&&(De+="".concat($.name||x,": %{customdata[0]}<br>")),N&&ke&&(De+="".concat(ke.name||N,": %{customdata[1]}<br>")),T&&Ve&&(De+="".concat(Ve.name||T,": %{customdata[2]}<br>")),De+="<extra></extra>",De},[l]),te=(0,s.useCallback)(function(c,w){var x=l.find(function(D){return D.key===c});if(!x)return[];var N=Math.min.apply(Math,be()(w)),T=Math.max.apply(Math,be()(w)),E=(N+T)/2;return[{type:"scatter",mode:"markers",x:[null],y:[null],marker:{size:8,color:"rgba(0,0,0,0)",symbol:"circle"},name:"".concat(x.name||c," (Size)"),showlegend:!0,legendgroup:"size-legend"},{type:"scatter",mode:"markers",x:[null],y:[null],marker:{size:12,color:"rgba(0,0,0,0)",symbol:"circle"},name:"Min: ".concat(J(N)),showlegend:!0,legendgroup:"size-legend"},{type:"scatter",mode:"markers",x:[null],y:[null],marker:{size:16,color:"rgba(0,0,0,0)",symbol:"circle"},name:"Mid: ".concat(J(E)),showlegend:!0,legendgroup:"size-legend"},{type:"scatter",mode:"markers",x:[null],y:[null],marker:{size:20,color:"rgba(0,0,0,0)",symbol:"circle"},name:"Max: ".concat(J(T)),showlegend:!0,legendgroup:"size-legend"}]},[l]),_=(0,s.useCallback)(function(c,w,x,N,T,E){var D=[],$=ie(w,x,N,T,E);if(!N){var ke={type:"scatter",mode:"markers",x:c.map(function(I){return I[w]}),y:c.map(function(I){return I[x]}),marker:{size:T?c.map(function(I){return I[T]}):void 0},text:E?c.map(function(I){return I[E]}):void 0,customdata:c.map(function(I){return[null,T?I[T]:null,E?I[E]:null]}),hovertemplate:$,name:"Data Points",showlegend:!1};if(D.push(ke),T){var Ve=c.map(function(I){return I[T]}),De=te(T,Ve);D.push.apply(D,be()(De))}return D}var fe=l.find(function(I){return I.key===N}),ut=fe&&["number","float","integer"].includes(fe.data_type.toLowerCase());if(ut){var Le=c.map(function(I){return I[N]}),ae={type:"scatter",mode:"markers",x:c.map(function(I){return I[w]}),y:c.map(function(I){return I[x]}),marker:{color:Le,colorscale:"Viridis",showscale:!0,colorbar:{title:(fe==null?void 0:fe.name)||N},size:T?c.map(function(I){return I[T]}):void 0},text:E?c.map(function(I){return I[E]}):void 0,customdata:c.map(function(I){return[I[N],T?I[T]:null,E?I[E]:null]}),hovertemplate:$,name:"Data Points",showlegend:!1};if(D.push(ae),T){var ct=c.map(function(I){return I[T]}),Ye=te(T,ct);D.push.apply(D,be()(Ye))}return D}else{var Re={};c.forEach(function(I){var Ze=I[N];Re[Ze]||(Re[Ze]=[]),Re[Ze].push(I)});var S=Object.entries(Re).map(function(I,Ze){var je=v()(I,2),P=je[0],F=je[1];return{type:"scatter",mode:"markers",x:F.map(function(q){return q[w]}),y:F.map(function(q){return q[x]}),marker:{color:h[Ze%h.length],size:T?F.map(function(q){return q[T]}):void 0},text:E?F.map(function(q){return q[E]}):void 0,customdata:F.map(function(q){return[q[N],T?q[T]:null,E?q[E]:null]}),hovertemplate:$,name:"".concat((fe==null?void 0:fe.name)||N,": ").concat(P),showlegend:!0}});if(D.push.apply(D,be()(S)),T){var Ge=c.map(function(I){return I[T]}),_e=te(T,Ge);D.push.apply(D,be()(_e))}return D}},[l,te]),Q=(0,s.useMemo)(function(){if(!r||r.length===0||!j)return[];var c=Ft[j];if(!c)return[];var w=c.required.every(function(a){return t[a]});if(!w)return[];console.log("Plot Data: ",r,t);try{switch(j){case"scatter":return _(r,t.x,t.y,t.color,t.size,t.text);case"line":var x=[],N=ie(t.x,t.y,t.color,t.size,t.text);if(!t.color){var T={type:"scatter",mode:"lines+markers",x:r.map(function(a){return a[t.x]}),y:r.map(function(a){return a[t.y]}),text:t.text?r.map(function(a){return a[t.text]}):void 0,customdata:r.map(function(a){return[null,t.size?a[t.size]:null,t.text?a[t.text]:null]}),hovertemplate:N,name:"Line Plot",showlegend:!1};if(x.push(T),t.size){var E=r.map(function(a){return a[t.size]}),D=te(t.size,E);x.push.apply(x,be()(D))}return x}var $=l.find(function(a){return a.key===t.color}),ke=$&&["number","float","integer"].includes($.data_type.toLowerCase());if(ke){var Ve=r.map(function(a){return a[t.color]}),De={type:"scatter",mode:"lines+markers",x:r.map(function(a){return a[t.x]}),y:r.map(function(a){return a[t.y]}),line:{color:Ve,colorscale:"Viridis",showscale:!0,colorbar:{title:($==null?void 0:$.name)||t.color}},text:t.text?r.map(function(a){return a[t.text]}):void 0,customdata:r.map(function(a){return[a[t.color],t.size?a[t.size]:null,t.text?a[t.text]:null]}),hovertemplate:N,name:"Line Plot",showlegend:!1};if(x.push(De),t.size){var fe=r.map(function(a){return a[t.size]}),ut=te(t.size,fe);x.push.apply(x,be()(ut))}return x}else{var Le={};r.forEach(function(a){var L=a[t.color];Le[L]||(Le[L]=[]),Le[L].push(a)});var ae=Object.entries(Le).map(function(a,L){var ge=v()(a,2),pe=ge[0],K=ge[1];return{type:"scatter",mode:"lines+markers",x:K.map(function(ye){return ye[t.x]}),y:K.map(function(ye){return ye[t.y]}),line:{color:h[L%h.length]},text:t.text?K.map(function(ye){return ye[t.text]}):void 0,customdata:K.map(function(ye){return[ye[t.color],t.size?ye[t.size]:null,t.text?ye[t.text]:null]}),hovertemplate:N,name:"".concat(($==null?void 0:$.name)||t.color,": ").concat(pe),showlegend:!0}});if(x.push.apply(x,be()(ae)),t.size){var ct=r.map(function(a){return a[t.size]}),Ye=te(t.size,ct);x.push.apply(x,be()(Ye))}return x}case"bar":var Re=[],S={};r.forEach(function(a){var L=a[t.x],ge=parseFloat(a[t.y])||0;S[L]||(S[L]={sum:0,count:0,values:[],mean:0,std:0}),S[L].sum+=ge,S[L].count+=1,S[L].values.push(ge),t.color&&(S[L].color=a[t.color]),t.text&&(S[L].text=a[t.text])}),Object.keys(S).forEach(function(a){var L=S[a];L.mean=L.sum/L.count;var ge=L.values.reduce(function(pe,K){return pe+Math.pow(K-L.mean,2)},0)/L.count;L.std=Math.sqrt(ge)});var Ge=l.find(function(a){return a.key===t.x}),_e=l.find(function(a){return a.key===t.y}),I=t.color?l.find(function(a){return a.key===t.color}):null,Ze=t.text?l.find(function(a){return a.key===t.text}):null,je="";if(je+="".concat((Ge==null?void 0:Ge.name)||t.x,": %{x}<br>"),je+="".concat((_e==null?void 0:_e.name)||t.y,": %{y}<br>"),je+="Count: %{customdata[3]}<br>",je+="Std Dev: %{customdata[4]}<br>",t.color&&I&&(je+="".concat(I.name||t.color,": %{customdata[0]}<br>")),t.text&&Ze&&(je+="".concat(Ze.name||t.text,": %{customdata[2]}<br>")),je+="<extra></extra>",!t.color){var P={type:"bar",x:Object.keys(S),y:Object.values(S).map(function(a){return parseFloat(J(a.mean))}),error_y:{type:"data",array:Object.values(S).map(function(a){return parseFloat(J(a.std))}),visible:!0},text:t.text?Object.values(S).map(function(a){return a.text}):void 0,customdata:Object.values(S).map(function(a){return[null,null,t.text?a.text:null,a.count,J(a.std)]}),hovertemplate:je,name:"Bar Plot",showlegend:!1};return Re.push(P),Re}var F=l.find(function(a){return a.key===t.color}),q=F&&["number","float","integer"].includes(F.data_type.toLowerCase());if(q){var nt={type:"bar",x:Object.keys(S),y:Object.values(S).map(function(a){return parseFloat(J(a.mean))}),error_y:{type:"data",array:Object.values(S).map(function(a){return parseFloat(J(a.std))}),visible:!0},marker:{color:Object.values(S).map(function(a){return a.color}),colorscale:"Viridis",showscale:!0,colorbar:{title:(F==null?void 0:F.name)||t.color}},text:t.text?Object.values(S).map(function(a){return a.text}):void 0,customdata:Object.values(S).map(function(a){return[J(a.color),null,t.text?a.text:null,a.count,J(a.std)]}),hovertemplate:je,name:"Bar Plot",showlegend:!1};return Re.push(nt),Re}else{var qe={};Object.entries(S).forEach(function(a){var L=v()(a,2),ge=L[0],pe=L[1],K=pe.color;qe[K]||(qe[K]={}),qe[K][ge]=pe});var dt=Object.entries(qe).map(function(a,L){var ge=v()(a,2),pe=ge[0],K=ge[1];return{type:"bar",x:Object.keys(K),y:Object.values(K).map(function(ye){return parseFloat(J(ye.mean))}),error_y:{type:"data",array:Object.values(K).map(function(ye){return parseFloat(J(ye.std))}),visible:!0},marker:{color:h[L%h.length]},text:t.text?Object.values(K).map(function(ye){return ye.text}):void 0,customdata:Object.values(K).map(function(ye){return[pe,null,t.text?ye.text:null,ye.count,J(ye.std)]}),hovertemplate:je,name:"".concat((F==null?void 0:F.name)||t.color,": ").concat(pe),showlegend:!0}});return Re.push.apply(Re,be()(dt)),Re}case"histogram":var et=[],He=ie(t.x,"Count",t.color,void 0,void 0);if(!t.color){var kt={type:"histogram",x:r.map(function(a){return a[t.x]}),customdata:r.map(function(a){return[null,null,null]}),hovertemplate:He,name:"Histogram",showlegend:!1};return et.push(kt),et}var We=l.find(function(a){return a.key===t.color}),C=We&&["number","float","integer"].includes(We.data_type.toLowerCase());if(C){var W=r.map(function(a){return a[t.color]}),ve={type:"histogram",x:r.map(function(a){return a[t.x]}),marker:{color:W,colorscale:"Viridis",showscale:!0,colorbar:{title:(We==null?void 0:We.name)||t.color}},customdata:r.map(function(a){return[a[t.color],null,null]}),hovertemplate:He,name:"Histogram",showlegend:!1};return et.push(ve),et}else{var oe={};r.forEach(function(a){var L=a[t.color];oe[L]||(oe[L]=[]),oe[L].push(a)});var Te=Object.entries(oe).map(function(a,L){var ge=v()(a,2),pe=ge[0],K=ge[1];return{type:"histogram",x:K.map(function(ye){return ye[t.x]}),marker:{color:h[L%h.length]},customdata:K.map(function(ye){return[ye[t.color],null,null]}),hovertemplate:He,name:"".concat((We==null?void 0:We.name)||t.color,": ").concat(pe),showlegend:!0}});return et.push.apply(et,be()(Te)),et}case"box":var Me=[],se=l.find(function(a){return a.key===t.x}),Ie=l.find(function(a){return a.key===t.y});if(t.x){var Se={};r.forEach(function(a){var L=a[t.x];Se[L]||(Se[L]=[]),Se[L].push(a[t.y])});var ft=Object.entries(Se).map(function(a,L){var ge=v()(a,2),pe=ge[0],K=ge[1];return{type:"box",y:K,name:pe,boxpoints:"all",jitter:.3,marker:{color:h[L%h.length]},hovertemplate:"<b>".concat(pe,"</b><br>")+"".concat((se==null?void 0:se.name)||t.x,": ").concat(pe,"<br>")+"".concat((Ie==null?void 0:Ie.name)||t.y,": %{y}<br>")+"<extra></extra>"}});return ft}else{var Zt={type:"box",y:r.map(function(a){return a[t.y]}),name:"Box Plot",boxpoints:"all",jitter:.3,hovertemplate:"<b>Box Plot</b><br>"+"".concat((Ie==null?void 0:Ie.name)||t.y,": %{y}<br>")+"<extra></extra>"};return Me.push(Zt),Me}case"violin":var Fe=[],rt=l.find(function(a){return a.key===t.x}),Ke=l.find(function(a){return a.key===t.y});if(t.x){var zt={};r.forEach(function(a){var L=a[t.x];zt[L]||(zt[L]=[]),zt[L].push(a[t.y])});var aa=Object.entries(zt).map(function(a,L){var ge=v()(a,2),pe=ge[0],K=ge[1];return{type:"violin",y:K,name:pe,box:{visible:!0},meanline:{visible:!0},marker:{color:h[L%h.length]},hovertemplate:"<b>".concat(pe,"</b><br>")+"".concat((rt==null?void 0:rt.name)||t.x,": ").concat(pe,"<br>")+"".concat((Ke==null?void 0:Ke.name)||t.y,": %{y}<br>")+"<extra></extra>"}});return aa}else{var Lt={type:"violin",y:r.map(function(a){return a[t.y]}),name:"Violin Plot",box:{visible:!0},meanline:{visible:!0},hovertemplate:"<b>Violin Plot</b><br>"+"".concat((Ke==null?void 0:Ke.name)||t.y,": %{y}<br>")+"<extra></extra>"};return Fe.push(Lt),Fe}case"heatmap":var na=be()(new Set(r.map(function(a){return a[t.x]}))),ra=be()(new Set(r.map(function(a){return a[t.y]}))),Nt=[];ra.forEach(function(a,L){Nt[L]=[],na.forEach(function(ge,pe){var K=r.find(function(Ut){return Ut[t.x]===ge&&Ut[t.y]===a}),ye=K&&parseFloat(K[t.z])||0;Nt[L][pe]=parseFloat(J(ye))})});var vt=l.find(function(a){return a.key===t.x}),It=l.find(function(a){return a.key===t.y}),$t=l.find(function(a){return a.key===t.z});return[{type:"heatmap",x:na,y:ra,z:Nt,colorscale:"Viridis",name:"Heatmap",hovertemplate:"<b>Heatmap</b><br>"+"".concat((vt==null?void 0:vt.name)||t.x,": %{x}<br>")+"".concat((It==null?void 0:It.name)||t.y,": %{y}<br>")+"".concat(($t==null?void 0:$t.name)||t.z,": %{z}<br>")+"<extra></extra>"}];case"pie":var pt={};r.forEach(function(a){var L=a[t.labels];pt[L]?pt[L]+=1:pt[L]=1});var yt=l.find(function(a){return a.key===t.labels});return[{type:"pie",labels:Object.keys(pt),values:Object.values(pt),textinfo:"label+percent",name:"Pie Chart",hovertemplate:"<b>%{label}</b><br>"+"".concat((yt==null?void 0:yt.name)||t.labels,": %{label}<br>")+"Count: %{value}<br>Percentage: %{percent}<br><extra></extra>"}];default:return[]}}catch(a){return console.error("Error generating plot data:",a),[]}},[r,j,t]),le=(0,s.useMemo)(function(){var c=Ft[j],w=l.find(function(N){return N.key===t.x}),x=l.find(function(N){return N.key===t.y});return{title:(c==null?void 0:c.name)||"Chart",xaxis:{title:{text:(w==null?void 0:w.key)||t.x||"X Axis",standoff:20},automargin:!0,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickwidth:1,tickcolor:"#000",mirror:!0,gridcolor:"#f0f0f0",gridwidth:1,showgrid:!1},yaxis:{title:{text:(x==null?void 0:x.key)||t.y||"Y Axis",standoff:20},automargin:!0,showline:!0,linecolor:"#000",linewidth:1,zeroline:!1,tickwidth:1,tickcolor:"#000",mirror:!0,gridcolor:"#f0f0f0",gridwidth:1,showgrid:!1},margin:{t:30,l:50,r:15,b:50},showlegend:!0,legend:{orientation:"v",x:1.02,y:1,xanchor:"left",yanchor:"top",bgcolor:"rgba(255,255,255,0.8)",bordercolor:"#ccc",borderwidth:1},height:void 0,width:void 0,autosize:!0,plot_bgcolor:"rgba(0,0,0,0)",paper_bgcolor:"rgba(0,0,0,0)"}},[j,t,l]);return(0,e.jsx)("div",{className:"visualizer-container",children:(0,e.jsxs)(Xe.Z,{gutter:[16,16],style:{height:"100%"},children:[(0,e.jsx)(mt.Z,{xs:24,lg:7,children:(0,e.jsx)(Yt.Z,{title:"Chart Configuration",size:"small",className:"control-panel",style:{height:"100%"},children:(0,e.jsxs)(tt.Z,{direction:"vertical",style:{width:"100%"},size:"middle",children:[(0,e.jsxs)("div",{className:"config-section",children:[(0,e.jsx)("div",{className:"section-title",children:"Chart Type"}),(0,e.jsx)(ot.default,{value:j,onChange:X,style:{width:"100%"},placeholder:"Select Chart Type",size:"middle",children:Object.entries(Ft).map(function(c){var w=v()(c,2),x=w[0],N=w[1];return(0,e.jsx)(Ya,{value:x,children:N.name},x)})})]}),(0,e.jsx)(Sr.Z,{}),(0,e.jsxs)("div",{className:"config-section",children:[(0,e.jsx)("div",{className:"section-title",children:"Variable Mapping"}),(0,e.jsx)(va.Z,{form:ee,layout:"vertical",className:"mapping-form",children:j&&((i=Ft[j])===null||i===void 0?void 0:i.mappings.map(function(c){var w=Ft[j].required.includes(c);return(0,e.jsx)(va.Z.Item,{label:(0,e.jsxs)("span",{children:[_a[c],w&&(0,e.jsx)("span",{className:"required-mark",children:" *"})]}),name:c,rules:w?[{required:!0,message:"This field is required"}]:[],children:(0,e.jsx)(ot.default,{placeholder:"Select ".concat(_a[c]," Variable"),onChange:function(N){return O(c,N)},allowClear:!0,size:"middle",showSearch:!0,optionFilterProp:"children",children:V(c)})},c)}))})]}),(0,e.jsx)("div",{className:"status-info",children:(0,e.jsxs)(Cr,{type:"secondary",children:["Data Points: ",(r==null?void 0:r.length)||0," | Fields: ",(l==null?void 0:l.length)||0]})})]})})}),(0,e.jsx)(mt.Z,{xs:24,lg:17,children:(0,e.jsx)(Yt.Z,{title:"Chart Display",size:"small",className:"chart-panel",style:{height:"100%"},children:(0,e.jsx)("div",{className:"chart-container",children:Q.length>0?(0,e.jsx)(wr.Z,{data:Q,layout:le,config:{responsive:!0,displayModeBar:!0,displaylogo:!1,modeBarButtonsToRemove:["pan2d","lasso2d","select2d"],toImageButtonOptions:{format:"png",filename:"chart",height:500,width:700,scale:1}},className:"plotly-container",style:{width:"100%",height:"100%"},useResizeHandler:!0},g):(0,e.jsxs)("div",{className:"empty-state",children:[(0,e.jsx)(jt.Z,{className:"empty-icon"}),(0,e.jsx)("div",{className:"empty-text",children:j?Object.keys(t).length===0?"Please configure variable mapping":"Please complete the required variable mapping configuration":"Please select a chart type to start visualization"}),r.length===0&&(0,e.jsx)(ka.Z,{message:"No data available",type:"error",description:"You should select your interested fields to visualize first."})]})})})})]})})},Zr=kr,zr=function(n,i){var r=n.filter(function(l){return l.key!==i});if(r.length!==0)return r[0]},ta=function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"metadata.tsv",r=gr().unparse(n,{delimiter:"	",quotes:!1}),l=new Blob(["\uFEFF"+r],{type:"text/tab-separated-values;charset=utf-8;"}),k=URL.createObjectURL(l),p=document.createElement("a");p.href=k,p.download=i,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(k)},Nr=function(n){var i,r,l,k=n.key,p=(0,st.useLocation)(),j=(0,s.useState)(!1),m=v()(j,2),z=m[0],R=m[1],t=(0,s.useState)([]),M=v()(t,2),me=M[0],y=M[1],g=(0,s.useState)(null),U=v()(g,2),o=U[0],Z=U[1],ee=(0,s.useState)({fields:[]}),J=v()(ee,2),G=J[0],H=J[1],Y=(0,s.useState)(!1),A=v()(Y,2),X=A[0],O=A[1],B=(0,s.useState)({records:[],page:1,page_size:100,total:0}),V=v()(B,2),h=V[0],ie=V[1],te=(0,s.useState)([]),_=v()(te,2),Q=_[0],le=_[1],c=(0,s.useState)([]),w=v()(c,2),x=w[0],N=w[1],T=(0,s.useState)(h.page),E=v()(T,2),D=E[0],$=E[1],ke=(0,s.useState)(h.page_size),Ve=v()(ke,2),De=Ve[0],fe=Ve[1],ut=(0,s.useState)(void 0),Le=v()(ut,2),ae=Le[0],ct=Le[1],Ye=(0,s.useState)(void 0),Re=v()(Ye,2),S=Re[0],Ge=Re[1],_e=(0,s.useState)(void 0),I=v()(_e,2),Ze=I[0],je=I[1],P=(0,s.useState)(null),F=v()(P,2),q=F[0],nt=F[1],qe=(0,s.useState)(!1),dt=v()(qe,2),et=dt[0],He=dt[1],kt=(0,s.useState)(!1),We=v()(kt,2),C=We[0],W=We[1],ve=(0,s.useState)(!1),oe=v()(ve,2),Te=oe[0],Me=oe[1],se=(0,s.useState)("summary"),Ie=v()(se,2),Se=Ie[0],ft=Ie[1],Zt=(0,s.useState)(!1),Fe=v()(Zt,2),rt=Fe[0],Ke=Fe[1],zt=(0,s.useState)(void 0),aa=v()(zt,2),Lt=aa[0],na=aa[1],ra=(0,s.useState)(void 0),Nt=v()(ra,2),vt=Nt[0],It=Nt[1],$t=(0,s.useState)(!1),pt=v()($t,2),yt=pt[0],a=pt[1],L=(0,s.useState)({metadata:!1,data:!1,datafileTables:!1,rendering:!1}),ge=v()(L,2),pe=ge[0],K=ge[1],ye=(0,s.useState)({current:0,total:0,message:""}),Ut=v()(ye,2),ia=Ut[0],Ae=Ut[1],Dr=(0,s.useState)(void 0),qa=v()(Dr,2),pa=qa[0],Pt=qa[1],Rr=(0,s.useState)(void 0),en=v()(Rr,2),ya=en[0],Dt=en[1],Tr=(0,s.useState)([]),tn=v()(Tr,2),Gt=tn[0],an=tn[1],Mr=(0,s.useState)({}),nn=v()(Mr,2),ga=nn[0],rn=nn[1],Er=(0,s.useState)({}),ln=v()(Er,2),Ht=ln[0],on=ln[1],Or=(0,s.useState)({}),sn=v()(Or,2),Rt=sn[0],un=sn[1],Vr=(0,s.useState)({}),cn=v()(Vr,2),xa=cn[0],dn=cn[1],Ar=(0,s.useState)({}),fn=v()(Ar,2),ba=fn[0],hn=fn[1],Br=(0,s.useState)({}),mn=v()(Br,2),ht=mn[0],ja=mn[1],Fr=(0,s.useState)({}),vn=v()(Fr,2),Wt=vn[0],Lr=vn[1],Ir=function(b){var de=b!=null?b:"";if(!de){var ne=p.pathname,xe=ne.split("/").filter(Boolean),Be=xe.pop();if(!Be)return st.history.push("/"),"";de=Be}return de},$r=function(){var b,de=new URLSearchParams(p.search);return(b=de.get("version"))!==null&&b!==void 0?b:void 0},Ur=function(b,de){K(function(ne){return u()(u()({},ne),{},{metadata:!0})}),Ae({current:0,total:3,message:"Loading dataset metadata..."}),(0,at.getDatasets)({page:1,page_size:1e3}).then(function(ne){Ae(function(ce){return u()(u()({},ce),{},{current:1,message:"Processing dataset information..."})});var xe=ne.records.filter(function(ce){return ce.key===b});if(!xe){st.history.push("/");return}y(xe);var Be=xe.sort(function(ce,$e){return br().rcompare(ce.version,$e.version)}),ze=Be[0],we=de!=null?de:ze==null?void 0:ze.version,ue=xe.find(function(ce){return ce.version===we});!ue&&ze&&(ue=ze),console.log("latestDataset",ze,"version",de,"sortedDatasets",Be,"dataset",ue,"filteredDatasets",xe),ue?(Ge(ue.version),Z(ue),fe(ue.total),Ae(function(ce){return u()(u()({},ce),{},{current:2,message:"Dataset metadata loaded"})})):(Ee.ZP.error("Dataset not found"),st.history.push("/")),K(function(ce){return u()(u()({},ce),{},{metadata:!1})})}).catch(function(ne){ne.handled||(Ee.ZP.error("Failed to fetch the dataset metadata."),console.error("Failed to fetch the dataset metadata.",ne),st.history.push("/"),K(function(xe){return u()(u()({},xe),{},{metadata:!1})}))})};(0,s.useEffect)(function(){var d=Ir(),b=$r();ct(d),Ge(b),console.log("datasetKey",d,"version",b),Ur(d,b)},[p.pathname,p.search]),(0,s.useEffect)(function(){var d=function(){R(window.innerWidth<=768)};return d(),window.addEventListener("resize",d),function(){return window.removeEventListener("resize",d)}},[]),(0,s.useEffect)(function(){var d,b;if(ae&&S){var de=((d=st.history.location)===null||d===void 0?void 0:d.hash)!==void 0&&((b=st.history.location)===null||b===void 0?void 0:b.hash)!=="",ne=window.location.origin,xe="/datatable/".concat(ae),Be=S?"?version=".concat(S):"",ze=de?"".concat(ne,"/#").concat(xe).concat(Be):"".concat(ne).concat(xe).concat(Be),we='<iframe width="1000" height="800" src="'.concat(ze,'&hideHeader=true" title="BioMiner Indexd - ').concat(o==null?void 0:o.name,'" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>');na(ze),It(we),K(function(ue){return u()(u()({},ue),{},{metadata:!0})}),Ae({current:0,total:2,message:"Loading data dictionary..."}),(0,at.getDataDictionary)({key:ae,version:S!=null?S:""}).then(function(ue){Ae(function(ce){return u()(u()({},ce),{},{current:1,message:"Processing data dictionary..."})}),H(ue),le(oa(ue.fields)),Ae(function(ce){return u()(u()({},ce),{},{current:2,message:"Data dictionary loaded"})}),K(function(ce){return u()(u()({},ce),{},{metadata:!1})})}).catch(function(ue){ue.handled||(Ee.ZP.error("Failed to fetch the dataset data dictionary."),console.error("Failed to fetch the dataset data dictionary.",ue),st.history.push("/"),K(function(ce){return u()(u()({},ce),{},{metadata:!1})}))}),K(function(ue){return u()(u()({},ue),{},{datafileTables:!0})}),(0,at.getDatafileTables)({key:ae,version:S!=null?S:""}).then(function(ue){an(ue),ja(u()(u()({},ht),ue.reduce(function(ce,$e){var Tt=oa($e.data_dictionary.fields.filter(function(it){return it.key!==$e.id_column_name}),1);return ce[$e.table_name]=[].concat(be()(Tt),[$e.id_column_name]),ce},{}))),K(function(ce){return u()(u()({},ce),{},{datafileTables:!1})})}).catch(function(ue){ue.handled||(Ee.ZP.error("Failed to fetch the dataset datafile tables."),console.error("Failed to fetch the dataset datafile tables.",ue),K(function(ce){return u()(u()({},ce),{},{datafileTables:!1})}))})}},[ae,S]),(0,s.useEffect)(function(){G.fields.length>0&&o&&O(!0)},[G,o]),(0,s.useEffect)(function(){N(G.fields.filter(function(d){return Q.includes(d.key)}))},[G,Q]),(0,s.useEffect)(function(){if(ae&&S&&X){K(function(b){return u()(u()({},b),{},{data:!0})}),Ae({current:0,total:3,message:"Building query plan..."});var d=function(){var b=Ca()(Qt()().mark(function de(){var ne,xe;return Qt()().wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:return Ae(function(we){return u()(u()({},we),{},{current:1,message:"Executing data query..."})}),ne={table:"metadata_table",joins:[],selects:Q.map(function(we){return{type:"field",value:we}}),filters:Ze,group_by:[],having:void 0,order_by:[],limit:De,offset:(D-1)*De,distinct:!1},Ze&&(ne.query=Ze),ze.next=5,(0,at.fetchDatasetDataWithQueryPlan)({key:ae,version:S!=null?S:""},{query_plan:JSON.stringify(ne)}).catch(function(we){return Ee.ZP.error("Failed to fetch the dataset data."),console.error("Failed to fetch the dataset data.",we),K(function(ue){return u()(u()({},ue),{},{data:!1})}),Ae({current:0,total:0,message:""}),{records:[],page:1,page_size:100,total:0}});case 5:xe=ze.sent,Ae(function(we){return u()(u()({},we),{},{current:2,message:"Processing query result..."})}),ie(xe),Ae(function(we){return u()(u()({},we),{},{current:3,message:"Data loaded, rendering components..."})}),K(function(we){return u()(u()({},we),{},{rendering:!0})}),setTimeout(function(){K(function(we){return u()(u()({},we),{},{rendering:!1,data:!1})}),Ae({current:0,total:0,message:""})},500);case 11:case"end":return ze.stop()}},de)}));return function(){return b.apply(this,arguments)}}();d()}},[D,De,ae,S,Ze,Q,X]),(0,s.useEffect)(function(){var d;if(ae&&S&&X){if(!Gt.find(function(ne){return ne.table_name===Se})){K(function(ne){return u()(u()({},ne),{},{data:!1})});return}console.log("Fetching data file table: ",Se,Ze,h,X,ht,Ht,Rt),K(function(ne){return u()(u()({},ne),{},{data:!0})}),Ae({current:0,total:2,message:"Loading ".concat(Se," table data...")});var b={field:(d=Gt.find(function(ne){return ne.table_name===Se}))===null||d===void 0?void 0:d.id_column_name,operator:"in",value:h.records.map(function(ne){return ne[Ct]})},de=function(){var ne=Ca()(Qt()().mark(function xe(){var Be,ze,we,ue,ce,$e;return Qt()().wrap(function(it){for(;;)switch(it.prev=it.next){case 0:return Ae(function(Qe){return u()(u()({},Qe),{},{current:1,message:"Querying data file..."})}),ce={table:Se,joins:[],selects:((Be=ht[Se])!==null&&Be!==void 0?Be:[]).map(function(Qe){return{type:"field",value:Qe}}),filters:b,group_by:[],having:void 0,order_by:[],limit:(ze=Rt[Se])!==null&&ze!==void 0?ze:100,offset:((we=Ht[Se])!==null&&we!==void 0?we:0)*((ue=Rt[Se])!==null&&ue!==void 0?ue:100),distinct:!1},it.next=4,(0,at.fetchDatasetDataWithQueryPlan)({key:ae,version:S!=null?S:""},{query_plan:JSON.stringify(ce)}).catch(function(Qe){return Ee.ZP.error("Failed to fetch the dataset data."),console.error("Failed to fetch the dataset data.",Qe),K(function(lt){return u()(u()({},lt),{},{data:!1})}),Ae({current:0,total:0,message:""}),{records:[],page:1,page_size:100,total:0}});case 4:$e=it.sent,Ae(function(Qe){return u()(u()({},Qe),{},{current:2,message:"Processing data file result..."})}),rn(u()(u()({},ga),{},Ce()({},Se,$e.records))),dn(u()(u()({},xa),{},Ce()({},Se,$e.total))),K(function(Qe){return u()(u()({},Qe),{},{data:!1})}),Ae({current:0,total:0,message:""});case 10:case"end":return it.stop()}},xe)}));return function(){return ne.apply(this,arguments)}}();de()}},[Se,Ze,h,X,ht,Ht,Rt]),(0,s.useEffect)(function(){var d;if(ae&&S&&X){var b=Gt.find(function(xe){return xe.table_name===Se});if(b){var de=(d=ht[Se])!==null&&d!==void 0?d:[],ne=b.data_dictionary.fields.filter(function(xe){return de.includes(xe.key)});hn(u()(u()({},ba),{},Ce()({},Se,ne)))}}},[Se,Gt,ht]),(0,s.useEffect)(function(){ft(yt?"ai-copilot":"summary")},[yt]);var Gr=function(){$(1),fe(100)},Hr=function(){$(1),fe(100),je(void 0),nt(null),He(!1),ft("summary"),Pt(void 0),Dt(void 0),an([]),rn({}),on({}),un({}),dn({}),hn({}),ja({})},Wr=function(b){console.log("setDatasetVersion",b),Ge(b),Hr(),st.history.replace("/datatable/".concat(ae,"?version=").concat(b))},la=pe.metadata||pe.data||pe.datafileTables||pe.rendering,Kr=ia.total>0;return(0,e.jsxs)(Sn.Z,{spinning:la,indicator:(0,e.jsx)(Tn.Z,{style:{fontSize:24},spin:!0}),children:[Kr&&(0,e.jsx)(ka.Z,{message:(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,e.jsx)("span",{children:ia.message}),(0,e.jsx)(wn.Z,{percent:Math.round(ia.current/ia.total*100),size:"small",style:{maxWidth:"calc(100% - 240px)"},showInfo:!1})]}),type:"info",showIcon:!0,style:{margin:"0 auto 16px",width:"50%"}}),(0,e.jsxs)("div",{className:"datatable-header",children:[(0,e.jsxs)("div",{className:"datatable-header-top",children:[(0,e.jsx)(Je.Z.Title,{level:4,className:"datatable-title",children:o==null?void 0:o.name}),!la&&(0,e.jsxs)("div",{className:"datatable-header-actions",children:[z?(0,e.jsx)(Et.Z,{menu:{items:[{key:"download",label:"Download Dataset",icon:(0,e.jsx)(At.Z,{}),onClick:function(){return He(!0)}},{key:"cite",label:"Cite Dataset",icon:(0,e.jsx)(bt.Z,{}),disabled:!(o!=null&&o.pmid),onClick:function(){window.open("https://www.ncbi.nlm.nih.gov/pubmed/".concat(o==null?void 0:o.pmid),"_blank")}},{key:"readme",label:"README",icon:(0,e.jsx)(bt.Z,{}),onClick:function(){(0,at.getDatasetReadme)({key:ae!=null?ae:"",version:S!=null?S:""}).then(function(b){Pt(b||"No readme found")}).catch(function(b){b.handled||(Ee.ZP.error("Failed to fetch the dataset readme."),Pt(void 0))})}},{key:"license",label:"License",icon:(0,e.jsx)(bt.Z,{}),onClick:function(){(0,at.getDatasetLicense)({key:ae!=null?ae:"",version:S!=null?S:""}).then(function(b){Dt(b||"No license found")}).catch(function(b){b.handled||(Ee.ZP.error("Failed to fetch the dataset license."),Dt(void 0))})}}]},trigger:["click"],children:(0,e.jsxs)(re.ZP,{type:"default",children:["Actions ",(0,e.jsx)(At.Z,{})]})}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Oe.Z,{title:"Download the dataset (each dataset might have at least two files: metadata table and datafile table which contain information about the data)",children:(0,e.jsx)(re.ZP,{onClick:function(){He(!0)},icon:(0,e.jsx)(At.Z,{}),type:"default",children:"Download Dataset"})}),(0,e.jsx)(Oe.Z,{title:"Cite the dataset",placement:"top",children:(0,e.jsx)(re.ZP,{disabled:!(o!=null&&o.pmid),onClick:function(){window.open("https://www.ncbi.nlm.nih.gov/pubmed/".concat(o==null?void 0:o.pmid),"_blank")},icon:(0,e.jsx)(bt.Z,{}),type:"default",children:"Cite Dataset"})}),(0,e.jsx)(Oe.Z,{title:"Share the dataset",placement:"top",children:(0,e.jsx)(re.ZP,{icon:(0,e.jsx)(Mn.Z,{}),type:"default",onClick:function(){Ke(!0)},children:"Share"})}),(0,e.jsx)(re.ZP,{onClick:function(){(0,at.getDatasetReadme)({key:ae!=null?ae:"",version:S!=null?S:""}).then(function(b){Pt(b||"No readme found")}).catch(function(b){b.handled||(Ee.ZP.error("Failed to fetch the dataset readme."),Pt(void 0))})},icon:(0,e.jsx)(bt.Z,{}),type:"default",children:"README"}),(0,e.jsx)(re.ZP,{onClick:function(){(0,at.getDatasetLicense)({key:ae!=null?ae:"",version:S!=null?S:""}).then(function(b){Dt(b||"No license found")}).catch(function(b){b.handled||(Ee.ZP.error("Failed to fetch the dataset license."),Dt(void 0))})},icon:(0,e.jsx)(bt.Z,{}),type:"default",children:"License"})]}),(0,e.jsx)(ot.default,{defaultValue:S!=null?S:"Select Version",style:{width:120},options:me.map(function(d){return{label:d.version,value:d.version}}),onChange:function(b){Wr(b)}})]})]}),(0,e.jsx)("p",{className:"datatable-description",dangerouslySetInnerHTML:{__html:(i=o==null?void 0:o.description)!==null&&i!==void 0?i:""}})]}),(0,e.jsxs)(Ot.Z,{defaultActiveKey:"summary",activeKey:Se,onChange:function(b){ft(b),b!=="ai-copilot"&&yt&&a(!1)},destroyOnHidden:!1,className:"datatable-tabs",tabBarExtraContent:(0,e.jsxs)(Xe.Z,{className:"datatable-tabs-extra-content",children:[(0,e.jsx)(mt.Z,{className:"datatable-tabs-extra-content-left",children:la?null:(0,e.jsxs)(e.Fragment,{children:[Ze&&(0,e.jsx)(Xe.Z,{className:"datatable-filters",children:Rn(Ze,0,G.fields)}),(0,e.jsxs)(Je.Z.Text,{style:{fontSize:16},className:"sample-file-count",children:["\u26A0\uFE0F Loaded ",h.records.length," ",o!=null&&o.is_filebased?"files":"samples",", ",h.total," ",o!=null&&o.is_filebased?"files":"samples"," in total.",(0,e.jsx)(Oe.Z,{title:(0,e.jsxs)("span",{children:["If you want to load all the data, please click the button ",(0,e.jsxs)(Jt.Z,{color:"gray",children:["Load All (",h.total,")"]}),". But it will take a while to load."]}),children:(0,e.jsx)(En.Z,{style:{marginLeft:8}})}),(0,e.jsx)(re.ZP,{disabled:h.records.length===h.total,onClick:function(){$(1),h.total>1e3&&Ee.ZP.warning("The dataset is too large, it will take a while to load."),fe(h.total)},icon:(0,e.jsx)(On.Z,{}),type:"primary",size:"small",style:{marginLeft:8},children:"Load All"})]})]})}),(0,e.jsx)(mt.Z,{className:"datatable-tabs-extra-content-right",children:la?null:z?(0,e.jsxs)(tt.Z,{children:[(0,e.jsx)(re.ZP,{type:"primary",onClick:function(){W(!0)},icon:(0,e.jsx)(Ra.Z,{}),children:"Filter"}),(0,e.jsx)(Et.Z,{menu:{items:[{key:"ai-copilot",label:"AI Copilot",icon:(0,e.jsx)(Ta.Z,{}),onClick:function(){a(!0)}},{key:"visualize",label:"Visualize",icon:(0,e.jsx)(jt.Z,{}),onClick:function(){Me(!0)}}]},trigger:["click"],children:(0,e.jsx)(re.ZP,{children:"More Actions"})})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Oe.Z,{title:"AI Copilot",children:(0,e.jsx)(re.ZP,{onClick:function(){a(!0)},icon:(0,e.jsx)(Ta.Z,{}),type:"default",children:"AI Copilot"})}),(0,e.jsx)(re.ZP,{onClick:function(){Me(!0)},icon:(0,e.jsx)(jt.Z,{}),type:"default",children:"Visualize"}),(0,e.jsx)(Na,{fields:G.fields,selectedKeys:Q,onChange:le}),(0,e.jsx)(re.ZP,{type:"primary",onClick:function(){W(!0)},icon:(0,e.jsx)(Ra.Z,{}),children:"Filter"})]})})]}),children:[(0,e.jsx)(Ot.Z.TabPane,{tab:"Summary",children:(0,e.jsx)(rr,{fields:G.fields,data:h.records,isFileBased:(r=o==null?void 0:o.is_filebased)!==null&&r!==void 0?r:!1,total:h.total,selectedColumns:Q,onClose:function(b){le(Q.filter(function(de){return de!==b.key}))}})},"summary"),(0,e.jsx)(Ot.Z.TabPane,{tab:"Clinical Data",children:(0,e.jsx)(Cn.Z,{type:"table",rows:8,loading:pe.data,children:(0,e.jsx)(Ja,{className:"datatable-table",size:"small",dataSource:h.records,rowKey:function(b,de){var ne;return(ne=de==null?void 0:de.toString())!==null&&ne!==void 0?ne:""},scroll:{y:z?window.innerHeight-350:window.innerHeight-276,x:z?window.innerWidth-20:window.innerWidth-48},pagination:{position:["bottomRight"],pageSize:De,current:D,total:h.total,onChange:function(b,de){$(b),fe(de)},showSizeChanger:!z,showQuickJumper:!z,pageSizeOptions:[100,200,300,500,1e3],simple:z},onCellClick:function(b,de,ne){nt(b)},dataDictionary:x,isFileBased:(l=o==null?void 0:o.is_filebased)!==null&&l!==void 0?l:!1})})},"table"),Gt.map(function(d){var b,de,ne,xe,Be,ze,we,ue,ce,$e,Tt,it,Qe;return(0,e.jsx)(Ot.Z.TabPane,{tab:(0,e.jsx)(Oe.Z,{title:d.description,children:d.title}),children:(0,e.jsxs)(Xe.Z,{children:[(0,e.jsx)(re.ZP,{onClick:function(){Lr(u()(u()({},Wt),{},Ce()({},d.table_name,!Wt[d.table_name])))},className:"switch-".concat(d.table_name),icon:Wt[d.table_name]?(0,e.jsx)(jt.Z,{}):(0,e.jsx)(Vn.Z,{}),children:Wt[d.table_name]?"Show Charts":"Show Table"}),(0,e.jsx)(Na,{fields:d.data_dictionary.fields.filter(function(lt){return lt.key!==d.id_column_name}),selectedKeys:(b=ht[d.table_name])!==null&&b!==void 0?b:[],className:"column-selector-".concat(d.table_name),title:"Columns",onChange:function(Mt){ja(u()(u()({},ht),{},Ce()({},d.table_name,[].concat(be()(Mt),[d.id_column_name]))))},mode:"single"}),Wt[d.table_name]?(0,e.jsx)(Ja,{className:"datatable-table",size:"small",dataSource:(ce=ga[d.table_name])!==null&&ce!==void 0?ce:[],rowKey:function(Mt,Kt){var Sa;return(Sa=Kt==null?void 0:Kt.toString())!==null&&Sa!==void 0?Sa:""},scroll:{y:window.innerHeight-276,x:window.innerWidth-48},pagination:{position:["bottomRight"],pageSize:($e=Rt[d.table_name])!==null&&$e!==void 0?$e:100,current:(Tt=Ht[d.table_name])!==null&&Tt!==void 0?Tt:1,total:(it=xa[d.table_name])!==null&&it!==void 0?it:0,onChange:function(Mt,Kt){on(u()(u()({},Ht),{},Ce()({},d.table_name,Mt))),un(u()(u()({},Rt),{},Ce()({},d.table_name,Kt)))},showSizeChanger:!0,showQuickJumper:!0,pageSizeOptions:[100,200,300,500,1e3]},dataDictionary:(Qe=ba[d.table_name])!==null&&Qe!==void 0?Qe:[],isFileBased:!1}):(0,e.jsx)(Qn,{fields:G.fields.filter(function(lt){return Q.find(function(Mt){return Mt===lt.key})&&!_n.includes(lt.key)}),data:jr((de=ga[d.table_name])!==null&&de!==void 0?de:[],h.records,{leftOn:(ne=d.id_column_name)!==null&&ne!==void 0?ne:Ct,rightOn:Ct,how:"left"}),idColumnName:(xe=d.id_column_name)!==null&&xe!==void 0?xe:Ct,total:(Be=xa[d.table_name])!==null&&Be!==void 0?Be:0,selectedColumns:(ze=ht[d.table_name])!==null&&ze!==void 0?ze:[],yField:zr((we=ba[d.table_name])!==null&&we!==void 0?we:[],(ue=d.id_column_name)!==null&&ue!==void 0?ue:Ct),onClose:function(){}})]})},d.table_name)}),yt?(0,e.jsx)(Ot.Z.TabPane,{tab:"AI Copilot",children:(0,e.jsx)(pr.default,{embedded:!0,datasetKeyVersion:"".concat(ae,":").concat(S)})},"ai-copilot"):null]}),(0,e.jsx)(Fn,{visible:C,onCancel:function(){return W(!1)},onConfirm:function(b){W(!1),console.log("QueryBuilder",b),je(b),b||Gr()},dataDictionary:G}),q?(0,e.jsx)(gt.Z,{className:"datatable-data-info-modal",open:q!==null,width:800,onCancel:function(){return nt(null)},footer:null,children:(0,e.jsx)(fr,{data:q,dataDictionary:G,title:"Patient ".concat(q.patient_id," - Details")})}):null,(0,e.jsx)(vr,{open:et,onClose:function(){return He(!1)},onDownloadMetadataTable:function(){if(Ee.ZP.info("Downloading the metadata table, it will take a while. Please don't close or refresh the page."),h.records.length===h.total)ta(h.records,"metadata.tsv");else{if(!ae||!S)return;(0,at.getDatasetData)({key:ae,version:S!=null?S:"",page:1,page_size:h.total}).then(function(b){ta(b.records,"metadata.tsv")}).catch(function(b){b.handled||(console.error("Failed to download the metadata table.",b),Ee.ZP.error("Failed to download the metadata table, please try again later."))})}},onDownloadDatafiles:function(){if(Ee.ZP.info("Downloading the datafiles, it will take a while. Please don't close or refresh the page."),!ae){Ee.ZP.error("Failed to download the datafiles, please try again later.");return}(0,at.getDatafiles)({key:ae,version:S!=null?S:""}).then(function(b){ta(b,"datafiles.tsv")}).catch(function(b){b.handled||(Ee.ZP.error("Failed to download the datafiles, please try again later."),console.error("Failed to download the datafiles.",b))})}}),pa?(0,e.jsx)(gt.Z,{open:pa!==null,width:800,height:600,onCancel:function(){return Pt(void 0)},footer:null,title:(0,e.jsx)(Je.Z.Title,{level:4,children:"README"}),children:(0,e.jsx)(fa.D,{remarkPlugins:[ha.Z],children:pa})}):null,ya?(0,e.jsx)(gt.Z,{open:ya!==null,width:800,height:600,onCancel:function(){return Dt(void 0)},footer:null,title:(0,e.jsx)(Je.Z.Title,{level:4,children:"License"}),children:(0,e.jsx)(fa.D,{remarkPlugins:[ha.Z],children:ya})}):null,Te?(0,e.jsx)(gt.Z,{open:Te,width:"80%",onCancel:function(){return Me(!1)},footer:null,title:(0,e.jsx)(Je.Z.Title,{level:4,children:"Selected Data Visualizer"}),children:(0,e.jsx)(Zr,{data:h.records,fieldDataDictionary:x})}):null,rt?(0,e.jsxs)(gt.Z,{open:rt,width:800,height:600,onCancel:function(){return Ke(!1)},footer:null,title:(0,e.jsx)(Je.Z.Title,{level:4,children:"Share the dataset"}),children:[(0,e.jsxs)(tt.Z,{children:[(0,e.jsx)(re.ZP,{type:"default",onClick:function(){Ke(!1),navigator.clipboard.writeText(Lt!=null?Lt:""),Ee.ZP.success("Link copied to clipboard")},children:"Copy Link"}),(0,e.jsx)(re.ZP,{type:"default",onClick:function(){Ke(!1),navigator.clipboard.writeText(vt!=null?vt:""),Ee.ZP.success("Iframe code copied to clipboard")},children:"Copy Embed Code"})]}),(0,e.jsxs)(Xe.Z,{style:{marginTop:16},children:[(0,e.jsx)(Je.Z.Text,{style:{fontSize:16},children:"You can use the following code to embed the dataset in your website or blog:"}),(0,e.jsx)(Je.Z.Text,{copyable:!0,style:{fontSize:16,border:"1px solid #e0e0e0",padding:8,borderRadius:4},children:vt})]})]}):null]})},Pr=Nr}}]);
