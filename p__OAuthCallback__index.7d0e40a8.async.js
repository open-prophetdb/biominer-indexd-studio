"use strict";(self.webpackChunkbiominer_indexd_studio=self.webpackChunkbiominer_indexd_studio||[]).push([[1857],{55373:function($,E,e){e.r(E);var B=e(15009),s=e.n(B),A=e(97857),l=e.n(A),T=e(99289),o=e.n(T),c=e(5574),j=e.n(c),d=e(67294),v=e(4393),p=e(74330),I=e(45821),h=e(94272),C=e(43984),m=e(10981),_=e(85893),t=function(){var n=(0,h.useLocation)(),a=(0,d.useState)(!0),K=j()(a,2),Z=K[0],P=K[1],z=(0,d.useState)(""),W=j()(z,2),G=W[0],O=W[1],S=(0,h.useModel)("@@initialState"),U=S.initialState,F=S.setInitialState,H=function(){var L=o()(s()().mark(function y(){var f,u;return s()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,U==null||(f=U.fetchUserInfo)===null||f===void 0?void 0:f.call(U);case 2:if(u=i.sent,!u){i.next=7;break}return(0,m.c3)(u),i.next=7,F(function(M){return l()(l()({},M),{},{currentUser:u})});case 7:case"end":return i.stop()}},y)}));return function(){return L.apply(this,arguments)}}();return(0,d.useEffect)(function(){var L=function(){var y=o()(s()().mark(function f(){var u,g,i,M,R,k,D,x;return s()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(console.log("handleCallback: ",n.search),u=new URLSearchParams(n.search),g=u.get("code"),i=u.get("state"),M=n.pathname.split("/"),R=M.includes("github")?"github":M.includes("google")?"google":"github",g){r.next=10;break}return O("Authorization code is missing"),P(!1),r.abrupt("return");case 10:return r.prev=10,console.log("handleCallback: ",R,g,i),k=R==="google"?C.handleGoogleCallback:C.handleGithubCallback,r.next=15,k({code:g,state:i||void 0});case 15:if(D=r.sent,!(D.success&&D.token)){r.next=23;break}return x=(0,m.E8)(D.token),r.next=20,H();case 20:x?(console.log("Token set successfully, redirecting..."),(0,m.Dz)()):(console.error("Failed to set token"),O("Token storage failed"),P(!1)),r.next=25;break;case 23:O(D.error||"Login failed"),P(!1);case 25:r.next=32;break;case 27:r.prev=27,r.t0=r.catch(10),console.error("OAuth callback error:",r.t0),O("Login failed, please try again"),P(!1);case 32:case"end":return r.stop()}},f,null,[[10,27]])}));return function(){return y.apply(this,arguments)}}();L()},[n]),Z?(0,_.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,_.jsxs)(v.Z,{style:{width:400,textAlign:"center"},children:[(0,_.jsx)(p.Z,{size:"large"}),(0,_.jsx)("div",{style:{marginTop:16},children:"Processing login..."})]})}):G?(0,_.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,_.jsx)(v.Z,{style:{width:400},children:(0,_.jsx)(I.ZP,{status:"error",title:"Login failed",subTitle:G,extra:[(0,_.jsx)("a",{href:"/user/login",children:"Back to login page"},"login")]})})}):null};E.default=t},43984:function($,E,e){e.r(E),e.d(E,{getGithubAuthUrl:function(){return j},getGoogleAuthUrl:function(){return I},handleGithubCallback:function(){return v},handleGoogleCallback:function(){return C}});var B=e(15009),s=e.n(B),A=e(97857),l=e.n(A),T=e(99289),o=e.n(T),c=e(94272);function j(_){return d.apply(this,arguments)}function d(){return d=o()(s()().mark(function _(t){return s()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,c.request)("/api/v1/auth/github",l()({method:"GET"},t||{})));case 1:case"end":return n.stop()}},_)})),d.apply(this,arguments)}function v(_,t){return p.apply(this,arguments)}function p(){return p=o()(s()().mark(function _(t,b){return s()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,c.request)("/api/v1/auth/github/callback",l()({method:"GET",params:l()({},t)},b||{})));case 1:case"end":return a.stop()}},_)})),p.apply(this,arguments)}function I(_){return h.apply(this,arguments)}function h(){return h=o()(s()().mark(function _(t){return s()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,c.request)("/api/v1/auth/google",l()({method:"GET"},t||{})));case 1:case"end":return n.stop()}},_)})),h.apply(this,arguments)}function C(_,t){return m.apply(this,arguments)}function m(){return m=o()(s()().mark(function _(t,b){return s()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,c.request)("/api/v1/auth/google/callback",l()({method:"GET",params:l()({},t)},b||{})));case 1:case"end":return a.stop()}},_)})),m.apply(this,arguments)}}}]);
